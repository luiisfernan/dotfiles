var Domains={obj:null,black:null,black_h:null,sp:null,black_str:"",enable:"true",generatePAC:function(model,pxy){var DIRECT_URL="['chrome-extension://','chrome://']";var DIRECT_HOST="['10.[0-9]+.[0-9]+.[0-9]+', '172.[0-9]+.[0-9]+.[0-9]+', '192.168.[0-9]+.[0-9]+']";var DIRECT_DNS="['0.0.0.0', '127.0.0.1', 'localhost']";this.reloadBlackDomains();if(pxy!=null&&this.getObj()!=null){var info=XXTEA.decryptFromBase64(pxy.info,appname);if(model==ModelType.closed){return null}else{if(model==ModelType.always){var sb=getHeader(info)+this.black_str+getSP();sb+=" return p;}";return sb}else{if(model==ModelType.needed){var header=getHeader(info);var body=getBody().replace("#",JSON.stringify(this.obj));return header+this.black_str+getSP()+body}else{return null}}}}else{return null}function getHeader(info){var sb="function FindProxyForURL(url,host){var D='DIRECT';"+getEncodeString(info)+";host=host.toLowerCase();";sb+=" var du = "+DIRECT_URL+";"+"for(var a in du){if(url.indexOf(du[a]) == 0){return D;}}";sb+=" var dh = "+DIRECT_HOST+";"+"for(var b in dh){if(shExpMatch(host,dh[b])){return D;}}";sb+=" var dn = "+DIRECT_DNS+";"+"for(var c in dn){if(dnsDomainIs(host,dn[c])){return D;}}";return sb}function getEncodeString(info){switch(encodeType){case"hash1":return jeef1(info,version);case"hash2":return jeef2(info,version);case"oper":jeef3(info);return'p="'+info+"'";default:return jeef(info,version)}}function getBody(){var sb="var node=#;var hostParts = host.split('.');for(var d=hostParts.length-1;d>=0;d--){var part=hostParts[d];node=node[part];if(node == undefined||node==1){break;}} if(node==1){return p;}return D;}";return sb}function getSP(){if(Domains.sp!=null&&Domains.sp!=""&&Domains.sp.length>0){if(AppPxy.sp!=null&&AppPxy.sp!=""){var info=$.base64.atob(AppPxy.sp);var tmp=JSON.stringify(Domains.sp);tmp="var spList = "+tmp+"; for(var i=0; i<spList.length; i++){if(host.indexOf(spList[i]) > -1){return '"+info+"';}}";return tmp}}return""}},init:function(domains,whiteDomains,blackDomains,blackhidden,sp,key){storage.setItem("time",new Date().getTime());if(domains&&domains!=""){storage.setItem("domains",JSON.stringify(domains))}else{if(key=="true"){}else{if(key=="false"){storage.setItem("domains","[]")}else{storage.removeItem("domains")}}}if(whiteDomains&&whiteDomains!=""){storage.setItem("white",JSON.stringify(whiteDomains))}else{storage.removeItem("white")}if(sp&&sp!=""){this.sp=sp}this.black=blackDomains;this.black_h=blackhidden;this.reloadWhite(domains,whiteDomains);this.generateBlackStr(blackDomains,blackhidden)},reloadBlackDomains:function(){var blackDomains=this.black?this.black:{};var ipList=AppPxy.getIpList();for(var i in ipList){blackDomains["node"+i]=ipList[i]}this.generateBlackStr(blackDomains,this.black_h)},saveList:function(domains){if(domains&&domains!=""){storage.setItem("domains",JSON.stringify(domains))}this.reloadWhite(domains);this.generateBlackStr(this.black,this.black_h)},generateBlackStr:function(blackDomains,blackhidden){var list=this.convertList(blackDomains,blackhidden);if(list!=null){var str=" var npd=#;var npdParts = host.split('.');for(var d=npdParts.length-1;d>=0;d--){var part=npdParts[d];npd=npd[part];if(npd == undefined||npd==1){break;}} if(npd==1){return D;} ";this.black_str=str.replace("#",JSON.stringify(list))}},getList:function(){var list=storage.getItem("domains");if(list){return $.parseJSON(list)}else{return null}},convertList:function(domains,whiteDomains){var obj=null;if(domains){obj={};for(var i in domains){var array=domains[i].split(".");var val=array.pop();obj[val]=covList(obj[val],array)}}if(whiteDomains){obj=obj==null?{}:obj;for(var i in whiteDomains){var array=whiteDomains[i].split(".");var val=array.pop();obj[val]=covList(obj[val],array)}}return obj},reloadWhite:function(domains,whiteDomains){domains=domains?domains:$.parseJSON(storage.getItem("domains"));whiteDomains=whiteDomains?whiteDomains:$.parseJSON(storage.getItem("white"));if(this.getEnable()=="true"){this.obj=this.convertList(domains,whiteDomains)}else{this.obj=this.convertList(domains)}},getEnable:function(){var enableSys=storage.getItem("enable");if(enableSys!=null){this.enable=enableSys}return this.enable},changeEnable:function(val){if(val=="true"){this.enable="true"}else{this.enable="false"}storage.setItem("enable",this.enable);this.reloadWhite()},getObj:function(){if(this.obj==null){this.reloadWhite()}return this.obj},getWhite:function(){var whiteDomains=storage.getItem("white");if(whiteDomains!=null){return $.parseJSON(whiteDomains)}else{return null}},clear:function(){this.obj=null;this.black_h=null;this.black=null;this.black_str="";storage.removeItem("domains");storage.removeItem("white");storage.removeItem("time")},isInList:function(domain){if(this.getObj()){var node=this.obj;var parts=domain.toLowerCase().split(".");for(var i=parts.length-1;i>=0;i--){var part=parts[i];node=node[part];if(node==undefined||node==1){break}}if(node==1){return true}}return false},add:function(id,domain){list=this.getList();if(list!=null){list[id]=domain;
this.reloadWhite(list);this.saveList(list)}},del:function(id){list=this.getList();if(list!=null){delete list[id];this.reloadWhite(list);this.saveList(list)}},update:function(id,domain){this.add(id,domain)},addDomains:function(dds){if(dds){list=this.getList();if(list!=null){for(var i in dds){list[i]=dds[i]}this.reloadWhite(list);this.saveList(list)}}},hasURL:function(url){if(url){url=url.toLowerCase();list=this.getList();if(list!=null){for(var i in list){if(url==list[i]){return true}}}}return false},isInWhiteBlack:function(url){if(url){var w=this.getWhite();if(w!=null){for(var i in w){if(url==w[i]){return true}}}if(!$.isEmptyObject(this.black)){for(var i in this.black){if(url==this.black[i]){return true}}}}return false},getSerialId:function(url){if(url){url=url.toLowerCase();list=this.getList();if(list!=null){for(var i in list){if(url==list[i]){return i}}}}return null},checkDomains:function(){var list=storage.getItem("domains");var time=storage.getItem("time");if(!time||!list){return false}var now=new Date().getTime();if((now-time)>10800000){return false}return true}};