function FindProxyForURLEnabled(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),isPlainHostName(e))return"DIRECT";if(shExpMatch(e,"*.local"))return"DIRECT";if(isResolvable(e)){var n=dnsResolve(e),o=[["127.0.0.1","255.255.255.255"],["192.168.0.1","255.255.255.255"],["192.168.1.1","255.255.255.255"]];for(var r in o)if(isInNet(n,o[r][0],o[r][1]))return"DIRECT"}if(shExpMatch(t,"*://www.hideman.net/api/v2/ip*"))return"%proxy_string%";if(shExpMatch(t,"*://www.hideman.net/api/*"))return"DIRECT";var i="%blacklist%",a=e[0]+e[1];if(void 0!=i.domains&&void 0!=i.domains[a]&&i.domains[a].indexOf(e)!=-1)return"DIRECT";if(void 0!=i.regexp)for(var s=0;s<i.regexp.length;s++)if(shExpMatch(e,i.regexp[s]))return"DIRECT";return"%proxy_string%"}function FindProxyForURLDisabled(t,e){var n="%whitelist%",o=e[0]+e[1];if(void 0!=n.domains&&void 0!=n.domains[o]&&n.domains[o].indexOf(e)!=-1)return"%proxy_string%";if(void 0!=n.regexp)for(var r=0;r<n.regexp.length;r++)if(shExpMatch(e,n.regexp[r]))return"%proxy_string%";return"DIRECT"}var Proxy=(new function(){function t(t){r.status=t,r.proxyStatusChangeEventListener(),localStorage.setItem("proxyStatus",t)}function e(t,e,n){switch(t.command){case"connect":return void r.connect();case"disconnect":return void r.disconnect();case"connectionInfoEvent":t.isVpn&&(a=0)}}function n(t,e){if(!t.isProxy||407!=t.statusCode||"Private proxy server"!==t.realm)return e();var n=localStorage.getItem("connectionUsername"),o=window.atob(localStorage.getItem("connectionPassword"));a>i&&(r.clear(),Log.e("auth attempts limit! "+window.btoa(n+":"+o)+" server"+Connection.selectedCountry.hostname),a=0),a++,e({authCredentials:{username:n,password:o}}),Log.i("attempt proxy auth "+window.btoa(n+":"+o)+" server "+Connection.selectedCountry.hostname+" attempt# "+a)}function o(t){Log.i((t.fatal?"Fatal\n":"")+t.error+"\n"+t.details)}var r=this,i=3,a=0;r.ProxyStatus={on:"on",off:"off",offWithWL:"wl"},r.proxyStatusChangeEventListener=null,r.init=function(){return r.status=localStorage.getItem("proxyStatus"),r.status||(r.status=r.ProxyStatus.off),chrome.runtime.onMessage.addListener(e),chrome.webRequest.onAuthRequired.addListener(n,{urls:["<all_urls>"]},["asyncBlocking"]),chrome.proxy.onProxyError.addListener(o),ListStorage.onChanged.addEventListener(r.update),r.update(),r},r.connect=function(){Log.i("switching default proxy mode to ON"),Connection.getConnectionString(function(e){var n=FindProxyForURLEnabled.toString().replace("FindProxyForURLEnabled","FindProxyForURL").replace(/%proxy_string%/g,e);ListStorage.getGroupedElements("black",function(e){n=n.replace('"%blacklist%"',JSON.stringify(e)),Log.i(n);var o={mode:"pac_script",pacScript:{data:n}};t(r.ProxyStatus.on),chrome.proxy.settings.set({value:o,scope:"regular"},function(){Connection.updateConnectionInfo()})})})},r.disconnect=function(){Log.i("switching default proxy mode to OFF"),ListStorage.getGroupedElements("white",function(e){return void 0==e.domains&&void 0==e.regexp?(Log.i("no whitelisted domains found. switching proxy off"),t(r.ProxyStatus.off),chrome.proxy.settings.clear({scope:"regular"},function(){Connection.updateConnectionInfo()})):void Connection.getConnectionString(function(n){var o=FindProxyForURLDisabled.toString().replace("FindProxyForURLDisabled","FindProxyForURL").replace(/%proxy_string%/g,n);o=o.replace('"%whitelist%"',JSON.stringify(e)),Log.i(o);var i={mode:"pac_script",pacScript:{data:o}};Log.i("proxy is switched off but with whitelists"),t(r.ProxyStatus.offWithWL),chrome.proxy.settings.set({value:i,scope:"regular"},function(){Connection.updateConnectionInfo()})})})},r.clear=function(){chrome.proxy.settings.clear({scope:"regular"},function(){Connection.updateConnectionInfo(),t(r.ProxyStatus.off),r.proxyStatusChangeEventListener()})},r.update=function(){switch(r.status){case r.ProxyStatus.on:r.connect();break;case r.ProxyStatus.off:case r.ProxyStatus.offWithWL:r.disconnect()}}}).init();