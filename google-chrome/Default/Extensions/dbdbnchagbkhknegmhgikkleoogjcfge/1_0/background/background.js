var Background=new function(){var t=this,e={On:"on",Off:"off",WhiteList:"wl",BlackList:"bl"};t.init=function(){Log.i("initializing background application"),chrome.tabs.onUpdated.addListener(t.onTabUpdate),ListStorage.onChanged.addEventListener(t.updatePageActions),Proxy.proxyStatusChangeEventListener=t.updatePageActions,t.updatePageActions()},t.onTabUpdate=function(e,a,o){return"undefined"==a.status||"loading"!=a.status||t.updateTabProxyStatus(e,o.url)},t.updatePageActions=function(){return chrome.tabs.query({},function(e){Log.i("found total "+e.length+" tabs");for(var a=0;a<e.length;++a)t.updateTabProxyStatus(e[a].id,e[a].url)}),!0};var a=chrome.i18n.getMessage("proxy_global_on"),o=chrome.i18n.getMessage("proxy_global_off"),n=chrome.i18n.getMessage("proxy_on_site_in_blacklist"),i=chrome.i18n.getMessage("proxy_off_site_in_whitelist");t.updateTabProxyStatus=function(s,r){chrome.pageAction.show(s),Log.i(s+" "+r),t.getPageProxyStatus(r,function(t){chrome.pageAction.setIcon({tabId:s,path:{38:"/icons/38_"+t+".png",19:"/icons/16_"+t+".png"}});var c="";switch(t){case e.On:c=a;break;case e.Off:c=o;break;case e.BlackList:c=n;break;case e.WhiteList:c=i}chrome.pageAction.getTitle({tabId:s},function(t){if(t===o&&c===i||t===a&&c===n||t===i&&c===o||t===n&&c===a)return Log.i("changes proxy in this tab "+s+"("+r+") update"),void chrome.tabs.reload(s)}),chrome.pageAction.setTitle({tabId:s,title:c})})},t.getPageProxyStatus=function(t,a){switch(Proxy.status){case Proxy.ProxyStatus.on:ListStorage.contains(ListStorage.Types.black,t,function(t){return a(t?e.BlackList:e.On)});break;case Proxy.ProxyStatus.offWithWL:ListStorage.contains(ListStorage.Types.white,t,function(t){return a(t?e.WhiteList:e.Off)});break;case Proxy.ProxyStatus.off:return a(e.Off)}}};Background.init();