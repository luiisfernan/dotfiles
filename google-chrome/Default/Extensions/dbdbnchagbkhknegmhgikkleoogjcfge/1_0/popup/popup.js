var Popup=(new function(){function e(e,t,n){switch(e.command){case"connectionInfoEvent":c.onConnectionInfo(e)}}function t(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("options/options.html"))}function n(){chrome.tabs.create({url:"https://www.hideman.net"})}function o(e){var t=e.currentTarget.getAttribute("data-type"),n="";switch(Log.i("want to share hideman via "+t),t){case"facebook":n="https://www.facebook.com/sharer/sharer.php?u="+a;break;case"twitter":n="https://twitter.com/share?url="+a+"&via=HidemanLtd&text="+l;break;case"google":n="https://plus.google.com/share?url="+a;break;case"vk":n="http://vk.com/share.php?noparse=false&url="+a;break;default:return Log.i("failed to detect social network type"),!1}chrome.windows.create({url:n,width:600,height:600,focused:!0,type:"popup"})}function s(e){return e.target.checked?(Log.i("connect"),chrome.extension.sendMessage({command:"connect"})):(Log.i("disconnect"),chrome.extension.sendMessage({command:"disconnect"})),!0}function r(){var e=document.querySelector("div.server__item--waiting");e&&e.classList.toggle("server__item--waiting",!1)}function i(e){var t=e.target.dataset.type;if(t){var n=e.target.classList.contains("radio__button--active");Log.i("click "+t+"Button "+n),chrome.tabs.getSelected(null,function(e){n?ListStorage.elementByUrl(t,e.url,function(e){e?(ListStorage.removeElementByValue(t,e,function(){}),chrome.extension.sendMessage({command:"listsWasUpdateFromPopup"}),Log.i("remove from "+t)):(c.onListChanged(),Log.i("not found in "+t))}):(ListStorage.addElementToList(t,e.url),chrome.extension.sendMessage({command:"listsWasUpdateFromPopup"}),Log.i("add to "+t))})}}var c=this,a=encodeURIComponent("https://hmn.me/chr-ext"),l=encodeURIComponent(chrome.i18n.getMessage("share_ext_text"));c.init=function(){return Log.i("starting popup element"),i18n.localizeHtml(),c.bindElements(),chrome.runtime.onMessage.addListener(e),chrome.extension.sendMessage({command:"getCountries"},c.onCountries),chrome.extension.sendMessage({command:"getConnectionInfo"},c.onConnectionInfo),ListStorage.onChanged.addEventListener(c.onListChanged),c.onListChanged(),c},c.bindElements=function(){c.proxy_status=document.getElementById("proxy_status"),c.server_title=document.getElementById("server_title"),c.server_template=document.getElementById("server_template").innerHTML,c.buy_servers=document.getElementById("buy_servers"),c.list_buttons=[],["white","black"].forEach(function(e){c.list_buttons[e]=document.getElementById(e+"_list"),c.list_buttons[e].onclick=i,c.list_buttons[e].dataset.type=e}),c.proxy_status.onchange=s,document.getElementById("settings").onclick=t,document.getElementById("hidemanLogoLink").onclick=n;for(var e=document.querySelectorAll("A.social-ico"),r=0;r<e.length;r++)e[r].onclick=o},c.onConnectionInfo=function(e){Log.i("current location updated: "+JSON.stringify(e)),c.proxy_status.checked=e.isVpn,r();var t=servers_list.querySelector('div.server__item[data-country="'+e.countryCode.toUpperCase()+'"]'),n=servers_list.querySelector("div.server__item--active");n&&n.classList.toggle("server__item--active",!1),t.classList.toggle("server__item--active",!0)},c.onCountries=function(e){var t=e.countries,n=document.getElementById("servers_list");n.innerHTML="",Log.i("servers update message received"+JSON.stringify(t));for(var o=0;o<t.length;o++){var s=c.server_template.replace(/%country_code%/g,t[o].code.toUpperCase()),i=chrome.i18n.getMessage(t[o].code);s=s.replace(/%country_name%/g,i),n.innerHTML+=s}for(var a=0;a<n.children.length;a++)n.children[a].onclick=function(e){var t=e.currentTarget,n=t.dataset.country;return t.classList.contains("server__item--active")?void(proxy_status.checked||chrome.extension.sendMessage({command:"connect"})):(r(),t.classList.toggle("server__item--waiting",!0),chrome.extension.sendMessage({command:"selectCountry",country:n.toLowerCase()}),proxy_status.checked||chrome.extension.sendMessage({command:"connect"}),void Log.i("want to establish connection with "+n))};e.isFull?(c.buy_servers.style.display="none",c.server_title.innerText=chrome.i18n.getMessage("all_servers")):(c.buy_servers.style.display="block",c.server_title.innerText=chrome.i18n.getMessage("free_servers"))},c.onListChanged=function(){chrome.tabs.getSelected(null,function(e){[ListStorage.Types.white,ListStorage.Types.black].forEach(function(t){ListStorage.contains(t,e.url,function(n){Log.i("check "+e.url+" in "+t+" "+n),c.list_buttons[t].classList.toggle("radio__button--active",n)})})})}}).init();