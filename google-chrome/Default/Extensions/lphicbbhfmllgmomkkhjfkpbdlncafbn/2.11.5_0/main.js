(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{8372:function(ge,le,O){O.d(le,{S:function(){return d}});var m,ie=O(8774),q=O.n(ie),I=O(4762),x=O(7256),Y=O(9433),B=O(7301),E=O(5848),d=((m={domain:"letyshops.com"})._root="https://".concat(m.domain),m._api="https://".concat("eapi.letyshops.com","/eapi"),m._club="https://".concat("club.letyshops.com"),m._help="https://".concat("help.letyshops.com"),m._tools="https://".concat("tools.letyshops.com"),m.cookieKey="uid",m.configService=new x.E,m.updateUrlsApi=function(){return(0,I.mG)(void 0,void 0,void 0,q().mark(function b(){var A;return q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if("undefined"==typeof framework){F.next=11;break}if(!(Object.keys(framework).length>2)){F.next=10;break}return F.next=4,m.configService.getParameter(x.E.UPDATE_INTERVAL_URLS);case 4:A=F.sent,$.ajax({url:"".concat(m._api,"/urls"),type:"GET",dataType:"json",success:function(R){R&&(R&&R.siteUrl&&(m.domain=new URL(R.siteUrl).hostname,m._root=R.siteUrl,m._link=R.siteUrl),R&&R.apiUrl&&(m._api="".concat(R.apiUrl,"/eapi")),R&&R.apiUrl&&R.cdnUrl&&(m._cdn="".concat(R.cdnUrl,"/eapi")),R&&R.clubUrl&&(m._club=R.clubUrl),R&&R.helpUrl&&(m._help=R.helpUrl),R&&R.toolsUrl&&(m._tools=R.toolsUrl),B.V.set("dataUrls",R))},error:function(R,G,K){console.error("".concat(G,":").concat(K))}}),clearInterval(m.intervalupdateUrlsApiHandlerTimer),m.intervalupdateUrlsApiHandlerTimer=setInterval(function(){m.updateUrlsApi()},A),F.next=11;break;case 10:B.V.get("dataUrls",function(C){C?(C&&C.siteUrl&&(m.domain=new URL(C.siteUrl).hostname,m._root=C.siteUrl,m._link=C.siteUrl),C&&C.apiUrl&&(m._api="".concat(C.apiUrl,"/eapi")),C&&C.apiUrl&&C.siteUrl&&C.cdnUrl&&(m._cdn="".concat(C.cdnUrl,"/eapi")),C&&C.clubUrl&&(m._club=C.clubUrl),C&&C.helpUrl&&(m._help=C.helpUrl),C&&C.toolsUrl&&(m._tools=C.toolsUrl)):m.updateUrlsApi()});case 11:case"end":return F.stop()}},b)}))},m.getSettings=function(){return(0,I.mG)(void 0,void 0,void 0,q().mark(function b(){var A;return q().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!("undefined"!=typeof framework&&Object.keys(framework).length>2)){F.next=7;break}return F.next=3,m.configService.getParameter(x.E.UPDATE_INTERVAL_SETTINGS);case 3:A=F.sent,$.ajax({url:"".concat(m._cdn?m._cdn:m._api,"/settings?version-ext=").concat(chrome.runtime.getManifest().version),type:"GET",dataType:"json",success:function(R){if(R){if(B.V.set("settings",R),R.updateIntervals||R.updateEndTimeFeatures){var G={};R.updateIntervals&&_.each(Object.keys(R.updateIntervals),function(K,u){switch(K){case"shops":G[x.E.UPDATE_INTERVAL_MERCHANT]=Object.values(R.updateIntervals)[u];break;case"lety-codes":G[x.E.UPDATE_INTERVAL_CODES]=Object.values(R.updateIntervals)[u];break;case"settings":G[x.E.UPDATE_INTERVAL_SETTINGS]=Object.values(R.updateIntervals)[u];break;case"urls":G[x.E.UPDATE_INTERVAL_URLS]=Object.values(R.updateIntervals)[u];break;case"promo-notifications":G[x.E.PROMO_NOTIFY_PERIOD]=Object.values(R.updateIntervals)[u];break;case"dd-list":G[x.E.R_LIST_ADD_PERIOD]=Object.values(R.updateIntervals)[u];break;case"user_notifications":G[x.E.USER_NOTIFY_INTERVAL]=Object.values(R.updateIntervals)[u];break;case"user_cashback_rates":G[x.E.INTERVAL_COUNT_USER_CASHBACK_RATES]=Object.values(R.updateIntervals)[u];break;case"segment_settings":G[x.E.INTERVAL_COUNT_SETTINGS_BY_SEGMENT]=Object.values(R.updateIntervals)[u];break;case"user_update_force":G[x.E.UPDATE_INTERVAL_USER_FORCE]=Object.values(R.updateIntervals)[u];break;case"simple_similar_settings":G[x.E.INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR]=Object.values(R.updateIntervals)[u];break;case"user_autopromo_update":G[x.E.UPDATE_INTERVAL_AUTOPROMO]=Object.values(R.updateIntervals)[u];break;case"interval_shopping_trip_id":G[x.E.INTERVAL_SHOPPING_TRIP_ID]=Object.values(R.updateIntervals)[u];break;case"update_interval_info_similar":G[x.E.UPDATE_INTERVAL_INFO_SIMILAR]=Object.values(R.updateIntervals)[u]}}),R.updateEndTimeFeatures&&_.each(Object.keys(R.updateEndTimeFeatures),function(K,u){"greenLightBookingEndTime"===K&&(G[x.E.GREEN_LIGHT_BOOKING_END_TIME]=Object.values(R.updateEndTimeFeatures)[u])}),m.configService.updateConfig(G)}R.autoUpdate.shops&&framework.extension.fireEvent(Y.g.UPDATE_MERCHANTS_RATES,{})}},error:function(R,G,K){console.error("".concat(G,":").concat(K))}}),clearInterval(m.intervalupdateSettingsApiHandlerTimer),m.intervalupdateSettingsApiHandlerTimer=setInterval(function(){m.getSettings()},A);case 7:case"end":return F.stop()}},b)}))},m.updateUrlsApi(),m.getSettings(),m.getRoot=function(){return"".concat(m._root,"/")},m.getLink=function(){return m._link?"".concat(m._link,"/"):m.getRoot()},m.afterInstall=function(){var b=E.cQ.getFullInfo().browser===Y.g.BROWSER_NAME_YABROWSER?"yabrowser":framework.browser.name.toLowerCase();return"".concat(m._root,"/extension?action=install&utm_source=extension&utm_campaign=install&utm_term=").concat(b)},m.afterDelete=function(){var b=E.cQ.getFullInfo().browser===Y.g.BROWSER_NAME_YABROWSER?"yabrowser":framework.browser.name.toLowerCase();return"".concat(m._root,"/extension?action=uninstall&utm_source=extension&utm_campaign=uninstall&utm_term=").concat(b)},m.user=function(){return"".concat(m._api,"/user")},m.cashRates=function(){return"".concat(m._api,"/cashback-rates")},m.userCashbackRates=function(b){return"".concat(m._api,"/cashback-rates/").concat(b)},m.userCodes=function(){return"".concat(m._api,"/user/lety-codes")},m.favoriteMerchants=function(){return"".concat(m._api,"/user/shops-liked")},m.deleteFavoriteMerchant=function(){return"".concat(m._api,"/user/shops-disliked")},m.merchants=function(){return"".concat(m._cdn?m._cdn:m._api,"/shops")},m.recommendMerchants=function(){return"".concat(m._api,"/user/shops-recomended")},m.getUserNotifications=function(){return"".concat(m._api,"/user/notifications")},m.advices=function(){return"".concat(m._api,"/user/advices")},m.userNotificationLogs=function(){return"".concat(m._api,"/user/notifications/logs")},m.interstitialPage=function(){return"".concat(m._root,"/")},m.interstitialPageLogIn=function(b){var A=b||framework.browser.name.toLowerCase();return"".concat(m._root,"?auth=1&utm_source=extension&utm_campaign=popup_login&utm_term=").concat(A)},m.accountPage=function(b){var A=b||framework.browser.name.toLowerCase();return"".concat(m._root,"/user?utm_source=extension&utm_campaign=popup_user&utm_term=").concat(A)},m.allStoresPage=function(b){var A=b||framework.browser.name.toLowerCase();return"".concat(m._root,"/shops?utm_source=extension&utm_campaign=shops&utm_term=").concat(A)},m.helpPage=function(b){var A=framework.browser.name.toLowerCase();return"".concat(m._help,"/hc/").concat(b,"/sections/360000147845?utm_source=extension&utm_campaign=support&utm_content=zendesk&utm_term=").concat(A)},m.confidentialPage=function(){var b=framework.browser.name.toLowerCase();return"".concat(m._root,"/confidential?utm_campaign=confidential&utm_content=zendesk&utm_source=extension&utm_term=").concat(b)},m.reasonCashbackReactivate=function(){var b=framework.browser.name.toLowerCase();return"".concat(m._root,"/re-activate-cashback-message?utm_source=extension&utm_campaign=notification_re_activate_cashback&utm_term=").concat(b)},m.logInstall=function(){return"".concat(m._api,"/extension/install")},m.logRequest=function(){return"".concat(m._api,"/extension/request")},m.logUserSettings=function(){return"".concat(m._api,"/user/extension-settings")},m.ddList=function(){return"".concat(m._cdn?m._cdn:m._api,"/dd-list")},m.partner=function(){return"".concat(m._root,"/cashbacklink")},m)},9433:function(ge,le,O){O.d(le,{g:function(){return I}});var ie=O(7289),q=O(5134),I=(0,ie.Z)(function x(){(0,q.Z)(this,x)});I.DEBUG=!1,I.LEVEL_ERROR=0,I.LEVEL_WARNING=1,I.LEVEL_INFO=2,I.LEVEL_ERROR_COLOR="#f44336",I.LEVEL_WARNING_COLOR="#ffcc00",I.LEVEL_INFO_COLOR="#00c853",I.LEVEL_ERROR_STATUS="bad",I.LEVEL_WARNING_STATUS="stranger",I.LEVEL_INFO_STATUS="good",I.TYPE_NO_CHANGE=0,I.TYPE_MINOR_DOWN=1,I.TYPE_DOWN=2,I.TYPE_MINOR_DOWN_AFTER_UP=3,I.TYPE_MINOR_UP_AFTER_DOWN=4,I.TYPE_UP=5,I.TYPE_MINOR_UP=6,I.BROWSER_NAME_IE="Internet Explorer",I.BROWSER_NAME_FF="Firefox",I.BROWSER_NAME_CHROME="Chrome",I.BROWSER_NAME_OPERA="Opera",I.BROWSER_NAME_SAFARI="Safari",I.BROWSER_NAME_YABROWSER="YaBrowser",I.PARAMETER_DEEP_LINK="?ext_referrer=",I.APP_TOKEN="Owmeaiaiwlsn3444_aasi344Mgoak",I.REGEX_ACT_MIN_PRICE=/window\.runParams\.actMinPrice="(.+)";/gim,I.REGEX_ACT_MAX_PRICE=/window\.runParams\.actMaxPrice="(.+)";/gim,I.REGEX_MIN_PRICE=/window\.runParams\.minPrice="(.+)";/gim,I.REGEX_MAX_PRICE=/window\.runParams\.maxPrice="(.+)";/gim,I.REGEX_BASE_CURRENCY_CODE=/window\.runParams\.baseCurrencyCode="(.+)";/gim,I.REGEX_REGION_COUNTRY_NAME=/window\.runParams\.regionCountryName="(.+)";/gim,I.REGEX_REGION_PROVINCE_NAME=/window\.runParams\.regionProvinceName="(.+)";/gim,I.REGEX_REGION_CITY_NAME=/window\.runParams\.regionCityName="(.+)";/gim,I.REGEX_ALI_PRODUCT_ID=/^\/(?:item(?:\/.*)?\/|s\/item(?:\/.*)?\/|store\/product(?:\/.*)?\/\d+_|\d+\-)([\d]+)(?:\-detail)?\.html/,I.REGEX_GEARBEST_PRODUCT_ID=/^(?:\/.*)?\/pp_([\d]+)\.html/,I.REGEX_BANG_GOOD_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?\-p\-([\d]+)\.html/,I.REGEX_BANG_GOOD_US_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?\-wp\-Usa\-([\d]+)\.html/,I.REGEX_BANG_GOOD_EU_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?\-wp\-Eu\-([\d]+)\.html/,I.REGEX_LIGHT_IN_THE_BOX_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?_p([\d]+)\.html/,I.REGEX_TOM_TOP_PRODUCT_ID=/^(?:\/.*)?\/p\-(.+)\.html/,I.CHECK_LETYSHOPS=/letyshops\.[\w]+/gim,I.CHECK_LETYSHOPS_VIEW=/letyshops\.[\w]+\/[\w-_\/]*[view|short\-link]\/(\d+)/gim,I.CHECK_LETYSHOPS_GO=/letyshops\.[\w]+\/[\w-_\/]*[view|short\-link]\/(\d+)\/go/gim,I.CHECK_LETYSHOPS_VIEW_OR_GO=/letyshops\.[\D]+\/*[view|short\-link|shops]\/(\d+)/gim,I.REG_URL=/(https?:\/\/[^\s]+)/g,I.ARRAY_MERCHANTS_PRICE=[13366481,17292915,17289199,15131011,15131239,13433222,13083906,15223074],I.ARRAY_MERCHANTS_PRICE_SELLER=[13366481,17292915,17289199],I.COMMUNICATION_EVENT_NAME_PREFIX="LETYSHOPS_",I.LOGIN_TOKEN="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"LOGIN_TOKEN"),I.POPUP_FIRST_OPENING_TOKEN="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_FIRST_OPENING_TOKEN"),I.CASHBACK_ACTIVATE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"CASHBACK_ACTIVATE"),I.PROMO_ACTIVATE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"PROMO_ACTIVATE"),I.NOTIFICATION_CASHBACK_ACTIVATE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"NOTIFICATION_CASHBACK_ACTIVATE"),I.NOTIFICATION_DISMISS="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"NOTIFICATION_DISMISS"),I.USER_NOTIFICATION_DISMISS="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"USER_NOTIFICATION_DISMISS"),I.NOTIFICATION_GET_INFO="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"NOTIFICATION_GET_INFO"),I.NOTIFICATION_RENDER_LETYSHOPS_BAR="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"NOTIFICATION_RENDER_LETYSHOPS_BAR"),I.NOTIFICATION_RENDER_LETYSHOPS_BAR_ALI="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"NOTIFICATION_RENDER_LETYSHOPS_BAR_ALI"),I.CLOSE_ALL_NOTIFICATION="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"CLOSE_ALL_NOTIFICATION"),I.UPDATE_MERCHANTS_HOT_PRODUCTS="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"UPDATE_MERCHANTS_HOT_PRODUCTS"),I.GET_EXTENSION_INFO="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"GET_EXTENSION_INFO"),I.SEND_EXTENSION_INFO="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"SEND_EXTENSION_INFO"),I.SEND_PAGE_INFO="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"SEND_PAGE_INFO"),I.OFFLINE_LIKES="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"OFFLINE_LIKES"),I.SAW_REWRITE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"SAW_REWRITE"),I.BUTTON_UPDATE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"BUTTON_RED"),I.SET_NOTIFICATIONS_POPUP="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"SET_NOTIFICATIONS_POPUP"),I.TAB_WAS_CHANGED="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"TAB_WAS_CHANGED"),I.SEND_USER_SETTINGS="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"SEND_USER_SETTINGS"),I.CHECK_PAGE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"CHECK_PAGE"),I.GET_NATIVE_USER_AGENT="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"GET_NATIVE_USER_AGENT"),I.MERCHANT_SUPPRESSED="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"MERCHANT_SUPPRESSED"),I.POPUP_MERCHANTS_UPDATE="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_MERCHANTS_UPDATE"),I.POPUP_TO_NOTIFICATION_TAB="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_TO_NOTIFICATION_TAB"),I.POPUP_TO_INVITATION_TAB="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_TO_INVITATION_TAB"),I.POPUP_TO_MERCHANT_CARD="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_TO_MERCHANT_CARD"),I.POPUP_INITIALIZE_FOOTER_FOR_STORES="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_INITIALIZE_FOOTER_FOR_STORES"),I.POPUP_UPDATE_FOOTER="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_UPDATE_FOOTER"),I.POPUP_TO_UPDATE_FAVORITE_STATUS="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_TO_UPDATE_FAVORITE_STATUS"),I.POPUP_PUSH_REVIEWED_NOTIFY="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"POPUP_PUSH_REVIEWED_NOTIFY"),I.USER_APPLIED_LETY_CODES="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"USER_APPLIED_LETY_CODES"),I.UPDATE_MERCHANTS_RATES="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"UPDATE_MERCHANTS_RATES"),I.GET_INFO_USER="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"GET_INFO_USER"),I.CREATE_ADVICES="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"CREATE_ADVICES"),I.RETURN_ADVICE_LINK="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"RETURN_ADVICE_LINK"),I.REFRESH_ALL="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"REFRESH_ALL"),I.SHOW_SIMILAR_PRODUCTS="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"SHOW_SIMILAR_PRODUCTS"),I.GET_MERCHANT_BY_DOMAIN="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"GET_MERCHANT_BY_DOMAIN"),I.INVOKE_IMAGE_SEARCH_CONTEXT_MENU="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"INVOKE_IMAGE_SEARCH_CONTEXT_MENU"),I.GET_IMAGE_INITIAL_BASE_64="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"GET_IMAGE_INITIAL_BASE_64"),I.USER_APPLIED_AUTOPROMO="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"USER_APPLIED_AUTOPROMO"),I.GET_SIMPLE_SIMILAR_DOMAIN_DATA="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"GET_SIMPLE_SIMILAR_DOMAIN_DATA"),I.TAB_CHANGED="".concat(I.COMMUNICATION_EVENT_NAME_PREFIX,"TAB_CHANGED"),I.HISIORY_LENGTH=10,I.GLOBAL_HISTORY_LENGTH=100,I.POPUP_WIDTH=470,I.POPUP_HEIGHT=560,I.TAB_STATE_3RD_PARTY=2,I.TAB_STATE_INTERSTITIAL_REDIRECT=3,I.FOOTER_ALL_STORES=1,I.FOOTER_ALL_OFFERS=2,I.FOOTER_LABEL=0,I.FOOTER_ADVICE=!0,I.THIRD_PARTY_LINKS=["event.2parale.ro","www.awin1.com","partners.webmasterplan.com","web.epartner.es","clic.reussissonsensemble.fr","being.successfultogether.co.uk","anrdoezrs.net","t.dgm-au.com","google.com/aclk?sa","pepperjamnetwork.com","aos.prf.hn","ad.zanox.com","rover.ebay.com","track.commissionfactory.com.au","clk.tradedoubler.com","tkqlhce.com","partnerprogramma.bol.com","tc.tradetracker.net","tr.rdrtr.com","lead-analytics.nl","partners.adtriplex.com","action.metaffiliation.com","smart4ads.com","gr.linkwi.se","tracking.publicidees.com","fls.doubleclick.net","gan.doubleclick.net","click.linksynergy.com","v2.afilio.com.br","jdoqocy.com","send.onenetworkdirect.net",".7eer.net",".evyy.net",".ojrq.net","affiliate.buy.com","affiliate.rakuten.com","affiliates.abebooks.com","affiliates.babiesrus.com","affiliates.toysrus.com","afsrc=1","aos.prf.hn","commission-junction.com","dpbolvw.net","dpbolvw.net","google.com/aclk","gopjn.com","goto.orientaltrading.com","goto.target.com","goto.target.com/c/","kqzyfj.com","partners.hotwire.com","pepperjamnetwork.com","pjatr.com","pjtra.com","pntra.com","pntrs.com","prf.hn","qksrv.net","shareasale.com","t.dgm-au.com","www.linkconnector.com","apytrc.com","ams.apypx.com"],I.gaPrefix="/_extension/",I.gaPageShops="".concat(I.gaPrefix,"shops/"),I.gaPagePopup="".concat(I.gaPrefix,"popup/"),I.gaPageSales="".concat(I.gaPrefix,"sales/"),I.gaPageFriends="".concat(I.gaPrefix,"friends/"),I.gaPageHistory="".concat(I.gaPrefix,"history/"),I.gaPageSettings="".concat(I.gaPrefix,"settings/"),I.gaDisabledShop="".concat(I.gaPagePopup,"no-extension/"),I.gaLetyClub="".concat(I.gaPagePopup,"letyclub/"),I.gaPrefixMonitor="_monitor/",I.gaPrefixSimilar="_recommendation/",I.gaPageSimilarShow="".concat(I.gaPrefixSimilar,"show/"),I.gaPrefixAdvices="_partner_link/",I.gaPageAdvices="".concat(I.gaPrefixAdvices,"show/"),I.aliexpressID=13366481,I.aliexpressWWID=17292915,I.DEFAULT_LANGUAGE="en",I.DEFAULT_COUNTRY="001",I.CHECK_LOCALE_COOKIE="hl",I.PERMISSIONS_SEGMENTS={similar:["web.ex_726_similar_test_5"],simpleSimilar:["web.SS-test-group-5-teaser"],extTestQ1:["web.test_ext_q1"],bestDeals:["web.best_deals"]},I.NOTIFICATION_RECIPIENT="extension",I.NO_ALI_AFFILIATE_COUNTRY=["RU","AM","AZ","BY","GE","KG","KZ","TJ","TM","UZ","MD"],I.BOOKING_ID=13810496,I.DEFAULT_USER_SETTINGS={showPrice:!0,showUserNotifications:!0,showPromoNotifications:!0,showCashbackHints:!0,showSimilarListInjection:!0,showSimpleSimilarInjection:!0,allowTabUrlCollect:!0,allowAnalyticsCollect:!0},I.DEFAULT_FIREFOX_USER_SETTINGS={showPrice:!1,showUserNotifications:!0,showPromoNotifications:!0,showCashbackHints:!0,showSimilarListInjection:!1,showSimpleSimilarInjection:!0,allowTabUrlCollect:!1,allowAnalyticsCollect:!1},I.PROMO_NOTIFY_INTERVAL=12e4,I.UPDATE_INTERVAL_ACTIVATE=36e5,I.UPDATE_INTERVAL_USER=6e4,I.UPDATE_INTERVAL_USER_NOTIFICATION=36e5,I.UPDATE_LOG_REQUEST=864e5,I.INTERVAL_PUSH_LOG_REQUEST=3e5,I.INTERVAL_PUSH_LOG=6e4,I.UPDATE_INTERVAL_INFO_HISTORY_PRICE=6e5,I.INTERVAL_SHOW_NOTIFICATION_MARKET=36e5,I.PERIOD_DISABLED_FOR_HOUR=36e5,I.SIMPLE_SIMILAR_VIEWS_SETTINGS={frequency_view_page:10,frequency_view_time:3e5},I.PERIOD_DISABLED_BAR=36e5,I.SIMILAR_MINIMIZED_TYPE_VIEW_PERIOD=36e5,I.CLEAR_CACHE_INTERVAL=18e5,I.HIDE_NOTIFICATION_TIME=9e5,I.CURRENCY_LIST={PERCENT:"%",RUB:"\u0440\u0443\u0431.",RUR:"\u0440\u0443\u0431.",USD:"$",EUR:"\u20ac",UAH:"\u0433\u0440\u043d.",KZT:"\u0442\u0433.",BYR:"Br",BYN:"Br",PLN:"z\u0142",GBP:"\xa3",MXN:"MXN",ARS:"ARS",CLP:"CLP",COP:"COP",BRL:"R$",PEN:"S/",CAD:"C$",AUD:"A$",NZD:"NZ$",ZAR:"R",INR:"Rs",PHP:"\u20b1",AED:"Dhs"}},5857:function(ge,le,O){O.d(le,{Z:function(){return x}});var ie=O(6054),q=O(5134),I=O(7289),x=function(){function Y(){(0,q.Z)(this,Y)}return(0,I.Z)(Y,null,[{key:"_getParentsSelectors",value:function(){return["header","#header",".header","#header-main",".header-main","#head",".head","#menu",".menu","footer","#footer",".footer","#footerNav",".footerNav"]}},{key:"_getTopExactSites",value:function(){return["letyshops.com","letyshops.ru","mail.ru","gmail.com","lenta.ru","drom.ru","rambler.ru","rbc.ru","iz.ru","mk.ru","hh.ru","gazeta.ru","vesti.ru","ngs.ru","2gis.ru","pikabu.ru","rt.com","rg.ru","farpost.ru","life.ru","woman.ru","smi2.ru","sport-express.ru","cosmo.ru","echo.msk.ru","aif.ru","fishki.net","glavbukh.ru","irecommend.ru","championat.com","eg.ru","lentainform.com","rutube.ru","tass.ru","cian.ru","zaycev.net","e1.ru","sportbox.ru","teleprogramma.pro","dni.ru","russianfood.com","mirtesen.ru","yaplakal.com","vz.ru","360tv.ru","babyblog.ru","rusprofile.ru","wday.ru","baby.ru","starhit.ru","banki.ru","rugion.ru","kommersant.ru","ura.ru","nbs.su","tvzvezda.ru","superjob.ru","vokrug.tv","ren.tv","russian7.ru","inosmi.ru","1mediainvest.ru","4pda.ru","riafan.ru","progorod43.ru","animevost.org","svpressa.ru","1tv.ru","mediafort.ru","rabota.ru","7dn.ru","7ya.ru","tnt-online.ru","rlsnet.ru","regnum.ru","kulturologia.ru","ntv.ru","utro.ru","fotostrana.ru","avtovzglyad.ru","tophotels.ru","fssprus.ru","povar.ru","irr.ru","rutracker.org","news.ru","hsdigital.ru","kp.ru","ria.ru","hearst-shkulev-media.ru","rt.com","rsport.ru","habr.com"]}},{key:"_getTopSites",value:function(){return["yandex","ya","vkontakte","vk","google","youtube","facebook","ok","odnoklassniki","twitter","instagram","localhost"]}},{key:"checkTopSites",value:function(){return new Promise(function(E){var d=Y,b=window.location.hostname.toLowerCase(),A=window.location.host.toLowerCase();if(0===b.indexOf("market.yandex"))return E(0);var D=b.match(/(^|\.)[-\d\w]{2,256}\.(com|com\.ua|ru|msk\.ru|by|pro|info|ua|su|tv|net|xn--p1ai)$/gim);if(D&&D.length){var F=d._getTopSites(),C=D[0].split(".").filter(Boolean),R=C[0];if(F.indexOf(R)>=0)return E(-1e3);var G=d._getTopExactSites(),K=C.join(".");if(G.indexOf(K)>=0)return E(-1e3)}return/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(A)||/:\d{2,}/.test(A)?E(-1e3):E(0)})}},{key:"checkHomePageOrStaticPages",value:function(){return new Promise(function(E){var d=window.location.pathname.toLowerCase().replace(/^\/+|\/+$/g,""),m=window.location.hash.toLowerCase(),b=window.location.search.toLowerCase(),D=["login","registration","auth","delivery","dostavka","contact","contacts","kontakti","kontakty","feedback","favorites","favorite","news","guaranty","services","blog","uslugi","garantiya","warranty","oplata","about-us","o-nas","payment","sitemap","forum","help","payment","kak_zakazat"];if(!m&&!b&&["","index.php","index.html","index.htm","index.aspx","default.aspx","index.asp","default.asp","catalog","shop","shops","opt","partner","job","vendors","basket","card","products","sale","about"].indexOf(d)>=0)return E(-1e3);for(var F=0;F<D.length;F++)if(d.indexOf(D[F])>=0)return E(-1e3);return E(0)})}},{key:"checkUrlRegExpTerms",value:function(){return new Promise(function(E){for(var d=window.location.pathname+window.location.search+window.location.hash,b=0,A=[/product\/category/gim];b<A.length;b++){if(A[b].test(d))return E(-.9)}for(var C=0,R=[/product_id[/=]\w+/gim,/productid[/=]\w+/gim,/product_ids[/=]\w+/gim,/product_by_id[/=]\w+/gim,/prod[/=]\w+/gim,/product[/=]\w+/gim,/products[/=]\w+/gim,/id_product[/=]\w+/gim,/idproduct[/=]\w+/gim,/product\d+/gim,/product_\d+/gim,/\/p\d+/gim,/\W+id[/=]\w+/gim,/\W+pid[/=]\w+/gim,/\W+uid[/=]\w+/gim,/\W+gid[/=]\w+/gim,/\W+uid_\d+/gim,/tid[/=]\w+/gim,/item_id[/=]\w+/gim,/item[/=]+/gim,/itm[/=]\w+/gim,/item\d+/gim,/idtov[/=]\w+/gim,/tovar_id[/=]\w+/gim,/tovarid[/=]\w+/gim,/produkt[/=]\w+/gim,/goodid[/=]\w+/gim,/good_id[/=]\w+/gim,/idgoods[/=]\w+/gim,/id_goods[/=]\w+/gim,/goods[/=]\w+/gim,/good[/=]\w+/gim,/good\d+/gim,/model_id[/=]\w+/gim,/modelid[/=]\w+/gim,/model[/=]\w+/gim,/articul[/=]\w+/gim,/offer_id[/=]\w+/gim,/offerid[/=]\w+/gim,/offer[/=]\w+/gim,/view\/\d+/gim,/show\/\d+/gim,/detail\/\w+/gim,/catalog\/\d+\/\d+/gim];C<R.length;C++){if(R[C].test(d))return E(.9)}return E(0)})}},{key:"checkSortBlock",value:function(){return new Promise(function(E){var d=Y,m={select:"option",'[class*="dropdown"]':"li"},b=/(\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e|\u0434\u0435\u0448\u0435\u0432\u044b\u0445|\u0434\u0435\u0448\u0435\u0432\u043b\u0435|\u0434\u043e\u0440\u043e\u0436\u0435|\u0434\u043e\u0440\u043e\u0433\u0438\u043c|\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435|\u0446\u0435\u043d\u0435|\u0446\u0435\u043d\u0430|\u0432\u044b\u0441\u043e\u043a\u0430\u044f|\u043d\u0438\u0437\u043a\u0430\u044f|\u0438\u043c\u0435\u043d\u0438|\u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0443)/gim;for(var A in m)for(var D=d._findAll(document,A),F=0;F<D.length&&F<10;F++){var C=d._findAll(D[F],m[A]),R=C.length;if(R>2&&R<20){var G=C.map(function(u){return u.innerText}).join(" ").trim().toLowerCase();if(!G.length)break;var K=G.match(b);if(K&&K.length>=2)return E(-.4)}}return E(0)})}},{key:"checkSchemaTags",value:function(){return new Promise(function(E){var d=Y,m=d._findAll(document,'[itemtype*="schema.org/Product" i]').length;return m>0&&m<10?E(.8):m>=40?E(-.8):(m=d._findAll(document,'[itemtype*="schema.org/Offer" i]').length)>0&&m<10?E(.8):m>=40?E(-.8):E((m=d._findAll(document,'[itemtype*="schema.org/AggregateRating" i]').length)>0&&m<10?.8:m>=40?-.8:0)})}},{key:"checkMetaOGTag",value:function(){return new Promise(function(E){return E(1===Y._findAll(document,'meta[property="og:type"][content="product" i], meta[property="og:type"][content*="item" i]').length?.8:0)})}},{key:"_isHasParents",value:function(E,d,m){try{m||(m=50);for(var b=void 0!==d;null!==(E=E.parentElement)&&m-- >0;)if(E.nodeType===Node.ELEMENT_NODE&&(!b||E.matches(d)))return!0;return!1}catch(A){return!1}}},{key:"_checkVisibility",value:function(E,d){try{var m=getComputedStyle(E);return"none"===m.display||"visible"!==m.visibility||m.opacity<.1||E.offsetWidth+E.offsetHeight+E.getBoundingClientRect().height+E.getBoundingClientRect().width===0?!d:d}catch(b){return!1}}},{key:"_offset",value:function(E){var R,d=E.getBoundingClientRect(),b=function(R){return null!=R&&R===R.window};if(d.width||d.height){var A=E.ownerDocument,D=b(R=A)?R:9===R.nodeType&&R.defaultView,F=A.documentElement;return{top:d.top+D.pageYOffset-F.clientTop,left:d.left+D.pageXOffset-F.clientLeft}}return d}},{key:"_findSingle",value:function(E,d){var m=!1;-1!==d.indexOf(":visible")&&(d=d.replace(/:visible/gi,""),m=!0);var b,A=E.querySelector(d);return(!m||Y._checkVisibility(A,!0))&&(b=A),b}},{key:"_findAll",value:function(E,d){var m=!1;-1!==d.indexOf(":visible")&&(d=d.replace(/:visible/gi,""),m=!0);for(var b=[],A=E.querySelectorAll(d),D=0;D<A.length;D++)(!m||Y._checkVisibility(A[D],!0))&&b.push(A[D]);return b}},{key:"_findFirstFromSelector",value:function(E){var m,d=(0,ie.Z)(E);try{for(d.s();!(m=d.n()).done;){var b=m.value,A=Y._findAll(document,b);if(1===A.length){var D=A[0].getAttribute("content");if((!D||!D.length)&&(D=A[0].innerText),D&&D.length)return D}}}catch(F){d.e(F)}finally{d.f()}return null}},{key:"checkPriceTag",value:function(){return new Promise(function(E){for(var d=Y,A={"#price:visible":"text",".price .js-product-price":"text",".price:visible":"text",".price2:visible":"text",".price3:visible":"text",".prices:visible":"text",".bk_price:visible":"text",".product-price:visible":"text",".productPrice:visible":"text",".new-price:visible":"text",".item_current_price:visible":"text",".item_old_price:visible":"text",".item_price:visible":"text",".product__price:visible":"text",".b-products__price-value:visible":"text",".prod-price-new:visible":"text",".price-new:visible":"text",".totalPrice:visible":"text",".cena:visible":"text",".cena2:visible":"text","#cost:visible":"text",".cost:visible":"text",".price_block:visible":"text",".price-block:visible":"text",".item-price:visible":"text",".master_price:visible":"text",".prod_price:visible":"text",".amount:visible":"text",".pricebox:visible":"text",".shk-price:visible":"text",".default-price:visible":"text",".goods-price .goods-price__value":"text","[data-price]":"attr-data-price",uprice:"text",'[name="price_now" i]':"attr-value"},F=d._getParentsSelectors().join(","),C=0,R=['[itemtype*="//schema.org/Offer" i] meta[itemprop="price" i]','[itemtype*="//schema.org/Offer" i] [itemprop="price" i]','meta[itemprop="price" i]','[itemprop="price" i]','meta[property="product:price:amount" i]','[property="product:price:amount" i]'];C<R.length;C++){var G=R[C],K=d._findAll(document,G);if(1===K.length){var u=K[0].getAttribute("content");if((!u||!u.length)&&(u=K[0].innerText),u&&u.length&&u.length<100)return d.itemPrice=d.sanitizePrice(u),E(.8)}}var l=d.hasHtmlInDoc()?document.body.innerHTML.match(/["']*ecomm_totalvalue["']*\s*:\s*["']*\d+["']*\s*/gim):null;if(l&&1===l.length&&((l=l[0].match(/(\d+)/im))&&2===l.length))return d.itemPrice=d.sanitizePrice(l[1]),E(.8);if(window&&window.dataLayer&&window.dataLayer.length)for(var f=0;f<window.dataLayer.length;f++){var r=window.dataLayer[f];if(r&&r.ecommerce&&r.ecommerce.detail&&r.ecommerce.detail.products&&r.ecommerce.detail.products.hasOwnProperty("length")&&1===r.ecommerce.detail.products.length&&r.ecommerce.detail.products[0]&&r.ecommerce.detail.products[0].price)return d.itemPrice=d.sanitizePrice(r.ecommerce.detail.products[0].price+""),E(.8)}for(var s in A){var g=d._findAll(document,s).filter(function(U){var S=d._offset(U);return!(S.top>0&&(S.top>1300||S.top<120))&&!d._isHasParents(U,F)});if(1===g.length){if(!d.itemPrice){var o=void 0;(o=0===A[s].indexOf("attr-")?g[0].getAttribute(A[s].replace("attr-","")):g[0].innerText)&&((o=o.trim()).length>0&&o.length<100&&(d.itemPrice=d.sanitizePrice(o)))}return E(.8)}if(g.length>0&&g.length<=3){var p=void 0;for(var y in g){var T=void 0;if(T=0===A[s].indexOf("attr-")?g[y].getAttribute(A[s].replace("attr-","")):g[y].innerText,p||(p=T),!p||p!==T){p=null;break}}if(p&&"string"==typeof p&&p.length>1&&p.length<20)return d.itemPrice=d.sanitizePrice(p),E(.8)}}return E(0)})}},{key:"checkItemBlocks",value:function(){return new Promise(function(E){for(var b={".product:visible":!0,"#product-info:visible":!0,".product-info:visible":!0,".product__info:visible":!0,"#prod-info:visible":!0,".prod-info:visible":!0,"#products-item:visible":!0,".products-item:visible":!0,"#product-view:visible":!0,".product-view:visible":!0,"#product-data:visible":!0,".product-data:visible":!0,"#page-product:visible":!0,".page-product:visible":!0,'[name="product_id"]:visible':!1,".in-stock:visible":!1,"#product-description:visible":!0,".product-description:visible":!0,"#item-description:visible":!0,".item-description:visible":!0,".item-detail-page:visible":!0,".item_info_section:visible":!0,".product-text:visible":!0,"#product-gallery:visible":!0,"#product-attributes:visible":!0,".product-full-details:visible":!0,"#product-desc:visible":!0,".product_desc:visible":!0,".product_info:visible":!0,"#description:visible":!0,".b-good-description:visible":!0,".b-gallery:visible":!0,".product-description-specifications:visible":!0,".easyzoom:visible":!0,"#item-page:visible":!0,".item-page:visible":!0,"#item_page:visible":!0,".item_page:visible":!0,".good-wrapper:visible":!0,"#bk_product:visible":!0,".bk_product:visible":!0,"#product_inf:visible":!0,".product_inf:visible":!0,".productdetails:visible":!0,".productfull:visible":!0,".buy-block:visible":!0,".single-product-page:visible":!0,".itemInfo:visible":!0},A=0,D=Object.keys(b);A<D.length;A++){var F=D[A],C=Y._findAll(document,F);if(!(1!==C.length||b[F]&&(C[0].clientHeight<200||C.clientWidth<400)))return E(.8)}return E(0)})}},{key:"checkAddToCartButton",value:function(){return new Promise(function(E){for(var d=Y,F=["\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443","\u043a\u0443\u043f\u0438\u0442\u044c \u0438\u043b\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443","\u043e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437","\u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443","to cart","buy it","\u043a\u0443\u043f\u0438\u0442\u044c \u0441\u0435\u0439\u0447\u0430\u0441","\u043a\u0443\u043f\u0438\u0442\u044c \u0432 \u043e\u0434\u0438\u043d \u043a\u043b\u0438\u043a","\u043a\u0443\u043f\u0438\u0442\u044c \u0432 1 \u043a\u043b\u0438\u043a","\u043a\u0443\u043f\u0438\u0442\u044c \u0437\u0430","\u0434\u043e \u043a\u043e\u0448\u0438\u043a\u0430","\u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0437\u0430\u043a\u0430\u0437","\u0437\u0430\u043a\u0430\u0437 \u0432 \u043e\u0434\u0438\u043d \u043a\u043b\u0438\u043a","\u0437\u0430\u043a\u0430\u0437 \u0432 1 \u043a\u043b\u0438\u043a","\u043d\u0435\u0442 \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438","\u043d\u0435\u0442 \u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435","\u043d\u0435\u0442 \u0432 \u043f\u0440\u043e\u0434\u0430\u0436\u0435","\u0442\u043e\u0432\u0430\u0440 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442","\u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435","\u0443\u0432\u0435\u0434\u043e\u043c\u0438\u0442\u044c \u043e \u043f\u043e\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0438","\u0443\u0437\u043d\u0430\u0442\u044c \u043e \u043f\u043e\u044f\u0432\u043b\u0435\u043d\u0438\u0438","\u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0432 \u043c\u0430\u0433\u0430\u0437\u0438\u043d","\u0431\u044b\u0441\u0442\u0440\u0430\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0430","\u043a\u0443\u043f\u0438\u0442\u044c \u0432 \u043a\u0440\u0435\u0434\u0438\u0442","\u0432 \u043a\u0440\u0435\u0434\u0438\u0442","\u043a\u0443\u043f\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440","\u043f\u043e\u043b\u043e\u0436\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443"],C=["\u043a\u0443\u043f\u0438\u0442\u044c","buy","\u0437\u0430\u043a\u0430\u0437\u0430\u0442\u044c","\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442","\u0437\u0430\u043a\u0430\u0437"],R={"button:visible":["text","attrTitle"],"input:visible":["attrValue","attrTitle","attrAlt"],"a:visible":["text","attrTitle"],".btn:visible":["text","attrTitle"],"img:visible":["attrTitle","attrAlt"]},K=d._getParentsSelectors().join(","),u={},l=function(){var z=r[f],ee=d._findAll(document,z);if(ee.length>500)return"continue";ee.forEach(function(W){var J=d._offset(W);if(J.top>0&&(J.top>1300||J.top<140))return null;var X,k,te=(0,ie.Z)(R[z]);try{for(te.s();!(k=te.n()).done;){var ae=k.value;if("text"===ae?X=W.innerText:"attrTitle"===ae?X=W.getAttribute("title"):"attrAlt"===ae?X=W.getAttribute("alt"):"attrValue"===ae&&(X=W.getAttribute("value")),X)break}}catch(ve){te.e(ve)}finally{te.f()}if(!X||(!(X=X.toLowerCase().replace(/\s{2,}/g," ").trim()).length||X.length>50))return null;for(var he={},ue=!1,_e=0;_e<F.length;_e++){var Te="contain--"+z+"--"+_e;void 0===he[Te]&&(he[Te]=void 0===u[Te]?0:u[Te]),!(he[Te]>2)&&0===X.indexOf(F[_e])&&(he[Te]++,ue=!0)}for(var Pe=0;Pe<C.length;Pe++){var Oe="equal--"+z+"--"+Pe;void 0===he[Oe]&&(he[Oe]=void 0===u[Oe]?0:u[Oe]),!(he[Oe]>2)&&X===C[Pe]&&(he[Oe]++,ue=!0)}ue&&!d._isHasParents(W,K)&&(u=Object.assign(u,he))})},f=0,r=Object.keys(R);f<r.length;f++)l();for(var g=0,o=[".add-to-cart:visible",".add-to-basket:visible",".to-basket:visible",".buy-btn:visible",".buyButton:visible",".addtocart:visible",".toCart:visible"];g<o.length;g++){var p=o[g],y="selector--"+p,T=d._findAll(document,p);T.length>100||(u[y]=T.filter(function(V){var z=d._offset(V);return!(z.top>0&&(z.top>1300||z.top<140))}).length)}for(var U=0,S=Object.keys(u);U<S.length;U++){var H=S[U];if(u[H]>0&&u[H]<=2)return E(.8)}return E(0)})}},{key:"checkPaginator",value:function(){return new Promise(function(E){var d=Y,A=d._findAll(document,'[class*="pagination" i],[id*="pagination" i]:visible,[class*="paginator" i]:visible,[id*="paginator" i]:visible,[class*="pages" i]:visible,[id*="pages" i]:visible,[class*="page-navigation" i]:visible,[id*="page-navigation" i]:visible,[class*="pager" i]:visible,[id*="pager" i]:visible,[class*="paging" i]:visible,[data-pagination-num]:visible,[data-pagination]:visible').filter(function(D){var F=d._offset(D);return D.clientHeight&&D.clientHeight<300&&D.clientWidth&&F.top>150});return A.length&&A.map(function(D){return D.innerText}).join("").trim().length?E(-.8):E(0)})}},{key:"checkPagerParamsInUrl",value:function(){return new Promise(function(E){for(var m=window.location.pathname,b=0,A=[{reg:/page\/\d+/gim,score:-.9},{reg:/\Wpage-\d+/gim,score:-.9},{reg:/\/search/gim,score:-10},{reg:/\/search[/]/gim,score:-10}];b<A.length;b++){var D=A[b];if(D.reg.test(m))return E(D.score)}for(var C=window.location.search,R=0,G=[/page=\d+/gim,/sort=[\w.-_]+/gim,/order=[\w.-_]+/gim,/sorttype=[\w.-_]+/gim,/sort_type=[\w.-_]+/gim,/sortorder=[\w.-_]+/gim,/sort_order=[\w.-_]+/gim,/orderby=[\w.-_]+/gim,/order_by=[\w.-_]+/gim,/sortby=[\w.-_]+/gim,/sort_by=[\w.-_]+/gim,/[?&]search=/gim,/[?&]search_performed=/gim,/[?&]q=/gim,/[?&]search_term=/gim];R<G.length;R++){if(G[R].test(C))return E(-.9)}return E(0)})}},{key:"checkProductImage",value:function(){return new Promise(function(E){var d=Y;if(void 0!==d.checkProductImageCache)return E(d.checkProductImageCache);if(d.biggestImg={square:null,url:null},d._findSingle(document,'[property="og:type"][content="product"]')){var f=d._findSingle(document,'[property="og:image" i ]');f&&(d.biggestImg={square:Math.pow(9,9),url:f.getAttribute("content")})}var r=[],s=d._findAll(document,'img[src]:not([src*=".icon" i]):not([src*=".svg" i]):not([src*=".gif" i]):visible');if(s.length>200)return E(0);if(s.forEach(function(J){if(!J.complete)return null;var X=d._offset(J);if(X.top<150||X.top>1150||X.left<100||X.left>1920)return null;var te=J.clientWidth,k=J.clientHeight;if(te<100||k<100||J.naturalWidth<100||J.naturalHeight<100)return null;if(Number((te>=k?te/k:k/te).toFixed(2))>2.5)return null;var he=!1;if(d._isHasParents(J,"[id*=promo i],[id*=banner i],[id*=logo i],[class*=promo i],[class*=banner i],[class*=logo i]",8))return null;d._isHasParents(J,"[id*=carousel i],[id*=slider i],[id*=fancybox i],[class*=carousel i],[class*=slider i],[class*=fancybox i]",8)&&(he=!0);var ue=te*k;r.push({minTopCoef:Math.ceil(X.top/100),top:X.top,minLeftCoef:Math.ceil(X.left/100),left:X.left,width:te,height:k,square:ue,isCarousel:he}),ue>d.biggestImg.square&&(d.biggestImg.square=ue,d.biggestImg.url=J.src)}),r.length<1)return d.checkProductImageCache=0,E(d.checkProductImageCache);if(1===r.length){if(r[0].isCarousel)return d.checkProductImageCache=.7,E(d.checkProductImageCache)}else{var T,g=0,o={},p={},y=(0,ie.Z)(r);try{for(y.s();!(T=y.n()).done;){var U=T.value;U.isCarousel?g++:(U.minLeftCoef>0&&(void 0===o[U.minLeftCoef]&&(o[U.minLeftCoef]=0),o[U.minLeftCoef]++),U.minTopCoef>0&&(void 0===p[U.minTopCoef]&&(p[U.minTopCoef]=0),p[U.minTopCoef]++))}}catch(J){y.e(J)}finally{y.f()}var S=Object.keys(o),H=Object.keys(p);if(S.length>=3&&H.length>=2&&o[S[0]]>=2&&p[H[0]]>=3)return d.checkProductImageCache=-.8,E(d.checkProductImageCache);if(S.length>=1&&S.length<=2&&H.length>=4)for(var V=0,z=0,ee=Object.values(p);z<ee.length;z++){if(1===ee[z]&&V++,V>=4)return d.checkProductImageCache=-.2,E(d.checkProductImageCache)}if(g>=3)return d.checkProductImageCache=.4,E(d.checkProductImageCache)}return d.checkProductImageCache=0,E(d.checkProductImageCache)})}},{key:"checkPredefinedTextPatterns",value:function(){return new Promise(function(E){if(!Y.hasTextInDoc())return E(0);for(var m=document.body.innerText,b=0,A=[/\u043a\u043e\u0434(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u0430\u0440\u0442\u0438\u043a\u0443\u043b(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/id \u0442\u043e\u0432\u0430\u0440\u0430.{0,2}:.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u043d\u0430\u043b\u0438\u0447\u0438\u0435.{0,2}:.{0,2}(?:\u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435|\u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438|\u043f\u043e\u0434 \u0437\u0430\u043a\u0430\u0437|\u0435\u0441\u0442\u044c|\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442)/gi,/(?:\u043d\u0435\u0442|\u0435\u0441\u0442\u044c) \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438/gi,/\u0442\u043e\u0432\u0430\u0440 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442/gi,/\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043f\u0440\u043e\u0434\u0430\u0436\u0435/gi,/\u0442\u043e\u0432\u0430\u0440 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d/gi,/\u043d\u0435\u0442 \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438/gi,/\u043d\u0435\u0442 \u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435/gi,/\u0441\u043d\u044f\u0442 \u0441 \u043f\u0440\u043e\u0434\u0430\u0436\u0438/gi,/\u0443\u0437\u043d\u0430\u0442\u044c \u043e \u043f\u043e\u044f\u0432\u043b\u0435\u043d\u0438\u0438/gi];b<A.length;b++){var D=A[b],F=m.match(D);if(F&&1===F.length)return E(.2)}return E(0)})}},{key:"checkAmountPerPage",value:function(){return new Promise(function(E){for(var d=Y,m=["\u0432\u0441\u0435","\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435","all"],b=d._findAll(document,"select"),A=0;A<b.length&&A<10;A++){var D=d._findAll(b[A],"option");if(D.length>2&&D.length<8){for(var F=!1,C=0;C<D.length;C++){var R=D[C].innerText.trim().toLowerCase();if(!R.length){F=!1;break}if(m.indexOf(R)>=0)F=!0;else{var G=parseInt(R,10);if(!(G>0&&G.toString().length===R.length)){F=!1;break}F=!0}}if(F)return E(-.4)}}return E(0)})}},{key:"sanitizePrice",value:function(E){E=E.replace(new RegExp(String.fromCharCode(160),"g"),"");for(var d=0,m=[/\s+/g,/\u0440\u0443\u0431\.?/im,/\u0440\.?/im,/rub\.?/im,"\u0446\u0435\u043d\u0430","\u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c","\u0441\u043a\u0438\u0434\u043a\u0430",/['"]/g];d<m.length;d++){var b=m[d];E=E.replace(b,"")}var A=(E=E.replace(String.fromCharCode(160),"")).match(/(\d+[,.']?\d+)/im);return A&&A.length?A[0].trim():null}},{key:"searchProductInfo",value:function(){var E=Y,d={},m=['[itemtype*="//schema.org/Offer" i] meta[itemprop="name" i]','[itemtype*="//schema.org/Offer" i] [itemprop="name" i]','meta[itemprop="name" i]','[itemprop="name" i]','meta[property="product:retailer_title" i]','[property="product:retailer_title" i]'];if(!d.itemName){var b=E._findFirstFromSelector(m);b&&b.length&&(d.itemName=b.slice(0,512))}for(var A=0,D=m;A<D.length;A++){var F=D[A],C=E._findAll(document,F);if(1===C.length){var R=C[0].getAttribute("content");if((!R||!R.length)&&(R=C[0].innerText),R&&R.length){d.itemName=R.slice(0,512);break}}}if(void 0!==window&&void 0!==window.dataLayer&&window.dataLayer.hasOwnProperty("length"))for(var G=0;G<window.dataLayer.length;G++){var K=window.dataLayer[G];if(K&&K.ecommerce&&(K.ecommerce.currencyCode&&(d.currencyCode=K.ecommerce.currencyCode),K.ecommerce.detail&&K.ecommerce.detail.products&&K.ecommerce.detail.products.hasOwnProperty("length")&&1===K.ecommerce.detail.products.length&&K.ecommerce.detail.products[0])){var u=K.ecommerce.detail.products[0];!d.itemName&&u.name&&(d.itemName=u.name),u.brand&&(d.brand=u.brand),u.category&&(d.category=[u.category]);break}}return d}},{key:"getCurrencyCode",value:function(){var d=Y._findFirstFromSelector(['[property="product:price:currency" i]','[itemprop="priceCurrency" i]']);return d&&d.length?d:null}},{key:"getBrand",value:function(){var d=Y._findFirstFromSelector(['[property="product:brand" i]','[itemprop="brand" i]']);return d&&d.length?d:null}},{key:"getArticleId",value:function(){var d=Y;if(!d.hasTextInDoc())return null;for(var m=document.body.innerText,b=0,A=[/\u043a\u043e\u0434(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:?.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u0430\u0440\u0442\u0438\u043a\u0443\u043b(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:?.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u0430\u0440\u0442\.\s+(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/id \u0442\u043e\u0432\u0430\u0440\u0430.{0,2}:?.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi];b<A.length;b++){var D=A[b],F=m.match(D);if(F&&1===F.length&&((F=F[0].match(/[\d-_a-z]+/gim))&&F.length))return F[0]}return d._findFirstFromSelector(['[property="product:retailer_item_id" i]','[itemprop="sku" i]'])||null}},{key:"hasHtmlInDoc",value:function(){return document&&document.body&&document.body.innerHTML&&document.body.innerHTML.length}},{key:"hasTextInDoc",value:function(){return document&&document.body&&document.body.innerText&&document.body.innerText.length}},{key:"getCategories",value:function(){for(var E=Y,b=[],A=0,D=["#breadcrumb:visible",".breadcrumb:visible","#breadcrumbs:visible",".breadcrumbs:visible",".b-breadcrumbs:visible"];A<D.length;A++){var F=D[A],C=E._findAll(document,F);if(C.length){for(var R=E._findAll(C[0],"li"),G=0;G<R.length;G++){var K=R[G].innerText.trim();K.length>3&&b.push(K)}if(!R.length){var u=C[0].innerText.trim();u.length&&b.push(u)}}if(b.length)break}if(!b.length){var l=E._findFirstFromSelector(['[property="og:category" i]','[itemprop="category" i]']);l&&l.length&&b.push(l)}return b.length?b:null}},{key:"check",value:function(){return this.clearCache(),new Promise(function(d){Y.scoreSum=0,Y.scoreDetails={};var b=function(D){return new Promise(function(F,C){if(Math.abs(Y.scoreSum)>2)return F();setTimeout(function(){var R=Date.now();Y[D]().then(function(G){Y.scoreSum+=G,Y.scoreDetails[D]={score:G,time:Date.now()-R},F()}).catch(function(G){C(G)})},1)})};Promise.resolve().then(function(){return new Promise(function(D,F){var C=!1,R=0,u=function(){C||(C=!0,!Y.hasTextInDoc()||!Y.hasHtmlInDoc()||document.body.innerHTML.length<1e3?F(new Error("Document html not valid")):D())};return document?(document.addEventListener("DOMContentLoaded",u),window?(window.addEventListener("load",u),void function f(){R++,C||(document&&"complete"===document.readyState?u():R>120?F(new Error("Document not ready")):setTimeout(f,500))}()):F(new Error("Window object not found"))):F(new Error("Document object not found"))})}).then(function(){return b("checkTopSites")}).then(function(){return b("checkHomePageOrStaticPages")}).then(function(){return b("checkUrlRegExpTerms")}).then(function(){return b("checkSchemaTags")}).then(function(){return b("checkMetaOGTag")}).then(function(){return b("checkPriceTag")}).then(function(){return b("checkAmountPerPage")}).then(function(){return b("checkSortBlock")}).then(function(){return b("checkPaginator")}).then(function(){return b("checkPagerParamsInUrl")}).then(function(){return b("checkItemBlocks")}).then(function(){return b("checkAddToCartButton")}).then(function(){return b("checkProductImage")}).then(function(){return b("checkPredefinedTextPatterns")}).then(function(){return d(Y.scoreSum>0)}).catch(function(){return d(!1)})})}},{key:"getAdditionalParams",value:function(){var E=Y;return E.checkProductImage().then(function(){return void 0===E.itemPrice?E.checkPriceTag():Promise.resolve()}).then(function(){var d={title:null,h1:null,img:E.biggestImg&&E.biggestImg.url?E.biggestImg.url.slice(0,2048):null,price:null,itemName:null,currencyCode:null,category:null,brand:null,articleId:null,scoreSummary:E.scoreSum,scoreTime:null},m=E._findSingle(document,"title");if(m&&(d.title=m.innerText.trim().slice(0,512)),(m=E._findSingle(document,"h1"))&&(d.h1=m.innerText.trim().slice(0,512)),(m=E.searchProductInfo())&&(d=Object.assign(d,m)),d.articleId||(m=E.getArticleId())&&(d.articleId=m),(!d.category||1===d.category.length)&&((m=E.getCategories())&&(d.category=m)),d.brand||(m=E.getBrand())&&(d.brand=m),d.currencyCode||(m=E.getCurrencyCode())&&(d.currencyCode=m),E.scoreDetails){var b=0;for(var A in E.scoreDetails)E.scoreDetails[A].time&&(b+=E.scoreDetails[A].time);b&&(d.scoreTime=b)}E.itemPrice&&(d.price=E.itemPrice);try{var D=window.location.hostname.toLowerCase();if(D.includes("ozon.ru")){var F=document.querySelectorAll('script[src*="https://googleads.g.doubleclick"][src*="ecomm_totalvalue"]');F=F[F.length-1],d.price=new URLSearchParams(decodeURIComponent(new URL(F.getAttribute("src")).search)).get("data").match(/ecomm_totalvalue=\d+/gim)[0].replace("ecomm_totalvalue=","")}else D.includes("detmir.ru")?d.price=document.querySelectorAll('div.i-flocktory[data-fl-action="track-item-view"]')[0].getAttribute("data-fl-item-price"):D.includes("dns-shop.ru")&&(d.price=document.querySelector(".product-card-top .product-buy_one-line .product-buy__price").innerText.replace(/[\u20bd]+.+/gim,"").replace(/[^\d.]/gim,""))}catch(C){}return Promise.resolve(d)}).catch(function(){return Promise.resolve({})})}},{key:"clearCache",value:function(){this.checkProductImageCache=void 0}}]),Y}()},5848:function(ge,le,O){O.d(le,{cQ:function(){return F},cM:function(){return C}});var ie=O(6054),q=O(8774),I=O.n(q),x=O(4762),Y=O(7256),B=O(8372),E=O(9433),d=O(7301),m=O(3484),b=O.n(m),A=O(9979),D=O.n(A),F=function(){var K=this,u={getDomain:function(l){if(!l)return null;try{l=new URL(l).host.replace("www.","")}catch(f){l=l.replace("www.","")}return l},getStyle:function(l,f){if(l.currentStyle)return l.currentStyle[f];if(window.document.defaultView&&window.document.defaultView.getComputedStyle){var r=window.document.defaultView.getComputedStyle(l,"");return r?r[f]:null}return l.style?l.style[f]:void 0},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){var f=16*Math.random()|0;return("x"===l?f:3&f|8).toString(16)})},getFullInfo:function(){var l="",f="",r="",s="",g="",o="",p=window.navigator.userAgent||"",y=window.navigator.platform||"";return/MSIE/.test(p)?(l="Internet Explorer",/IEMobile/.test(p)&&(r=1),f=/MSIE \d+[.]\d+/.exec(p)[0].split(" ")[1]):/YaBrowser/.test(p)?(/CrOS/.test(p)&&(y="CrOS"),l="YaBrowser",f=/YaBrowser\/[\d\.]+/.exec(p)[0].split("/")[1]):/Opera/.test(p)||/OPR/.test(p)?(l="Opera",f=/OPR\/[\d\.]+/.exec(p)[0].split("/")[1],(/mini/.test(p)||/Mobile/.test(p))&&(r=1)):/Chrome/.test(p)?(/CrOS/.test(p)&&(y="CrOS"),l="Chrome",f=/Chrome\/[\d\.]+/.exec(p)[0].split("/")[1]):/Android/.test(p)?(l="Android Webkit Browser",r=1,s=/Android\s[\.\d]+/.exec(p)[0]):/Firefox/.test(p)?(l="Firefox",/Fennec/.test(p)&&(r=1),f=/Firefox\/[\.\d]+/.exec(p)[0].split("/")[1]):/Safari/.test(p)&&(l="Safari",(/iPhone/.test(p)||/iPad/.test(p)||/iPod/.test(p))&&(s="iOS",r=1)),f||(f=(f=/Version\/[\.\d]+/.exec(p))?f[0].split("/")[1]:framework.browser.version),"MacIntel"===y||"MacPPC"===y?(s="Mac OS X",(g=p.matchAll(/[\d\\_]+[\d]+/gim)[0][0])&&(g=g.split("_").join("."))):"CrOS"===y?s="ChromeOS":"Win32"===y||"Win64"===y?(s="Windows",o=y.replace(/[^0-9]+/,"")):!s&&/Android/.test(p)?s="Android":!s&&/Linux/.test(y)?s="Linux":!s&&/Windows/.test(p)&&(s="Windows"),{browser:l.toLowerCase(),version:f,mobile:r,os:s,osversion:g,bit:o}},getAllUrlParams:function(l){var f=l?l.split("?")[1]:window.location.search.slice(1),r={};if(f)for(var s=(f=f.split("#")[0]).split("&"),g=0;g<s.length;g++){var o=s[g].split("="),p=void 0,y=o[0].replace(/\[\d*\]/,function(U){return p=U.slice(1,-1),""}),T=void 0===o[1]||null===o[1]?"":o[1];y=y.toLowerCase(),T=T.toLowerCase(),r[y]?("string"==typeof r[y]&&(r[y]=[r[y]]),void 0===p?r[y].push(T):r[y][p]=T):r[y]=T}return r},getDomainPrice:function(l){var f=null;return l&&l.length>0&&(l.includes("aliexpress")?f="aliexpress":l.includes("gearbest")?f="gearbest":l.includes("banggood")?f="banggood":l.includes("lightinthebox")?f="lightinthebox":l.includes("miniinthebox")?f="miniinthebox":l.includes("tomtop")&&(f="tomtop")),f},getProductId:function(l,f){var r=null;if(l&&l.length>0)switch(l){case"aliexpress":r=f.matchAll(E.g.REGEX_ALI_PRODUCT_ID)[0][1],r+="_aliexpress";break;case"gearbest":r=f.matchAll(E.g.REGEX_GEARBEST_PRODUCT_ID)[0][1],r+="_gearbest";break;case"ru.gearbest":r=f.matchAll(E.g.REGEX_GEARBEST_PRODUCT_ID)[0][1],r+="_ru_gearbest";break;case"banggood":r=f.matchAll(E.g.REGEX_BANG_GOOD_PRODUCT_ID)[0][1],r+="_banggood";break;case"eu.banggood":r=f.matchAll(E.g.REGEX_BANG_GOOD_EU_PRODUCT_ID)[0][1],r+="_eu_banggood";break;case"us.banggood":r=f.matchAll(E.g.REGEX_BANG_GOOD_US_PRODUCT_ID)[0][1],r+="_us_banggood";break;case"lightinthebox":r=f.matchAll(E.g.REGEX_LIGHT_IN_THE_BOX_PRODUCT_ID)[0][1],r+="_lightinthebox";break;case"miniinthebox":r=f.matchAll(E.g.REGEX_LIGHT_IN_THE_BOX_PRODUCT_ID)[0][1],r+="_miniinthebox";break;case"tomtop":r=f.matchAll(E.g.REGEX_TOM_TOP_PRODUCT_ID)[0][1],r+="_tomtop"}return r},_getTimeZoneOffset:function(){try{return(new Date).toString().match(/([-\+][0-9]+)\s/)[1]}catch(l){return null}},_getPriceGearbest:function(){try{var l=$("#siteWrap").eq(0).find("script").html();l=l.match(/\s+appPrice:\s*"([\d.]+)",/im)[1];var f=l=parseFloat(parseFloat(l).toFixed(2));if(l>f)throw new Error("getPriceObj priceMin > priceMax");if(!(l>0&&f>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var s=u._getDisplayPriceGearBest();return{currency:"USD",priceMin:l,priceMax:f,currencyDisplay:s.currency,priceMinDisplay:s.priceMin,priceMaxDisplay:s.priceMax}}catch(g){return console.log("Error",g),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getPriceBanggood:function(){try{var l=parseFloat($(".item_box.price .now").attr("oriattrmin")),f=parseFloat($(".item_box.price .now").attr("oriattrmax")),r=parseFloat($(".item_box.price .now").attr("oriprice")),s=null,g=[],o=document.documentElement.innerHTML.match(/fb_jsonNewFB\s*=\s*(\{.+\}),/i);if(o&&2===o.length)try{var p=JSON.parse(o[1]);!r&&p.value&&(r=parseFloat(p.value),g.push(r)),p.currency&&(s=p.currency)}catch(V){}if((o=document.documentElement.innerHTML.match(/var\s+google_tag_params\s*=\s*{.+ecomm_totalvalue:(.+),\s*ecomm_pagetype:/i))&&2===o.length)try{var y=JSON.parse(o[1]);y&&"number"==typeof y?g.push(y):"object"==typeof y&&Array.isArray(y)&&(g=g.concat(y))}catch(V){}s&&(s=s.toUpperCase().trim()),(!l||r<l)&&(l=r),f||(f=l);var U,T=(0,ie.Z)(g);try{for(T.s();!(U=T.n()).done;){var S=U.value;f<S?f=S:S&&l>S&&(l=S)}}catch(V){T.e(V)}finally{T.f()}if($('.item_warehouse_list li[value!="US"] .item_warehouse_price').each(function(){parseFloat($(this).attr("oriprice"))<l&&(l=parseFloat($(this).attr("oriprice"))),parseFloat($(this).attr("oriprice"))>f&&(f=parseFloat($(this).attr("oriprice")))}),!s)throw new Error("getPriceObj currency bad string");if(l>f)throw new Error("getPriceObj priceMin > priceMax");if(!(l>0&&f>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var H=u._getDisplayPriceBanggood();return{currency:s,priceMin:l,priceMax:f,currencyDisplay:H.currency,priceMinDisplay:H.priceMin,priceMaxDisplay:H.priceMax}}catch(V){return console.log("Error",V),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getPriceUsEuBanggood:function(){try{var o,l=parseFloat($('.pro_price [itemprop="price"]').text()),f=parseFloat($('.pro_price [itemprop="price"]').text()),r={USD:"US$",EUR:"\u20ac",GBP:"\xa3",AUD:"AU$",CAD:"CA$",RUB:"\u0440\u0443\u0431.",BRL:"R$",CHF:"SFr",DKK:"Dkr",PHP:"\u20b1",SGD:"S$",CZK:"K\u010d",HUF:"Ft",MXN:"Mex$",NOK:"Kr",NZD:"NZD$",PLN:"z\u0142",THB:"\u0e3f",HKD:"HK$",ILS:"\u20aa",SEK:"Kr",ZAR:"R",KRW:"\u20a9",CLP:"$",TRY:"TRY",INR:"Rs",JPY:"JPY",AED:"AED",MYR:"RM",IDR:"Rp",UAH:"\u20b4",KWD:"K.D.",QAR:"QR.",BHD:"BD.",SAR:"S.R."},s=Object.keys(r),g=$(".item_box.price .hbactive b").text();for(var p in g||(g=$(".pro_price .currency .currency_Prefix").text()),s)if(r[s[p]]===g){o=s[p];break}if(!o)throw new Error("getPriceObj currency bad string");if(l>f)throw new Error("getPriceObj priceMin > priceMax");if(!(l>0&&f>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var y=u._getDisplayPriceBanggood();return{currency:o,priceMin:l,priceMax:f,currencyDisplay:y.currency,priceMinDisplay:y.priceMin,priceMaxDisplay:y.priceMax}}catch(T){return console.log("Error",T),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getPriceLightinthebox:function(){return function f(){try{var U,r=$('span[itemprop="priceCurrency"]').eq(0).attr("content").replace(/\s\s+/g," ").trim().toUpperCase(),s=JSON.parse($("#_prodInfoConfig_").attr("data-config")),g=Object.keys(s)[0],o=parseFloat(s[g].salePrice),p=o,y=s[g].attributes,T=(0,ie.Z)(y);try{for(T.s();!(U=T.n()).done;){var V,S=U.value,H=(0,ie.Z)(S.items);try{for(H.s();!(V=H.n()).done;){var z=V.value;if(z.price>0){var ee=parseFloat((o+parseFloat(z.price)).toFixed(2));ee>p&&(p=ee)}}}catch(W){H.e(W)}finally{H.f()}}}catch(W){T.e(W)}finally{T.f()}if(!r)throw new Error("getPriceObjLightinthebox currency bad string");if(o>p)throw new Error("getPriceObjLightinthebox priceMin > priceMax");if(!(o>0&&p>0))throw new Error("getPriceObjLightinthebox priceMin or priceMax less or equal 0");return{currency:r,priceMin:o,priceMax:p,currencyDisplay:r,priceMinDisplay:o,priceMaxDisplay:p}}catch(W){return console.log("Error",W),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}}()},_getPriceTomtop:function(l){try{var f,r,s;try{f=JSON.parse(l.matchAll(/var\s+product\s*=(.*)/gim)[0][1])}catch(k){f=null}try{r=JSON.parse(l.matchAll(/var\s+mainContent\s*=(.*)?;/gim)[0][1])}catch(k){r=null}try{s=JSON.parse(l.matchAll(/var\s+timeLimit\s*=(.*)?;/gim)[0][1])}catch(k){s=null}var g=f?parseFloat(f.saleprice?f.saleprice:f.price):null,o=f?f.currency:null,p=[];"object"==typeof r&&r&&r.length>0&&r.forEach(function(k){"object"==typeof k.whouse&&k.whouse&&Object.keys(k.whouse).forEach(function(ae){p.push({listingId:k.listingId,depotId:k.whouse[ae].depotId,symbol:k.whouse[ae].symbol,nowprice:parseFloat(k.whouse[ae].nowprice),origprice:parseFloat(k.whouse[ae].origprice),us_nowprice:parseFloat(k.whouse[ae].us_nowprice),us_origprice:parseFloat(k.whouse[ae].us_origprice),saleStartDate:k.whouse[ae].saleStartDate,saleEndDate:k.whouse[ae].saleEndDate})})});var y=[];"object"==typeof s&&s&&Object.keys(s).forEach(function(k){"object"==typeof s[k]&&s[k]&&Object.keys(s[k]).forEach(function(ae){y.push({listingId:s[k][ae].listingId,depotId:s[k][ae].depot,actPrice:parseFloat(s[k][ae].actPrice),nowprice:parseFloat(s[k][ae].nowprice)})})});var U=o,S={},H={},V={},z={},ee=[];y.length>0&&y.forEach(function(k){ee.push(k.depotId+"_"+k.listingId),S[k.listingId]||(S[k.listingId]=k.actPrice),H[k.listingId]||(H[k.listingId]=k.actPrice),k.actPrice<S[k.listingId]&&(S[k.listingId]=k.actPrice),k.actPrice>H[k.listingId]&&(H[k.listingId]=k.actPrice),V[k.listingId]||(V[k.listingId]=k.nowprice),z[k.listingId]||(z[k.listingId]=k.nowprice),k.nowprice<V[k.listingId]&&(V[k.listingId]=k.nowprice),k.nowprice>z[k.listingId]&&(z[k.listingId]=k.nowprice)}),p.length>0&&p.forEach(function(k){if(-1!==ee.indexOf(k.depotId+"_"+k.listingId))return 0;S[k.listingId]||(S[k.listingId]=k.us_nowprice),H[k.listingId]||(H[k.listingId]=k.us_nowprice),k.us_nowprice<S[k.listingId]&&(S[k.listingId]=k.us_nowprice),k.us_nowprice>H[k.listingId]&&(H[k.listingId]=k.us_nowprice),V[k.listingId]||(V[k.listingId]=k.nowprice),z[k.listingId]||(z[k.listingId]=k.nowprice),k.nowprice<V[k.listingId]&&(V[k.listingId]=k.nowprice),k.nowprice>z[k.listingId]&&(z[k.listingId]=k.nowprice)});var W=null,J=null,X=null,te=null;if(Object.keys(S).forEach(function(k){W||(W=S[k]),S[k]<W&&(W=S[k])}),Object.keys(H).forEach(function(k){J||(J=H[k]),H[k]>J&&(J=H[k])}),Object.keys(V).forEach(function(k){X||(X=V[k]),V[k]<X&&(X=V[k])}),Object.keys(z).forEach(function(k){te||(te=z[k]),z[k]>te&&(te=z[k])}),X||(X=g),te||(te=g),g<X&&(X=g),g>te&&(te=g),W>J)throw new Error("getPriceObj priceMin > priceMax");if(!(W>0&&J>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");if(!U)throw new Error("getPriceObj currencyDisplay bad string");if(X>te)throw new Error("getPriceObj priceMinDisplay > priceMaxDisplay");if(!(X>0&&te>0))throw new Error("getPriceObj priceMinDisplay or priceMaxDisplay less or equal 0");return{currency:"USD",priceMin:W,priceMax:J,currencyDisplay:U,priceMinDisplay:X,priceMaxDisplay:te}}catch(k){return console.error("Error",k),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getDisplayPriceBanggood:function(){return function l(){var f;try{var p,y,r={USD:{label:"US$",decimal:"."},EUR:{label:"\u20ac",decimal:","},GBP:{label:"\xa3",decimal:"."},AUD:{label:"AU$",decimal:"."},CAD:{label:"CA$",decimal:"."},RUB:{label:"\u0440\u0443\u0431.",decimal:","},BRL:{label:"R$",decimal:","},CHF:{label:"SFr",decimal:"."},DKK:{label:"Dkr",decimal:"."},PHP:{label:"\u20b1",decimal:"."},SGD:{label:"S$",decimal:"."},CZK:{label:"K\u010d",decimal:"."},HUF:{label:"Ft",decimal:"."},MXN:{label:"Mex$",decimal:"."},NOK:{label:"Kr",decimal:"."},NZD:{label:"NZD$",decimal:"."},PLN:{label:"z\u0142",decimal:","},THB:{label:"\u0e3f",decimal:"."},HKD:{label:"HK$",decimal:"."},ILS:{label:"\u20aa",decimal:"."},SEK:{label:"Kr",decimal:"."},ZAR:{label:"R",decimal:"."},KRW:{label:"\u20a9",decimal:"."},CLP:{label:"$",decimal:"."},TRY:{label:"TRY",decimal:"."},INR:{label:"\u20b9",decimal:"."},JPY:{label:"JPY",decimal:"."},AED:{label:"AED",decimal:"."},MYR:{label:"RM",decimal:"."},IDR:{label:"Rp",decimal:"."},UAH:{label:"\u20b4",decimal:"."},KWD:{label:"K.D.",decimal:"."},QAR:{label:"QR.",decimal:"."},BHD:{label:"BD.",decimal:"."},SAR:{label:"S.R.",decimal:"."},EGP:{label:"E\xa3",decimal:"."},OMR:{label:"RO.",decimal:"."},JOD:{label:"J.D.",decimal:"."},LBP:{label:"\uffe1L",decimal:"."},COP:{label:"COP$",decimal:"."},PEN:{label:"PEN",decimal:","}},s=/\d{1,3}(?:[.,\s]\d{1,3})*(?:[.,]\d{1,3})|\d{1,3}/gm,g=$(".product-price .main-price").text(),o=g.match(s),T=g.replace(s,"").replace("-","").trim(),U=Object.keys(r).find(function(z){return T===r[z].label});if(!U)throw new Error("getPriceObj currency bad string");var S=function(ee){var J=(ee.match(s)||[]).find(function(X){return X.length>0});return J&&U?+(J=J.replace(r[U].decimal,"~").replace(",","").replace(".","").replace("~",".")).replace(" ",""):null};if(!o||1!==o.length&&2!==o.length||!o[0])throw new Error("getPriceObj can not match");p=o[0],y=null!==(f=o[1])&&void 0!==f?f:o[0];var H=S(p),V=S(y);if(0===H)throw new Error("getPriceObj priceMin should be more than 0");if(V||(V=H),H>V)throw new Error("getPriceObj priceMin > priceMax");if(!(H>0&&V>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");return{currency:U,priceMin:H,priceMax:V}}catch(z){return console.log("Error",z),{currency:null,priceMin:null,priceMax:null}}}()},_getDisplayPriceGearBest:function(){return function l(f){try{var g,r={AED:"\u062f.\u0625",AUD:"AU$",BGN:"\u043b\u0432",BRL:"R$",CAD:"C$",CHF:"SFr.",CLP:"CL$",CNY:"\xa5",COP:"Col$",CZK:"K\u010d",DKK:"DKr.",EUR:"\u20ac",GBP:"\xa3",HKD:"HK$",HRK:"Kn",HUF:"Ft",IDR:"Rp",ILS:"\u20aa",INR:"Rs",JPY:"\u5186",KRW:"\u20a9",MAD:"\u062f.\u0645.",MXN:"MXN$",MYR:"RM",NGN:"\u20a6",NOK:"NKr.",NZD:"NZ$",PEN:"S/.",PLN:"z\u0142",RON:"lei",RSD:"\u0420\u0421\u0414",RUB:"\u0440\u0443\u0431.",SAR:"\u0631.\u0633",SEK:"SKr",SGD:"S$",THB:"\u0e3f",TRY:"TL",TWD:"NT$",UAH:"\u20b4",USD:"$",ZAR:"R"},s=Object.keys(r);for(var o in s)if(-1!==f.toLowerCase().indexOf(r[s[o]].toLowerCase())){g=s[o];break}if(!g)throw new Error("getPriceObj currency bad string");if("string"!=typeof f)throw new Error("getPriceObj priceText not string");var p=parseFloat(f.replace(/\s+/g,"").replace(",",".").match(/\d+[.\d+]*/gim)[0]),y=p;if(p>y)throw new Error("getPriceObj priceMin > priceMax");if(!(p>0&&y>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");return{currency:g,priceMin:p,priceMax:y}}catch(T){return console.log("Error",T),{currency:null,priceMin:null,priceMax:null}}}($(".goodsIntro_price").eq(0).text())},_getPriceAliexpress:function(l){var f;try{var r,s,g;f=u._getPriceStrAliexpress();try{r=parseFloat(parseFloat(l.matchAll(E.g.REGEX_ACT_MIN_PRICE)[0][1]).toFixed(2))}catch(y){r=parseFloat(parseFloat(l.matchAll(E.g.REGEX_MIN_PRICE)[0][1]).toFixed(2))}try{s=parseFloat(parseFloat(l.matchAll(E.g.REGEX_ACT_MAX_PRICE)[0][1]).toFixed(2))}catch(y){s=parseFloat(parseFloat(l.matchAll(E.g.REGEX_MAX_PRICE)[0][1]).toFixed(2))}if(!(g=l.matchAll(E.g.REGEX_BASE_CURRENCY_CODE)[0][1]))throw new Error("getPriceObj currency bad string");if(r>s)throw new Error("getPriceObj priceMin > priceMax");if(!(r>0&&s>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var o=u._getDisplayPriceAliexpress(f);return{currency:g,priceMin:r,priceMax:s,currencyDisplay:o.currency,priceMinDisplay:o.priceMin,priceMaxDisplay:o.priceMax}}catch(y){try{var p=u._getDisplayPriceAliexpress(f);return{currency:null,priceMin:null,priceMax:null,currencyDisplay:p.currency,priceMinDisplay:p.priceMin,priceMaxDisplay:p.priceMax}}catch(T){return console.log("Error",T),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}}},_getDisplayPriceAliexpress:function(l){try{if("string"!=typeof l)throw new Error("getPriceObj priceText not string");for(var f=[[/US.*\$/gim,"USD","."],[/\u0440\u0443\u0431\./gim,"RUB",","],[/\uffe1/gim,"GBP","."],[/R\$/gim,"BRL",","],[/C\$/gim,"CAD","."],[/AU.*\$/gim,"AUD","."],[/\u20ac/gim,"EUR",","],[/Rs\./gim,"INR","."],[/\u0433\u0440\u043d\./gim,"UAH",","],[/\uffe5/gim,"JPY","."],[/MXN\$/gim,"MXN","."],[/Rp/gim,"IDR","."],[/TL/gim,"TRY","."],[/SEK/gim,"SEK","."],[/CLP/gim,"CLP","."],[/\u20a9/gim,"KRW","."],[/SG\$/gim,"SGD","."],[/NZ\$/gim,"NZD","."],[/CHF/gim,"CHF","."],[/z\u0142/gim,"PLN",","],[/AED./gim,"AED","."],[/PHP./gim,"PHP","."],[/ZAR./gim,"ZAR","."],[/ARS./gim,"ARS",","],[/PEN./gim,"PEN",","]],r=null,s=null,g=0;g<f.length;g++){var o=f[g];if(o[0].test(l)){r=o[1],s=o[2],l=l.replace(o[0],"");break}}if(null===r||null===s)throw new Error("getPriceObj can not find currency (USD, RUB)");var p=l.toLowerCase().match(/[\d.,-]+/gim).join("").split("-");if(!p||1!==p.length&&2!==p.length||!p[0])throw new Error("getPriceObj can not match");(-1!==p[0].indexOf(",")&&-1!==p[0].indexOf(".")&&p[0].indexOf(",")<p[0].indexOf(".")||-1===p[0].indexOf(",")&&p[0].match(/\./gim)&&1===p[0].match(/\./gim).length)&&(s=".");var y=new RegExp("[^0-9-"+s+"]",["g"]),T=parseFloat(p[0].replace(y,"").replace(s,".")),U=T;if(p[1]&&(U=parseFloat(p[1].replace(y,"").replace(s,"."))),T>U)throw new Error("getPriceObj priceMin > priceMax");if(!(T>0&&U>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");return{currency:r,priceMin:T,priceMax:U}}catch(S){return console.log("Error",S),{currency:null,priceMin:null,priceMax:null}}},_getPriceStrAliexpress:function(){var l=$('.product-multi-price-main #j-multi-currency-price, .product-multi-price-main span[itemprop="priceCurrency"]').text();return l||(l=$(".p-price-content .p-symbol, .p-price-content .p-price").text()),l||(l=$("div.p-price span.p-price").text()),l||(l=$(".detail-price-container .price-span").text()),l||(l=$("div.product-price span.product-price-current").text()),l||(l=$("span[class^='Product_UniformBanner__uniformBannerBoxPrice__']").text()),l||(l=$("div.uniform-banner-box span.uniform-banner-box-price").text()),l},_getPriceAliexpressNewDesign:function(l){try{var s,f=null,r=null;s=u._getCurrencyPriceAliexpressNewDesign(l);var g=l.data.skuModule.skuPriceList;for(var o in g)if(g[o]&&g[o].skuVal){var p=parseFloat(g[o].skuVal.actSkuCalPrice||g[o].skuVal.skuCalPrice);(null===f||f>p)&&(f=p),(null===r||r<p)&&(r=p)}var y=u._getDisplayPriceAliexpressNewDesign(l);return{currency:s,priceMin:f,priceMax:r,currencyDisplay:y.currency,priceMinDisplay:y.priceMin,priceMaxDisplay:y.priceMax}}catch(U){try{var T=u._getDisplayPriceAliexpressNewDesign(l);return{currency:null,priceMin:null,priceMax:null,currencyDisplay:T.currency,priceMinDisplay:T.priceMin,priceMaxDisplay:T.priceMax}}catch(S){return console.log("Error",S),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}}},_getCurrencyPriceAliexpressNewDesign:function(l){try{var f=l.data.skuModule.skuPriceList[0].skuVal,r=parseFloat(f.actSkuCalPrice?f.actSkuCalPrice:f.skuCalPrice),s=f.skuActivityAmount?f.skuActivityAmount:f.skuAmount,g=parseFloat(s.value),o=s.currency;if(!(r>0&&g>0))throw new Error("Can not detect currency");if(r===g)return o;var p=l.data.commonModule;return p.tradeCurrencyCode!==p.currencyCode?p.tradeCurrencyCode:"USD"}catch(y){return null}},_getDisplayPriceAliexpressNewDesign:function(l){try{var f=l.data.priceModule;return{currency:f.minActivityAmount?f.minActivityAmount.currency:f.minAmount.currency,priceMin:f.minActivityAmount?f.minActivityAmount.value:f.minAmount.value,priceMax:f.maxActivityAmount?f.maxActivityAmount.value:f.maxAmount.value}}catch(r){return{currency:null,priceMin:null,priceMax:null}}},_getPriceStrAliexpressNewDesign:function(){var l=$('.product-multi-price-main #j-multi-currency-price, .product-multi-price-main span[itemprop="priceCurrency"]').text();return l||(l=$(".p-price-content .p-symbol, .p-price-content .p-price").text()),l||(l=$("div.p-price span.p-price").text()),l||(l=$(".detail-price-container .price-span").text()),l},getAliRunParams:function(l){try{return JSON.parse(l.matchAll(/window\.runParams\s*=\s*({[.\s\S]+?});/gim)[0][1].split(" ").join("").split("\r").join("").split("\n").join("").replace("data",'"data"').replace("csrfToken",'"csrfToken"').replace(":'",':"').replace("',",'"').replace("abVersion",',"abVersion"').replace(":'",':"').replace("'}",'"}').replace("',",'",').replace("abtestMap",'"abtestMap"'))}catch(f){return!1}},getPrice:function(l){var f={};if(l&&l.length>0)switch(l){case"aliexpress":var r=$("body").text(),s=u.getAliRunParams(r);if(s){f=u._getPriceAliexpressNewDesign(s);break}f=u._getPriceAliexpress(r);break;case"gearbest":case"ru.gearbest":f=u._getPriceGearbest();break;case"banggood":f=u._getPriceBanggood();break;case"us.banggood":case"eu.banggood":f=u._getPriceUsEuBanggood();break;case"lightinthebox":case"miniinthebox":f=u._getPriceLightinthebox();break;case"tomtop":f=u._getPriceTomtop($("body").text())}return f.timezone=u._getTimeZoneOffset(),f},getRegion:function(l){var f="";if("aliexpress"===l){var r=$("body").text(),s=r.matchAll(E.g.REGEX_REGION_COUNTRY_NAME),g=r.matchAll(E.g.REGEX_REGION_PROVINCE_NAME),o=r.matchAll(E.g.REGEX_REGION_CITY_NAME);f=(s?s[0][1]:"UNKNOWN")+"_"+(g?g[0][1]:"UNKNOWN")+"_"+(o?o[0][1]:"UNKNOWN")}return f},matchLocaleCookie:function(l){return(0,x.mG)(K,void 0,void 0,I().mark(function f(){var r,s;return I().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d.V.syncGet("locale");case 2:if((r=o.sent)&&!_.isEmpty(l)){o.next=5;break}return o.abrupt("return",!1);case 5:return s=r.split("_")[1].toUpperCase(),o.abrupt("return",l.some(function(p){return p.toUpperCase()===s}));case 7:case"end":return o.stop()}},f)}))},isAliexpressProductPage:function(l){return E.g.REGEX_ALI_PRODUCT_ID.test(l)},checkConditionsBooking:function(l,f){return(0,x.mG)(this,void 0,void 0,I().mark(function r(){var s=this;return I().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(p){return(0,x.mG)(s,void 0,void 0,I().mark(function y(){var T=this;return I().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:_.delay(function(){return(0,x.mG)(T,void 0,void 0,I().mark(function H(){var V;return I().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,f.getParameter(Y.E.GREEN_LIGHT_BOOKING_END_TIME);case 2:return V=ee.sent,ee.abrupt("return",p(""!==l.search&&!l.searchParams.get("aid")||V&&Date.now()<V));case 4:case"end":return ee.stop()}},H)}))},500);case 1:case"end":return S.stop()}},y)}))}));case 1:case"end":return o.stop()}},r)}))},getViewUrlItem:function(l,f){return B.S.getLink()+"view/"+l+E.g.PARAMETER_DEEP_LINK+encodeURIComponent(f)},getGoUrlItem:function(l,f){return B.S.getLink()+"shops/"+l+"/go"+E.g.PARAMETER_DEEP_LINK+encodeURIComponent(f)+"&productWithGo=true"},getMetaTagInfo:function(l){for(var f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"property",r=document.getElementsByTagName("meta"),s=0;s<r.length;s++)if(r[s].getAttribute(f)===l)return r[s].getAttribute("content");return""},urlFromObject:function(l){var f=[];for(var r in l)l.hasOwnProperty(r)&&l[r].length>0&&f.push(encodeURIComponent(r)+"="+encodeURIComponent(l[r]));return f.join("&")},saveUserSettings:function(l,f){return(0,x.mG)(K,void 0,void 0,I().mark(function r(){var s;return I().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d.V.syncGet("userSettings");case 2:if(o.t0=o.sent,o.t0){o.next=5;break}o.t0={};case 5:return(s=o.t0)[l]=f,d.V.set("userSettings",s),o.abrupt("return",!0);case 9:case"end":return o.stop()}},r)}))},getUserSettings:function(){return(0,x.mG)(K,void 0,void 0,I().mark(function l(){return I().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,d.V.syncGet("userSettings");case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},l)}))},getUserSettingsByKey:function(l){return(0,x.mG)(K,void 0,void 0,I().mark(function f(){var r;return I().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,d.V.syncGet("userSettings");case 2:if(g.t0=g.sent,g.t0){g.next=5;break}g.t0={};case 5:return r=g.t0,g.abrupt("return",r[l]);case 7:case"end":return g.stop()}},f)}))},checkUserSegments:function(l,f){return Array.isArray(l)&&l.length&&Array.isArray(f)&&f.length&&!!l.filter(function(r){return f.includes(r)}).length},checkUserExperiments:function(l,f){var r=f.experimentMachineName,s=f.groupsMachineName;return Array.isArray(l)&&l.length&&!!l.filter(function(g){var o=g.experiment_machine_name,p=g.groups_machine_name;return o===r&&p===s}).length},isAliexpress:function(l){return[E.g.aliexpressID,E.g.aliexpressWWID].includes(l)},isAliexpressGlobal:function(l){return l===E.g.aliexpressWWID},isAliexpressCis:function(l){return l===E.g.aliexpressID},objectKeysTransform:function(l){var f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"camelcase";switch(f){case"camelcase":return b()(l,{deep:!0});case"snakecase":return D()(l,{deep:!0});default:return l}},sleep:function(l){return new Promise(function(f){return setTimeout(f,l)})},getLSViewedShopsPageUrl:function(l){var f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"no-activate-cashback",r="&utm_source=extension&utm_campaign=".concat(f,"&utm_term=").concat(u.getFullInfo().browser.toLowerCase()),s=l?"/shops-viewed?with_shop=".concat(l.id):"/shops-viewed?";return B.S._root+s+r},isBrowser:function(l){return u.getFullInfo().browser.toLowerCase()===l.toLowerCase()},calculateRateCoefficient:function(l){return l?l/100+1:1},getTimerData:function(l){var s=new Date(l).getTime()-(new Date).getTime(),g=Math.floor(s%864e5/36e5),o=Math.floor(s%36e5/6e4),p=Math.floor(s%6e4/1e3),y=1===g.toFixed().length?"0".concat(g):"".concat(g),T=1===o.toFixed().length?"0".concat(o):"".concat(o),U=1===p.toFixed().length?"0".concat(p):"".concat(p);return s<=0?"00:00:00":"".concat(y,":").concat(T,":").concat(U)},getEndedAutopromo:function(l){return l.autoPromotions.find(function(f){return f.autoPromotion.endAt&&new Date(f.autoPromotion.endAt).getTime()<=_.now()})},checkEnableDisableDomain:function(l,f){var r=l.get("domains_enabled"),s=l.get("domains_disabled");function g(p,y){return p.includes("*.")&&y.includes(p.replace("*.",""))||y===p}return(null==r?void 0:r.length)&&(null==s?void 0:s.length)?!!!!r.find(function(p){return g(p,f)})&&!s.find(function(p){return g(p,f)}):f===u.getDomain(l.get("domain"))}};return u}();function C(){E.g.DEBUG&&console.info&&console.info.apply(null,arguments)}String.prototype.matchAll=function(K){var u=[];return this.replace(K,function(){var l=[].slice.call(arguments,0),f=l.splice(-2);l.index=f[0],u.push(l)}),u.length?JSON.parse(JSON.stringify(u)):null},Number.prototype.pad=function(K){for(var u=String(this).substring(0,1),l=String(Math.abs(this));l.length<(K||2);)l="0"+l;return"-"===u?"+"+l+":00":"-"+l+":00"}},2967:function(ge,le,O){O.d(le,{v:function(){return q},A:function(){return I}});var ie=O(138),q=new ie.OlP("Current extension background instance"),I=new ie.OlP("Extension framework")},6418:function(ge,le,O){O.d(le,{YA:function(){return I},tX:function(){return x}});var I,E,ie=O(7289),q=O(5134);(E=I||(I={}))[E.DISCOUNT=1]="DISCOUNT",E[E.CODE=2]="CODE",E[E.STOCK=4]="STOCK";var x=(0,ie.Z)(function E(d){(0,q.Z)(this,E),this.id=d.id,this.currency=d.currency,this.description=d.description,this.link=d.link,this.status=d.status,this.title=d.title,this.totalComments=d.totalComments,this.totalLikes=d.totalLikes,this.url=d.url,this.imagePath=d.imagePath,this.offerType=d.offerType,this.discount=d.discount?new Y(d.discount):null,this.shop=d.shop?new B(d.shop):null}),Y=(0,ie.Z)(function E(d){(0,q.Z)(this,E),this.type=d.type,this.value=d.value?Math.round(d.value):null}),B=(0,ie.Z)(function E(d){(0,q.Z)(this,E),this.id=d.id,this.link=d.link,this.name=d.name})},8561:function(ge,le,O){O.d(le,{q:function(){return m}});var ie=O(6054),q=O(5134),I=O(7289),x=O(8774),Y=O.n(x),B=O(4762),E=O(138),d=O(9725),m=function(){function b(A){(0,q.Z)(this,b),this.httpClient=A,this.baseUrl="https://gpsfront.aliexpress.com",this.recommendingResults="/getI2iRecommendingResults.do",this.baseUrlNewDesign="https://aliexpress.ru/aer-api/v1",this.recommendation="/seller/recommendation",this.specialForYou="/product/detail/special_for_you"}return(0,I.Z)(b,[{key:"getAliSimilarItems",value:function(D,F,C,R){var G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pcDetailLeftTopSell",K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:50,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l="currentItemList=".concat(D,"&categoryId=\n\t\t\t").concat(F,"&shopId=").concat(C,"&companyId=\n\t\t\t").concat(R,"&scenario=").concat(G,"&limit=\n\t\t\t").concat(K,"&offset=").concat(u);return"".concat(this.baseUrl).concat(this.recommendingResults,"?").concat(l)}},{key:"getAliexpressSimilarItems",value:function(D){return(0,B.mG)(this,void 0,void 0,Y().mark(function F(){return Y().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.abrupt("return",this.httpClient.get(D).toPromise().then(function(G){var K=[];if(G&&G.results.length){var l,u=(0,ie.Z)(G.results);try{for(u.s();!(l=u.n()).done;){var f=l.value,r=new URL("https:".concat(f.productDetailUrl));f.productDetailUrl=r.origin+r.pathname,K.push(f)}}catch(s){u.e(s)}finally{u.f()}}return K}));case 1:case"end":return R.stop()}},F,this)}))}},{key:"getAliexpressRecommendation",value:function(D){return"".concat(this.baseUrlNewDesign).concat(this.recommendation,"?product_id=").concat(D)}},{key:"getAliexpressSpecialForYou",value:function(D){return"".concat(this.baseUrlNewDesign).concat(this.specialForYou,"?product_id=").concat(D)}},{key:"getAliexpressRecommendationSimilarItems",value:function(D){return(0,B.mG)(this,void 0,void 0,Y().mark(function F(){return Y().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.abrupt("return",this.httpClient.post(D,JSON.stringify({pageSize:50})).toPromise().then(function(G){var K=[];if(G&&G.products.length){var l,u=(0,ie.Z)(G.products);try{for(u.s();!(l=u.n()).done;){var f=l.value,r=new URL("https:".concat(f.url));f.productDetailUrl=r.origin+r.pathname,f.productId=f.id,f.productImage=f.imgUrl,f.productTitle=f.title,f.minPrice=f.price,K.push(f)}}catch(s){u.e(s)}finally{u.f()}}return K}));case 1:case"end":return R.stop()}},F,this)}))}}]),b}();m.\u0275fac=function(A){return new(A||m)(E.LFG(d.eN))},m.\u0275prov=E.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})},121:function(ge,le,O){O.d(le,{r:function(){return K}});var ie=O(6054),q=O(6860),I=O(5134),x=O(7289),Y=O(8774),B=O.n(Y),E=O(4762),d=O(8372),m=O(9433),b=O(5848),A=O(2522),D=O(7301),F=O(138),C=O(4800),R=O(8561),G=O(9725),K=function(){function l(f,r,s,g){(0,I.Z)(this,l),this.sanitizer=f,this.eventService=r,this.aliexpressProductsService=s,this.httpClient=g,this.baseUrl=d.S._tools,this.itemHistory="/api/extension/v1/item/history",this.itemInfo="/api/extension/v1/item/info",this.affiliateCheck="/api/extension/v1/affiliate/check",this.affiliateCheckList="/api/extension/v1/affiliate/check-list"}return(0,x.Z)(l,[{key:"init",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p,y,T;return B().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(this.application=s,(o=r.data)&&o.priceData){S.next=4;break}return S.abrupt("return",null);case 4:return p=this.application.merchants.selectByDomain(b.cQ.getDomain(o.href)),y=this.application.get("user"),S.next=8,this.getPriceSellerData(r,p);case 8:if(T=S.sent){S.next=11;break}return S.abrupt("return",{empty:!0});case 11:if(!this.isMerchantHasSellerInfo(p)){S.next=15;break}return S.next=14,this.setUpHistoryItems(Object.assign(Object.assign({},T),{productReviewsText:o.productReviewsText,countSoldItemText:o.countSoldItemText}));case 14:T=S.sent;case 15:return S.t0=T,S.t1=o,S.t2=this.isMerchantHasSellerInfo(p),S.t3=this.isMerchantHasSellerInfo(p)&&this.historyInfo(T),S.t4=p.toJSON(),S.t5=y.toJSON(),S.next=23,this.getAffiliateStatus(o,p,y);case 23:return S.t6=S.sent,S.abrupt("return",{rawData:S.t0,pageData:S.t1,hasSellerInfo:S.t2,history:S.t3,merchant:S.t4,user:S.t5,affiliate:S.t6});case 25:case"end":return S.stop()}},g,this)}))}},{key:"getPriceSellerData",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p;return B().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(o={},this.isEventValid(r)){T.next=3;break}return T.abrupt("return",null);case 3:return T.next=5,D.V.syncGet("locale");case 5:return o.locale=T.sent,o.language=o.locale.split("_")[0],T.next=9,this.getPriceInfo(r,s);case 9:if((p=T.sent)&&(o=Object.assign(Object.assign({},o),p)),this.isValid(o)){T.next=13;break}return T.abrupt("return",null);case 13:return T.abrupt("return",JSON.parse(JSON.stringify(o)));case 14:case"end":return T.stop()}},g,this)}))}},{key:"getAffiliateStatus",value:function(r,s,g){return(0,E.mG)(this,void 0,void 0,B().mark(function o(){var p,y,T,U,S,H,V;return B().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return p=new URL(r.href),y=b.cQ.isAliexpressProductPage(p.pathname),ee.next=4,b.cQ.matchLocaleCookie(m.g.NO_ALI_AFFILIATE_COUNTRY);case 4:if(T=ee.sent,U={status:null,isAffiliate:!1,show:!1},y&&T){ee.next=10;break}return U.isAffiliate=!0,U.show=!1,ee.abrupt("return",U);case 10:return S=p.origin+p.pathname,ee.next=13,this.checkAffiliateAliItem(S,g);case 13:if(H=ee.sent,V=H&&H.result){ee.next=20;break}return U.isAffiliate=!1,U.status="unknown",U.icon="alert",ee.abrupt("return",U);case 20:if(s){ee.next=25;break}return U.isAffiliate=!1,U.status="unknown",U.icon="alert",ee.abrupt("return",U);case 25:return H||(U.status="unknown",U.icon="alert"),H&&V&&s.isActivated&&(U.status="success",U.icon="check"),H&&V&&!s.isActivated&&(U.status="pending",U.icon="alert"),H&&!V&&(U.status="failur",U.icon="alert"),U.isAffiliate=V,U.show=!0,this.eventService.fireEvent(A.P.SEND_GOOGLE_ANALYTICS,{tabId:null,data:{type:"pageview",page:"".concat(m.g.gaPrefixMonitor,"view/notification/").concat(U.status,"/")}}),ee.abrupt("return",U);case 33:case"end":return ee.stop()}},o,this)}))}},{key:"sellerResume",value:function(r){var s,g,o,p;return null===(p=null===(o=null===(g=null===(s=null==r?void 0:r.price)||void 0===s?void 0:s.targetInfo)||void 0===g?void 0:g.itemInfo)||void 0===o?void 0:o.seller)||void 0===p?void 0:p.resume}},{key:"isValid",value:function(r){var s,g;if(!r||!r.targetInfo)return null;var o=r.targetInfo.itemInfo;return!!(null==o?void 0:o.url)||!!(null===(s=null==o?void 0:o.dynamic)||void 0===s?void 0:s.value)||!!(null===(g=null==o?void 0:o.seller)||void 0===g?void 0:g.score)}},{key:"isEventValid",value:function(r){var s,g;return(null===(s=null==r?void 0:r.data)||void 0===s?void 0:s.href)&&(null===(g=null==r?void 0:r.data)||void 0===g?void 0:g.priceData)}},{key:"isMerchantHasSellerInfo",value:function(r){return r&&m.g.ARRAY_MERCHANTS_PRICE_SELLER.includes(r.id)}},{key:"isValidSellerInfo",value:function(r){}},{key:"getPriceDynamicChartData",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var g,o,p,y,T,U,S,H,V,z,ee,W,J,X;return B().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return g=r.data,o=g.user,p=g.pageData,y=g.targetInfo,k.next=3,this.getPriceChartData(p.priceData,o,y.itemInfo);case 3:if((T=k.sent).list){k.next=6;break}return k.abrupt("return",null);case 6:return U=(new Date).getTime(),S=new Date(U-2592e6).getTime(),H=this.getArrayFromPeriodDate(S,U,p.month),V=T.list[0].currency.sign,z=this.prepareChartData({list:T,month:p.month,previousDate:S,currentDate:U}),ee=z.dataPriceDate,W=z.arrMinPrice,J=Math.min.apply(Math,(0,q.Z)(W)),X=Math.max.apply(Math,(0,q.Z)(W)),k.abrupt("return",{chart:this.prepareChart(ee,H,X,V),minPrice:u.getPrice(J,V),maxPrice:u.getPrice(X,V),priceLast:u.getPrice(y.itemInfo.priceLast.min,V),description:y.itemInfo.dynamic.ItemDynamic.ItemDynamicSvg.text});case 14:case"end":return k.stop()}},s,this)}))}},{key:"prepareChartData",value:function(r){var s=r.list,g=r.previousDate,o=r.currentDate,p=r.month,y=[],T=[];return s.list.sort(function(U,S){return U.timestamp-S.timestamp}).forEach(function(U){if(1e3*U.timestamp<g){var S=new Date(g);S.setDate(S.getDate()-3),y.length>0?(y[0].x="".concat(S.getDate()," ").concat(p[S.getMonth()]," ").concat(S.getFullYear()),y[0].y=U.min,y[0].time=1e3*U.timestamp,y[0].dateStr="".concat(S.getDate()," ").concat(p[S.getMonth()])):y.push({x:"".concat(S.getDate()," ").concat(p[S.getMonth()]," ").concat(S.getFullYear()),y:U.min,time:1e3*U.timestamp,dateStr:"".concat(S.getDate()," ").concat(p[S.getMonth()])})}if(1e3*U.timestamp>g&&1e3*U.timestamp<o){var H=new Date(1e3*U.timestamp);T.push(U.min),y.push({x:"".concat(H.getDate()," ").concat(p[H.getMonth()]," ").concat(H.getFullYear()),y:U.min,time:1e3*U.timestamp,dateStr:"".concat(H.getDate()," ").concat(p[H.getMonth()])})}}),{dataPriceDate:y,arrMinPrice:T}}},{key:"getArrayFromPeriodDate",value:function(r,s,g){var o=[];for((r=new Date(r)).setDate(r.getDate()-3),(s=new Date(s)).setDate(s.getDate()+3),o.push("".concat(new Date(r).getDate()," ").concat(g[new Date(r).getMonth()]," ").concat(new Date(r).getFullYear()));r<s;)(r=new Date(r)).setDate(r.getDate()+1),o.push("".concat(new Date(r).getDate()," ").concat(g[new Date(r).getMonth()]," ").concat(new Date(r).getFullYear()));return o}},{key:"prepareChart",value:function(r,s,g,o){return{signPrice:o,labels:s,datasets:[{data:r,backgroundColor:"transparent",borderColor:"#bce0fc",pointBackgroundColor:"#00A8FF",pointBorderColor:"#00A8FF",tension:.5}],options:{bezierCurve:!0,plugins:{legend:{display:!1},tooltip:{mode:"nearest",intersect:!1,displayColors:!1,callbacks:{}}},scales:{y:{beginAtZero:!0,grid:{borderDash:[5,5]},ticks:{min:0,stepSize:Math.ceil(Math.ceil(g+.1*g)/4)}},x:{grid:{display:!1},ticks:{display:!1}}}}}}},{key:"historyInfo",value:function(r){var s=r.targetInfo.itemInfo,g=r.historyItems;return s&&r&&g?r.historyItems.map(function(o){return{productDetailUrl:o.urlItem,productImage:o.imageItem,productTitle:o.name,minPrice:u.getPrice(o.priceLastMin,s.dynamic.currency.sign),orders:o.countSoldItem,reviews:o.countReviewsItem,sellerResumeStatusItem:{icon:"smile_"+o.sellerResumeStatusItem,value:o.sellerResumeScoreItem.value},priceDynamicItem:{icon:o.priceDynamicItem.ItemDynamic.ItemDynamicSvg.icon,svgIcon:o.priceDynamicItem.ItemDynamic.ItemDynamicSvg.svg,value:"".concat(o.priceDynamicItem.sign," ").concat(u.getPrice(o.priceDynamicItem.value,o.priceDynamicItem.currency.sign))}}}):null}},{key:"setUpHistoryItems",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var g,o,p;return B().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.getHistoryItems();case 2:return g=T.sent,o=g.slice(),p=this.setHistoryItems(g,r.id,r),D.V.set("historyItems",p),r.historyItems=this.setHistoryItemUrl(o,r.merchant),T.abrupt("return",r);case 8:case"end":return T.stop()}},s,this)}))}},{key:"clearHistoryItems",value:function(){return(0,E.mG)(this,void 0,void 0,B().mark(function r(){var s;return B().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,D.V.syncGet("historyItems");case 2:return s=o.sent,D.V.set("historyItems",[s.pop()]),o.abrupt("return",!0);case 5:case"end":return o.stop()}},r)}))}},{key:"setHistoryItemUrl",value:function(r,s){var g=s.id,o=s.isActivated;return r.map(function(p){return b.cQ.isAliexpressCis(g)||(p.urlItem=o?b.cQ.getGoUrlItem(g,p.urlItem):b.cQ.getViewUrlItem(g,p.urlItem)),p})}},{key:"setHistoryItems",value:function(r,s,g){if(r.find(function(p){return p.idItem===s}))return r;var o=this.createHistoryItem(s,g);return r.concat([o])}},{key:"createHistoryItem",value:function(r,s){var g=new URL(s.targetInfo.itemInfo.url);return{idItem:r,nameItem:s.targetInfo.itemInfo.name,countReviewsItem:s.productReviewsText?parseInt(s.productReviewsText,10):"-",countSoldItem:s.countSoldItemText?parseInt(s.countSoldItemText,10):"-",urlItem:g.origin+g.pathname,imageItem:s.targetInfo.itemInfo.img,sellerResumeScoreItem:s.targetInfo.itemInfo.seller.resume.score,sellerResumeStatusItem:s.targetInfo.itemInfo.seller.resume.decodeNotes.notesScore.status,priceDynamicItem:s.targetInfo.itemInfo.dynamic,priceLastMin:s.targetInfo.itemInfo.priceLast.min}}},{key:"getHistoryItems",value:function(){return(0,E.mG)(this,void 0,void 0,B().mark(function r(){var s;return B().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,D.V.syncGet("historyItems");case 2:return s=o.sent,o.abrupt("return",s||[]);case 4:case"end":return o.stop()}},r)}))}},{key:"getSimilarProducts",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var g,o,p,y,T,U,S;return B().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return g=r.data,o=g.runParams,p=g.merchant,y=p.id,T=p.isActivated,U=g.url,r.data.urlsSimilarItems=this.getUrlsSimilarItems(o,U),V.next=4,this.getPriceSimilarProducts(r);case 4:if(!(S=V.sent)||!S.length){V.next=7;break}return V.abrupt("return",S.map(function(z){return b.cQ.isAliexpressCis(y)||(z.productDetailUrl=T?b.cQ.getGoUrlItem(y,z.productDetailUrl):b.cQ.getViewUrlItem(y,z.productDetailUrl)),z}));case 7:return V.abrupt("return",null);case 8:case"end":return V.stop()}},s,this)}))}},{key:"getUrlsSimilarItems",value:function(r,s){if(r){var o=r.data.recommendModule,p=o.productId,y=o.categoryId,T=o.storeNum,U=o.companyId,S=o.features.recommendGpsScenarioOtherSellerProducts,H=o.features.recommendGpsScenarioTopSelling;return{urlTopSell:this.aliexpressProductsService.getAliSimilarItems(p,y,T,U,H,5),urlOtherSeller:this.aliexpressProductsService.getAliSimilarItems(p,y,T,U,S)}}var V=s.match(new RegExp(/[\d*]{1,}/gim))[0];return V?{urlTopSell:this.aliexpressProductsService.getAliexpressSpecialForYou(V),urlOtherSeller:this.aliexpressProductsService.getAliexpressRecommendation(V),productId:V}:null}},{key:"getPriceInfo",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p,y,T,U,S,H,V,z,ee;return B().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(o=null,p=r.data,y=p.priceData,T=p.href,U=this.application.get("tabs").selectById(r.tabId),S=this.application.get("user"),!s||!m.g.ARRAY_MERCHANTS_PRICE.includes(s.id)){J.next=20;break}return H="".concat(y.id,"_").concat(y.region?"".concat(y.region,"_"):"").concat(y.currencyDisplay),J.next=8,D.V.syncGet(H);case 8:if((V=J.sent)&&!((new Date).getTime()-V.createdAt>m.g.UPDATE_INTERVAL_INFO_HISTORY_PRICE)){J.next=18;break}return z=r.url.includes("http")?r.url:T,J.next=13,this.getTargetInfo(z,y,S);case 13:(V=J.sent).createdAt=(new Date).getTime(),V&&V.itemInfo&&V.itemInfo.dynamic&&(V.itemInfo.dynamic.value>0?V.itemInfo.dynamic.sign="+":V.itemInfo.dynamic.value<0?V.itemInfo.dynamic.sign="-":V.itemInfo.dynamic.sign="",V.itemInfo.dynamic.value=Math.abs(V.itemInfo.dynamic.value),V.itemInfo.dynamic.ItemDynamic=this.getDecodeItemDynamic(V),y&&Object.keys(y).length&&(V.itemInfo.priceLast.dataPricePage=y)),V&&V.itemInfo&&V.itemInfo.seller&&(V.itemInfo.seller.resume.score.value=parseInt(V.itemInfo.seller.resume.score.value,10),V.itemInfo.seller.resume.decodeNotes=this.getDecodeNotes(V)),D.V.set(H,V);case 18:ee=s&&s.get("hasPromoActivated")?this.application.get("offers").get(+s.get("hasPromoActivated")):null,U&&(s.attributes.extendedTab=U.attributes,s.attributes.extendedPromo=ee,o={merchant:s.attributes,isLogin:S.isLogin(),targetInfo:V||"",id:y.id,region:y.region});case 20:return J.abrupt("return",o);case 21:case"end":return J.stop()}},g,this)}))}},{key:"getDecodeItemDynamic",value:function(r){var s={};switch(r.itemInfo.dynamic.type){case m.g.TYPE_NO_CHANGE:s.icon="dynamic_no_changes",s.text="notificationPriceTypeNoChangeText";break;case m.g.TYPE_MINOR_DOWN:s.icon="dynamic_low_down",s.text="notificationPriceTypeMinorDownText";break;case m.g.TYPE_DOWN:s.icon="dynamic_down",s.text="notificationPriceTypeDownText";break;case m.g.TYPE_MINOR_DOWN_AFTER_UP:s.icon="dynamic_down_after_up",s.text="notificationPriceTypeMinorAfterUpText";break;case m.g.TYPE_MINOR_UP_AFTER_DOWN:s.icon="dynamic_up_after_down",s.text="notificationPriceTypeMinorAfterDownText";break;case m.g.TYPE_UP:s.icon="dynamic_up",s.text="notificationPriceTypeUpText";break;case m.g.TYPE_MINOR_UP:s.icon="dynamic_low_up",s.text="notificationPriceTypeMinorUpText"}return{ItemDynamicSvg:s}}},{key:"getDecodeNotes",value:function(r){var g=r.itemInfo.seller.resume;function H(me){var se={};switch(me){case m.g.LEVEL_ERROR:se.color=m.g.LEVEL_ERROR_COLOR,se.status=m.g.LEVEL_ERROR_STATUS;break;case m.g.LEVEL_WARNING:se.color=m.g.LEVEL_WARNING_COLOR,se.status=m.g.LEVEL_WARNING_STATUS;break;case m.g.LEVEL_INFO:se.color=m.g.LEVEL_INFO_COLOR,se.status=m.g.LEVEL_INFO_STATUS}return se}function V(me,se){switch(me){case 0:se.text="notificationPriceTypeScore1";break;case 1:se.text="notificationPriceTypeScore2";break;case 2:se.text="notificationPriceTypeScore3";break;case 3:se.text="notificationPriceTypeScore4"}}function z(me,se){switch(me){case 4:se.text="notificationPriceTypeFeedback1";break;case 5:se.text="notificationPriceTypeFeedback2";break;case 6:se.text="notificationPriceTypeFeedback3";break;case 7:se.text="notificationPriceTypeFeedback4"}}function ee(me,se,Ke){switch(me){case 8:se.text="notificationPriceTypeAge1";break;case 9:se.text="notificationPriceTypeAge2";break;case 10:se.text="notificationPriceTypeAge3",se.textArg=Ke}}function W(me,se){switch(me){case 11:se.text="notificationPriceTypeDescription1";break;case 12:se.text="notificationPriceTypeDescription2";break;case 13:se.text="notificationPriceTypeDescription3";break;case 14:se.text="notificationPriceTypeDescription4";break;case 15:se.text="notificationPriceTypeDescription5"}}function J(me,se){switch(me){case 16:se.text="notificationPriceTypeCommunication1";break;case 17:se.text="notificationPriceTypeCommunication2";break;case 18:se.text="notificationPriceTypeCommunication3";break;case 19:se.text="notificationPriceTypeCommunication4";break;case 20:se.text="notificationPriceTypeCommunication5"}}function X(me,se){switch(me){case 21:se.text="notificationPriceTypeShipping1";break;case 22:se.text="notificationPriceTypeShipping2";break;case 23:se.text="notificationPriceTypeShipping3";break;case 24:se.text="notificationPriceTypeShipping4";break;case 25:se.text="notificationPriceTypeShipping5"}}var Oe,te={color:"",status:"",text:""},k=te,ae=te,he=te,ue=te,_e=te,Te=te,Pe=(0,ie.Z)(g.notes);try{for(Pe.s();!(Oe=Pe.n()).done;){var ve=Oe.value;switch(ve.group){case 0:k=H(ve.level),V(ve.type,k),{notesScore:k};break;case 1:ae=H(ve.level),z(ve.type,ae),{notesFeedback:ae};break;case 2:he=H(ve.level),ee(ve.type,he,ve.tokens[0].value),{notesAge:he};break;case 3:ue=H(ve.level),W(ve.type,ue),{notesDescription:ue};break;case 4:_e=H(ve.level),J(ve.type,_e),{notesCommunication:_e};break;case 5:Te=H(ve.level),X(ve.type,Te),{notesShipping:Te}}}}catch(me){Pe.e(me)}finally{Pe.f()}return{notesScore:k,notesFeedback:ae,notesAge:he,notesDescription:ue,notesCommunication:_e,notesShipping:Te}}},{key:"getPriceChartData",value:function(r,s,g){return(0,E.mG)(this,void 0,void 0,B().mark(function o(){var p,y,T,U,S,H,V,z,ee,W;return B().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(p={data:{itemInfo:g}},X.prev=1,y=r.id,T=r.region,U=r.currencyDisplay,!y||!y.length){X.next=24;break}return S="".concat(y,"_").concat(T?"".concat(T,"_"):"").concat(U,"_chartData"),H="".concat(y,"_").concat(T?"".concat(T,"_"):"").concat(U,"_chartTimeLastUpdated"),X.next=8,D.V.syncGet(H);case 8:if((V=X.sent)&&!(Date.now()-V>m.g.UPDATE_INTERVAL_INFO_HISTORY_PRICE)){X.next=19;break}return X.next=12,this.getPriceHistory(p,s);case 12:if(!(z=X.sent)){X.next=17;break}return D.V.set(S,z),D.V.set(H,Date.now()),X.abrupt("return",z);case 17:X.next=24;break;case 19:return X.next=21,D.V.syncGet(S);case 21:if(!(ee=X.sent)){X.next=24;break}return X.abrupt("return",ee);case 24:X.next=33;break;case 26:return X.prev=26,X.t0=X.catch(1),X.next=30,this.getPriceHistory(p,s);case 30:if(!(W=X.sent)){X.next=33;break}return X.abrupt("return",W);case 33:case"end":return X.stop()}},o,this,[[1,26]])}))}},{key:"getPriceHistory",value:function(r,s){var g=r.data.itemInfo,o=g.priceLast.dataPricePage,p=Object.keys(o).length;return this.getItemHistory(g,o,p,s)}},{key:"getItemHistory",value:function(r,s,g,o){return(0,E.mG)(this,void 0,void 0,B().mark(function p(){var y,T;return B().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return y=new URL("".concat(this.baseUrl).concat(this.itemHistory)),T={id:r.id.id,type:r.id.type,priceMin:r&&0!==g?s.priceMin:"",priceMax:r&&0!==g?s.priceMax:"",currency:r&&0!==g?s.currency:"",priceMinDisplay:r&&0!==g?s.priceMinDisplay:"",priceMaxDisplay:r&&0!==g?s.priceMaxDisplay:"",currencyDisplay:r&&0!==g?s.currencyDisplay:"",timezone:r&&0!==g?s.timezone:""},Object.keys(T).forEach(function(H){y.searchParams.append(H,T[H])}),S.abrupt("return",this.httpClient.get(y.href,{headers:this.getHeaders(o)}).toPromise().then(function(H){return H}));case 4:case"end":return S.stop()}},p,this)}))}},{key:"getHeaders",value:function(r,s){var g=r.attributes?r.attributes:r;return{Accept:"application/json","Content-Type":"application/json","app-token":m.g.APP_TOKEN,"extension-token":g.tokenCookies&&g.tokenCookies.eaetkn?g.tokenCookies.eaetkn:"","user-token":g.tokenCookies&&g.tokenCookies.eautkn?g.tokenCookies.eautkn:"",referrer:s||"","version-ext":chrome.runtime.getManifest().version}}},{key:"getPriceSimilarProducts",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var g,o,p,y,T,U,S,V,z;return B().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(g=r.data.merchant.id,o=this.application.get("user"),p=[],W.prev=3,null===r.data.urlsSimilarItems||!m.g.ARRAY_MERCHANTS_PRICE_SELLER.includes(g)){W.next=31;break}if(r.data.urlsSimilarItems.productId){W.next=15;break}return W.next=8,this.aliexpressProductsService.getAliexpressSimilarItems(r.data.urlsSimilarItems.urlTopSell);case 8:return y=W.sent,W.next=11,this.aliexpressProductsService.getAliexpressSimilarItems(r.data.urlsSimilarItems.urlOtherSeller);case 11:T=W.sent,p=y.concat(T),W.next=22;break;case 15:return W.next=17,this.aliexpressProductsService.getAliexpressRecommendationSimilarItems(r.data.urlsSimilarItems.urlTopSell);case 17:return U=W.sent,W.next=20,this.aliexpressProductsService.getAliexpressRecommendationSimilarItems(r.data.urlsSimilarItems.urlOtherSeller);case 20:S=W.sent,p=U.concat(S);case 22:return W.next=24,b.cQ.matchLocaleCookie(m.g.NO_ALI_AFFILIATE_COUNTRY);case 24:if(!W.sent){W.next=31;break}return V=p.map(function(J){return{input:J.productId}}),W.next=29,this.checkArrayAffiliateAliItems(V,o);case 29:z=W.sent,p=p.filter(function(J){return z.list.find(function(X){return X.input===J.productId&&!!X.result})});case 31:W.next=36;break;case 33:W.prev=33,W.t0=W.catch(3),console.error(W.t0);case 36:return W.abrupt("return",p.filter(function(J){return J&&J.productId}));case 37:case"end":return W.stop()}},s,this,[[3,33]])}))}},{key:"checkAffiliateAliItem",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){return B().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",this.httpClient.post("".concat(this.baseUrl).concat(this.affiliateCheck),JSON.stringify({input:r}),{headers:this.getHeaders(s)}).toPromise().then(function(y){return y}));case 1:case"end":return p.stop()}},g,this)}))}},{key:"checkArrayAffiliateAliItems",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){return B().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",this.httpClient.post("".concat(this.baseUrl).concat(this.affiliateCheckList),JSON.stringify({list:r}),{headers:this.getHeaders(s)}).toPromise().then(function(y){return y}));case 1:case"end":return p.stop()}},g,this)}))}},{key:"getTargetInfo",value:function(r,s,g){return(0,E.mG)(this,void 0,void 0,B().mark(function o(){var p,y,T;return B().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=Object.keys(s).length,y=new URL("".concat(this.baseUrl).concat(this.itemInfo)),T={url:r,priceMin:s&&0!==p?s.priceMin:"",priceMax:s&&0!==p?s.priceMax:"",currency:s&&0!==p?s.currency:"",priceMinDisplay:s&&0!==p?s.priceMinDisplay:"",priceMaxDisplay:s&&0!==p?s.priceMaxDisplay:"",currencyDisplay:s&&0!==p?s.currencyDisplay:"",timezone:s&&0!==p?s.timezone:""},Object.keys(T).forEach(function(H){y.searchParams.append(H,T[H])}),S.abrupt("return",this.httpClient.get(y.href,{headers:this.getHeaders(g)}).toPromise().then(function(H){return H}));case 5:case"end":return S.stop()}},o,this)}))}}]),l}();K.\u0275fac=function(f){return new(f||K)(F.LFG(C.H7),F.LFG(A.P),F.LFG(R.q),F.LFG(G.eN))},K.\u0275prov=F.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"});var u=function(){function l(){(0,I.Z)(this,l)}return(0,x.Z)(l,null,[{key:"getPrice",value:function(r,s){var g=parseFloat(r.toFixed(2)).toLocaleString("en").replace(/,/g," ");return"\u20bd"===s?"".concat(g," \u0440\u0443\u0431."):"".concat(s).concat(g)}}]),l}()},7020:function(ge,le,O){O.d(le,{Q:function(){return d}});var ie=O(5134),q=O(7289),I=O(8774),x=O.n(I),Y=O(4762),B=O(7301),E=O(138),d=function(){function m(){(0,ie.Z)(this,m)}return(0,q.Z)(m,[{key:"now",get:function(){return(new Date).getTime()}},{key:"get",value:function(A,D){return(0,Y.mG)(this,void 0,void 0,x().mark(function F(){var C,R,G;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,B.V.syncGet(m.createKey(A,D));case 2:if(u.t0=u.sent,u.t0){u.next=5;break}u.t0={};case 5:if(C=u.t0,R=C.payload,G=C.expired,!(R&&G&&G>this.now)){u.next=10;break}return u.abrupt("return",R);case 10:return u.abrupt("return",null);case 11:case"end":return u.stop()}},F,this)}))}},{key:"set",value:function(A,D,F,C){B.V.set(m.createKey(A,D),{payload:C,expired:this.now+F})}},{key:"remove",value:function(A,D){B.V.remove(m.createKey(A,D))}}],[{key:"createKey",value:function(A,D){return"".concat(A,".").concat(D)}}]),m}();d.\u0275fac=function(b){return new(b||d)},d.\u0275prov=E.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},617:function(ge,le,O){O.d(le,{G:function(){return b}});var ie=O(5134),q=O(7289),I=O(8774),x=O.n(I),Y=O(4762),B=(0,q.Z)(function A(D){(0,ie.Z)(this,A),this.id=D.id,this.name=D.name,this.shortName=D.shortName,this.machineName=D.machineName,this.parentId=D.parentId,this.weight=D.weight,this.count=D.count,this.attribute=D.attribute,this.mapping=D.mapping}),E=O(138),d=O(7020),m=O(2233),b=function(){function A(D,F){(0,ie.Z)(this,A),this.cacheService=D,this.eapiService=F,this.cachePrefix="merchants",this.cacheCategoriesKey="categories",this.cacheCategoriesTime=72e5}return(0,q.Z)(A,[{key:"fetch",value:function(){var F=this;this.eapiService.getMerchantsCategories().then(function(C){if(C&&C.data){var R=C.data,G=A.serialize(R);G&&F.cacheService.set(F.cachePrefix,F.cacheCategoriesKey,F.cacheCategoriesTime,G)}})}},{key:"categories",get:function(){return this.cacheService.get(this.cachePrefix,this.cacheCategoriesKey)}},{key:"getById",value:function(F){return(0,Y.mG)(this,void 0,void 0,x().mark(function C(){var R;return x().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this.categories;case 2:return R=K.sent,K.abrupt("return",R[F]);case 4:case"end":return K.stop()}},C,this)}))}},{key:"getByIds",value:function(F){return(0,Y.mG)(this,void 0,void 0,x().mark(function C(){var R,G;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.categories;case 2:return R=u.sent,G=[],F.forEach(function(l){G.push(R[l])}),u.abrupt("return",G);case 6:case"end":return u.stop()}},C,this)}))}}],[{key:"serialize",value:function(F){var C={};return F.forEach(function(R){C[R.id]=new B(R)}),C}}]),A}();b.\u0275fac=function(D){return new(D||b)(E.LFG(d.Q),E.LFG(m.B))},b.\u0275prov=E.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})},2608:function(ge,le,O){O.d(le,{P:function(){return u},I:function(){return l}});var K,ie=O(5134),q=O(7289),I=O(3512),x=O(8774),Y=O.n(x),B=O(4762),E=O(9725),d=O(4945),m=O(7969),b=O(8168),A=O(8372),D=O(6418),F=O(9244),C=O(138),R=O(7020),G=O(5446),u=(K={},(0,I.Z)(K,D.YA.CODE,"/catalog/dt-promocode"),(0,I.Z)(K,D.YA.DISCOUNT,"/catalog/dt-discount"),(0,I.Z)(K,D.YA.STOCK,"/catalog/dt-stock"),K),l=function(){function f(r,s,g,o){(0,ie.Z)(this,f),this.httpClient=r,this.cacheService=s,this.localeService=g,this.featureService=o,this.offersUrl="/api/v1/offers",this.queryLimitKey="limit",this.queryLimitValue=50,this.prefix="club",this.cachePopupOffersKey="popup.offers",this.cachePopupOffersTime=18e5}return(0,q.Z)(f,[{key:"baseUrl",get:function(){return A.S._club}},{key:"isAvailable",value:function(){return(0,B.mG)(this,void 0,void 0,Y().mark(function s(){return Y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.featureService.isFeatureEnable(F.U.BEST_DEALS));case 1:case"end":return o.stop()}},s,this)}))}},{key:"country",get:function(){return this.localeService.country}},{key:"cachePrefix",get:function(){return this.prefix+"_"+this.country}},{key:"getOffers",value:function(){return(0,B.mG)(this,void 0,void 0,Y().mark(function s(){var o,p,g=this;return Y().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.prev=0,T.next=3,this.cacheService.get(this.cachePrefix,this.cachePopupOffersKey);case 3:if(!(o=T.sent)||!o.length){T.next=6;break}return T.abrupt("return",o);case 6:return p=(new E.LE).set(this.queryLimitKey,this.queryLimitValue.toString()).set("strategy","lite").set("country",this.country),T.abrupt("return",this.httpClient.get("".concat(this.baseUrl).concat(this.offersUrl),{params:p}).pipe((0,m.U)(function(U){var S=U.data;return(0,d.of)(f.serializeOffers(S))}),(0,b.b)(function(U){return(0,B.mG)(g,void 0,void 0,Y().mark(function S(){var H;return Y().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,U.toPromise();case 2:(H=z.sent)&&this.cacheService.set(this.cachePrefix,this.cachePopupOffersKey,this.cachePopupOffersTime,H);case 4:case"end":return z.stop()}},S,this)}))}),(0,m.U)(function(U){return U.toPromise()})).toPromise());case 10:T.prev=10,T.t0=T.catch(0),console.error("Club offers fetching is failed!");case 13:case"end":return T.stop()}},s,this,[[0,10]])}))}},{key:"clearCacheOffers",value:function(){this.cacheService.remove(this.cachePrefix,this.cachePopupOffersKey)}}],[{key:"serializeOffers",value:function(s){var g=[];return s.forEach(function(o){D.YA[o.offerType]&&g.push(new D.tX(o))}),g}}]),f}();l.\u0275fac=function(r){return new(r||l)(C.LFG(E.eN),C.LFG(R.Q),C.LFG(G.O),C.LFG(F.U))},l.\u0275prov=C.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})},7256:function(ge,le,O){O.d(le,{E:function(){return E}});var ie=O(5134),q=O(7289),I=O(8774),x=O.n(I),Y=O(4762),B=O(7301),E=function(){function d(){(0,ie.Z)(this,d),this.configKey="config",this.parameters={UPDATE_INTERVAL_MERCHANT:72e5,UPDATE_INTERVAL_OFFERS:9e5,UPDATE_INTERVAL_CODES:72e5,UPDATE_INTERVAL_SETTINGS:72e5,UPDATE_INTERVAL_URLS:72e5,PROMO_NOTIFY_PERIOD:36e5,R_LIST_ADD_PERIOD:432e5,USER_NOTIFY_INTERVAL:3e5,INTERVAL_COUNT_USER_CASHBACK_RATES:3e5,INTERVAL_COUNT_CLUB_OFFERS:18e6,INTERVAL_COUNT_SETTINGS_BY_SEGMENT:72e5,UPDATE_INTERVAL_USER_FORCE:144e5,INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR:72e5,UPDATE_INTERVAL_AUTOPROMO:36e5,INTERVAL_SHOPPING_TRIP_ID:36e5,UPDATE_INTERVAL_USER_PARTNER_SETTINGS:216e5,UPDATE_INTERVAL_INFO_SIMILAR:12e4,GREEN_LIGHT_BOOKING_END_TIME:1635724799e3}}return(0,q.Z)(d,[{key:"getParameter",value:function(b){return(0,Y.mG)(this,void 0,void 0,x().mark(function A(){var D;return x().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,B.V.syncGet(this.configKey);case 2:return void 0!==(D=C.sent)&&Object.keys(D).length===Object.keys(this.parameters).length&&D[b]?this.parameters=D:B.V.set(this.configKey,this.parameters),C.abrupt("return",this.parameters[b]);case 5:case"end":return C.stop()}},A,this)}))}},{key:"updateConfig",value:function(b){var A=this;B.V.syncGet(this.configKey).then(function(D){return(0,Y.mG)(A,void 0,void 0,x().mark(function F(){var C,R,G;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:for(C=0,R=Object.keys(b);C<R.length;C++)G=R[C],D[G]=b[G];B.V.set(this.configKey,D);case 2:case"end":return u.stop()}},F,this)}))})}}]),d}();E.UPDATE_INTERVAL_MERCHANT="UPDATE_INTERVAL_MERCHANT",E.UPDATE_INTERVAL_OFFERS="UPDATE_INTERVAL_OFFERS",E.UPDATE_INTERVAL_CODES="UPDATE_INTERVAL_CODES",E.UPDATE_INTERVAL_SETTINGS="UPDATE_INTERVAL_SETTINGS",E.UPDATE_INTERVAL_URLS="UPDATE_INTERVAL_URLS",E.PROMO_NOTIFY_PERIOD="PROMO_NOTIFY_PERIOD",E.R_LIST_ADD_PERIOD="R_LIST_ADD_PERIOD",E.USER_NOTIFY_INTERVAL="USER_NOTIFY_INTERVAL",E.INTERVAL_COUNT_USER_CASHBACK_RATES="INTERVAL_COUNT_USER_CASHBACK_RATES",E.INTERVAL_COUNT_CLUB_OFFERS="INTERVAL_COUNT_CLUB_OFFERS",E.INTERVAL_COUNT_SETTINGS_BY_SEGMENT="INTERVAL_COUNT_SETTINGS_BY_SEGMENT",E.UPDATE_INTERVAL_USER_FORCE="UPDATE_INTERVAL_USER_FORCE",E.UPDATE_INTERVAL_AUTOPROMO="UPDATE_INTERVAL_AUTOPROMO",E.INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR="INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR",E.INTERVAL_SHOPPING_TRIP_ID="INTERVAL_SHOPPING_TRIP_ID",E.UPDATE_INTERVAL_USER_PARTNER_SETTINGS="UPDATE_INTERVAL_USER_PARTNER_SETTINGS",E.UPDATE_INTERVAL_INFO_SIMILAR="UPDATE_INTERVAL_INFO_SIMILAR",E.GREEN_LIGHT_BOOKING_END_TIME="GREEN_LIGHT_BOOKING_END_TIME"},2233:function(ge,le,O){O.d(le,{B:function(){return F}});var ie=O(5134),q=O(7289),I=O(8774),x=O.n(I),Y=O(4762),B=O(8372),E=O(9433),d=O(5848),m=O(2522),b=O(7301),A=O(138),D=O(9725),F=function(){function C(R,G){(0,ie.Z)(this,C),this.httpClient=R,this.eventService=G,this.versionExt="version-ext",this.locale="locale",this.domain="domain",this.baseUrl=B.S._api,this.pathLogShoppingTrip="/log-shopping-trip",this.pathSettingsSimpleSimilar="/settings/simple-similar",this.pathSimpleSimilarOffers="/simple-similar/offers",this.pathUserPartnerData="/user/partner-system",this.promoNotifications="/promo-notifications",this.advices="/user/advices",this.categoriesUrl="/shop-categories"}return(0,q.Z)(C,[{key:"getHeaders",value:function(){return(0,Y.mG)(this,void 0,void 0,x().mark(function G(){var K;return x().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,b.V.syncGet("locale");case 2:return K=l.sent,l.abrupt("return",{"Content-Type":"application/json","extension-version":this.getExtensionVersion(),locale:K});case 4:case"end":return l.stop()}},G,this)}))}},{key:"getExtensionVersion",value:function(){return chrome.runtime.getManifest().version}},{key:"sendLogShoppingTripEvent",value:function(G){return(0,Y.mG)(this,void 0,void 0,x().mark(function K(){var u;return x().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.getHeaders();case 2:u=f.sent,this.httpClient.post("".concat(this.baseUrl).concat(this.pathLogShoppingTrip),JSON.stringify(G),{headers:u}).toPromise().then(function(r){return r}).catch(function(r){return console.error(r)});case 4:case"end":return f.stop()}},K,this)}))}},{key:"getSimpleSimilarSettings",value:function(G){return(0,Y.mG)(this,void 0,void 0,x().mark(function K(){var u,l,f,r;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,b.V.syncGet("locale");case 2:return u=g.sent,g.next=5,this.getHeaders();case 5:return l=g.sent,f="".concat(u?"&".concat(this.locale,"=").concat(u):"").concat(G?"&".concat(this.domain,"=").concat(G):""),r="".concat(this.baseUrl).concat(this.pathSettingsSimpleSimilar,"?").concat(this.versionExt,"=").concat(this.getExtensionVersion()).concat(f),g.abrupt("return",this.httpClient.get(r,{headers:l}).toPromise().then(function(o){return o}));case 9:case"end":return g.stop()}},K,this)}))}},{key:"getSimpleSimilarOffers",value:function(){return(0,Y.mG)(this,void 0,void 0,x().mark(function G(){var K;return x().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return b.V.set("simpleSimilarOffers",{lastUpdate:null}),l.next=3,this.getHeaders();case 3:return K=l.sent,l.abrupt("return",this.httpClient.get("".concat(this.baseUrl).concat(this.pathSimpleSimilarOffers),{headers:K}).toPromise().then(function(f){var r=f||{};return r.lastUpdate=Date.now(),b.V.set("simpleSimilarOffers",r),r}).catch(function(f){return console.error(f),{}}));case 5:case"end":return l.stop()}},G,this)}))}},{key:"getPartnerSystemData",value:function(){return(0,Y.mG)(this,void 0,void 0,x().mark(function G(){var K;return x().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.getHeaders();case 2:return K=l.sent,l.abrupt("return",this.httpClient.get("".concat(this.baseUrl).concat(this.pathUserPartnerData),{headers:K}).toPromise().then(function(f){return!(!f||!f.title&&!f.description)&&(b.V.set("userPartnerData",d.cQ.objectKeysTransform(f)),d.cQ.objectKeysTransform(f))}));case 4:case"end":return l.stop()}},G,this)}))}},{key:"getPromoNotifications",value:function(){return(0,Y.mG)(this,void 0,void 0,x().mark(function G(){var u,l,f,K=this;return x().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.getHeaders();case 2:return u=s.sent,s.next=5,b.V.syncGet("locale");case 5:l=s.sent,f="".concat(this.baseUrl).concat(this.promoNotifications,"?locale=").concat(l||"".concat(E.g.DEFAULT_LANGUAGE,"_").concat(E.g.DEFAULT_COUNTRY)),this.httpClient.get(f,{headers:u}).toPromise().then(function(g){b.V.set("promoNotifications",g);for(var o=[],p=0,y=Object.keys(g);p<y.length;p++){var T=y[p];o.push({id:g[T].id,type:"promo"})}b.V.syncGet("fetchPromoNotification").then(function(U){if(null==U)K.eventService.fireEvent(m.P.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:o,notificationEvent:"fetchPromoNotification"}});else{var S=o.filter(function(H,V){return H.id!==(U[V]?U[V].id:null)});Array.isArray(S)&&S.length>0&&K.eventService.fireEvent(m.P.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:S,notificationEvent:"fetchPromoNotification"}})}b.V.set("fetchPromoNotification",o)})});case 8:case"end":return s.stop()}},G,this)}))}},{key:"getAdvices",value:function(G){return(0,Y.mG)(this,void 0,void 0,x().mark(function K(){var u,l,f,r;return x().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:for(u=new FormData,l=0,f=Object.keys(G);l<f.length;l++)r=f[l],u.append(r,G[r]);return g.abrupt("return",this.httpClient.post("".concat(this.baseUrl).concat(this.advices),u).toPromise().then(function(o){return o}));case 3:case"end":return g.stop()}},K,this)}))}},{key:"getMerchantsCategories",value:function(){return(0,Y.mG)(this,void 0,void 0,x().mark(function G(){var K,u,l,f;return x().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,b.V.syncGet("locale");case 2:return K=s.sent,s.next=5,b.V.syncGet("deliveryCountry");case 5:return u=s.sent,l=u?"&delivery_country=".concat(u):"",f="?locale=".concat(K||"".concat(E.g.DEFAULT_LANGUAGE,"_").concat(E.g.DEFAULT_COUNTRY),"\n\t\t&version-ext=").concat(chrome.runtime.getManifest().version).concat(l),s.abrupt("return",this.httpClient.get("".concat(this.baseUrl).concat(this.categoriesUrl).concat(f)).toPromise().then(function(g){return g}));case 9:case"end":return s.stop()}},G,this)}))}}]),C}();F.\u0275fac=function(R){return new(R||F)(A.LFG(D.eN),A.LFG(m.P))},F.\u0275prov=A.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"})},2522:function(ge,le,O){O.d(le,{P:function(){return d}});var ie=O(6054),q=O(5134),I=O(7289),x=O(8774),Y=O.n(x),B=O(4762),E=O(138),d=function(){function m(){(0,q.Z)(this,m)}return(0,I.Z)(m,[{key:"attachEvent",value:function(A,D){var F=this;chrome.runtime.onMessage.addListener(function(C,R,G){return(0,B.mG)(F,void 0,void 0,Y().mark(function K(){return Y().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(A!==C.name){l.next=8;break}return C.url=R.url,C.tab=R.tab,l.t0=G,l.next=6,D(C);case 6:l.t1=l.sent,(0,l.t0)(l.t1);case 8:case"end":return l.stop()}},K)})),!0})}},{key:"fireEvent",value:function(A){var D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(F){var C={action:"event",name:A,data:D.data?D.data:D},R=D.tabId,G=D.extensionId;-4===R?chrome.tabs.query({},function(K){var l,u=(0,ie.Z)(K);try{for(u.s();!(l=u.n()).done;){var f=l.value;chrome.tabs.sendMessage(f.id,C)}}catch(r){u.e(r)}finally{u.f()}}):R?chrome.tabs.sendMessage(R,C,function(K){F(K)}):G?chrome.runtime.sendMessage(G,C,function(K){F(K)}):chrome.runtime.sendMessage(C,function(K){F(K)})})}}]),m}();d.LETYSHOPS="LETYSHOPS_",d.SEND_THANKS_PAGE_PARAMETERS="".concat(d.LETYSHOPS,"SEND_THANKS_PAGE_PARAMETERS"),d.GET_THANKS_PAGE_PARAMETERS="".concat(d.LETYSHOPS,"GET_THANKS_PAGE_PARAMETERS"),d.FETCH_SIMPLE_SIMILAR_AUTOPROMO="".concat(d.LETYSHOPS,"FETCH_SIMPLE_SIMILAR_AUTOPROMO"),d.NOTIFICATION_GET_PRICE_SIMILAR_PRODUCTS="".concat(d.LETYSHOPS,"NOTIFICATION_GET_PRICE_SIMILAR_PRODUCTS"),d.GET_TOKEN_COOKIES="".concat(d.LETYSHOPS,"GET_TOKEN_COOKIES"),d.GET_PRICE_HISTORY="".concat(d.LETYSHOPS,"GET_PRICE_HISTORY"),d.SEND_LETYTOOL_EVENT="".concat(d.LETYSHOPS,"SEND_LETYTOOL_EVENT"),d.CHECK_ALIEXPRESS_AFF_PRODUCT="".concat(d.LETYSHOPS,"CHECK_ALIEXPRESS_AFF_PRODUCT"),d.NOTIFICATION_GET_SIMILAR_LIST="".concat(d.LETYSHOPS,"NOTIFICATION_GET_SIMILAR_LIST"),d.GET_IMAGE_SEARCH_ITEMS="".concat(d.LETYSHOPS,"GET_IMAGE_SEARCH_ITEMS"),d.SEND_GOOGLE_ANALYTICS="".concat(d.LETYSHOPS,"SEND_GOOGLE_ANALYTICS"),d.SEND_GA_CID="".concat(d.LETYSHOPS,"SEND_GA_CID"),d.SEND_TO_GOOGLE_FORM="".concat(d.LETYSHOPS,"SEND_TO_GOOGLE_FORM"),d.CREATE_ADVICES="".concat(d.LETYSHOPS,"CREATE_ADVICES"),d.REFRESH_ALL="".concat(d.LETYSHOPS,"REFRESH_ALL"),d.GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK="".concat(d.LETYSHOPS,"GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK"),d.GET_PAGE_COOKIES="".concat(d.LETYSHOPS,"GET_PAGE_COOKIES"),d.GET_CLUB_OFFERS="".concat(d.LETYSHOPS,"GET_CLUB_OFFERS"),d.GET_IMAGE_INITIAL_BASE_64="".concat(d.LETYSHOPS,"GET_IMAGE_INITIAL_BASE_64"),d.SENT_LOG_SHOPPING_TRIP="".concat(d.LETYSHOPS,"SENT_LOG_SHOPPING_TRIP"),d.IS_BROWSER="".concat(d.LETYSHOPS,"IS_BROWSER"),d.GET_USER_PARTNER_DATA="".concat(d.LETYSHOPS,"GET_USER_PARTNER_DATA"),d.USER_UPDATE="".concat(d.LETYSHOPS,"USER_UPDATE"),d.UPDATE_USER_FORCE="".concat(d.LETYSHOPS,"UPDATE_USER_FORCE"),d.ON_USER_LOGIN="".concat(d.LETYSHOPS,"ON_USER_LOGIN"),d.ON_USER_LOGOUT="".concat(d.LETYSHOPS,"ON_USER_LOGOUT"),d.LOAD_USER_LANGUAGE="".concat(d.LETYSHOPS,"LOAD_USER_LANGUAGE"),d.SEND_USER_NOTIFICATION_LOGS="".concat(d.LETYSHOPS,"SEND_USER_NOTIFICATION_LOGS"),d.CASHBACK_DEACTIVATE="".concat(d.LETYSHOPS,"CASHBACK_DEACTIVATE"),d.PRICE_MONITORING_GET_DATA="".concat(d.LETYSHOPS,"PRICE_MONITORING_GET_DATA"),d.PRICE_MONITORING_GET_CHART_DATA="".concat(d.LETYSHOPS,"PRICE_MONITORING_GET_CHART_DATA"),d.PRICE_MONITORING_GET_SIMILAR_PRODUCTS="".concat(d.LETYSHOPS,"PRICE_MONITORING_GET_SIMILAR_PRODUCTS"),d.PRICE_MONITORING_GET_PRICE_SELLER_PAGE_DATA="".concat(d.LETYSHOPS,"PRICE_MONITORING_GET_PRICE_SELLER_PAGE_DATA"),d.PRICE_MONITORING_CLEAR_HISTORY="".concat(d.LETYSHOPS,"PRICE_MONITORING_CLEAR_HISTORY"),d.UPDATE_FAVORITE_STATUS_FROM_BG="".concat(d.LETYSHOPS,"UPDATE_FAVORITE_STATUS_FROM_BG"),d.UPDATE_FAVORITE_STATUS="".concat(d.LETYSHOPS,"UPDATE_FAVORITE_STATUS"),d.GET_VALID_AUTOPROMO_OFFERS="".concat(d.LETYSHOPS,"GET_VALID_AUTOPROMO_OFFERS"),d.GET_ALL_MERCHANTS_AND_AUTOPROMO_POPUP="".concat(d.LETYSHOPS,"GET_ALL_MERCHANTS_AND_AUTOPROMO_POPUP"),d.GET_API_CLIENT_URLS_STATE="".concat(d.LETYSHOPS,"GET_API_CLIENT_URLS_STATE"),d.CHECK_MERCHANT_COOKIES="".concat(d.LETYSHOPS,"CHECK_MERCHANT_COOKIES"),d.SET_MERCHANT_COOKIES="".concat(d.LETYSHOPS,"SET_MERCHANT_COOKIES"),d.CLEAR_COOKIES="".concat(d.LETYSHOPS,"CLEAR_COOKIES"),d.\u0275fac=function(b){return new(b||d)},d.\u0275prov=E.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},9244:function(ge,le,O){O.d(le,{U:function(){return m}});var ie=O(5134),q=O(7289),I=O(8774),x=O.n(I),Y=O(4762),B=O(5848),E=O(7301),d=O(138),m=function(){function b(){(0,ie.Z)(this,b),this.domain=B.cQ.getDomain(window.location.href)}return(0,q.Z)(b,[{key:"isFeatureEnable",value:function(D){return(0,Y.mG)(this,void 0,void 0,x().mark(function F(){return x().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.isFeatureEnableOnEapi(D);case 2:if(l.sent){l.next=5;break}return l.abrupt("return",!1);case 5:return l.next=7,this.isFeatureEnableOnUserSettings(D);case 7:if(l.sent){l.next=10;break}return l.abrupt("return",!1);case 10:return l.next=12,this.checkByAvailableCountry(D);case 12:if(l.sent){l.next=15;break}return l.abrupt("return",!1);case 15:return l.next=17,this.checkDomainInFeatureDisabledHosts(D);case 17:if(!l.sent){l.next=20;break}return l.abrupt("return",!1);case 20:return l.abrupt("return",!0);case 21:case"end":return l.stop()}},F,this)}))}},{key:"isFeatureEnableOnEapi",value:function(D){return(0,Y.mG)(this,void 0,void 0,x().mark(function F(){var C;return x().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,this.getSettings();case 2:return C=G.sent,G.abrupt("return",!!C&&C.features&&C.features.hasOwnProperty(D)&&C.features[D].enabled);case 4:case"end":return G.stop()}},F,this)}))}},{key:"isFeatureEnableOnUserSettings",value:function(D){return(0,Y.mG)(this,void 0,void 0,x().mark(function F(){var C;return x().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:G.t0=D,G.next=G.t0===b.SIMILAR?3:G.t0===b.SIMPLE_SIMILAR?7:11;break;case 3:return G.next=5,E.V.syncGet(b.SIMILAR_USER_SETTINGS);case 5:return C=G.sent,G.abrupt("break",12);case 7:return G.next=9,E.V.syncGet(b.SIMPLE_SIMILAR_USER_SETTINGS);case 9:return C=G.sent,G.abrupt("break",12);case 11:C=!0;case 12:return G.abrupt("return","boolean"!=typeof C||C);case 13:case"end":return G.stop()}},F)}))}},{key:"checkDomainInFeatureDisabledHosts",value:function(D){return(0,Y.mG)(this,void 0,void 0,x().mark(function F(){var R,G,C=this;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.getSettings();case 2:return R=u.sent,G=!!R&&R.features.hasOwnProperty(D)&&R.features[D].alwaysDisabledHosts,u.abrupt("return",G&&G.some(function(l){return l===C.domain}));case 5:case"end":return u.stop()}},F,this)}))}},{key:"checkByAvailableCountry",value:function(D){return(0,Y.mG)(this,void 0,void 0,x().mark(function F(){var C,R;return x().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,this.getSettings();case 2:return C=K.sent,R=!!C&&C.features.hasOwnProperty(D)&&C.features[D].countries,K.next=6,B.cQ.matchLocaleCookie(R);case 6:return K.abrupt("return",K.sent);case 7:case"end":return K.stop()}},F,this)}))}},{key:"getSettings",value:function(){return(0,Y.mG)(this,void 0,void 0,x().mark(function D(){return x().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!this.eapiSettings){C.next=4;break}return C.abrupt("return",this.eapiSettings);case 4:return C.next=6,E.V.syncGet("settings");case 6:return this.eapiSettings=C.sent,C.abrupt("return",this.eapiSettings);case 8:case"end":return C.stop()}},D,this)}))}}]),b}();m.SIMPLE_SIMILAR_USER_SETTINGS="showSimpleSimilarInjection",m.SIMILAR_USER_SETTINGS="showSimilarListInjection",m.SIMPLE_SIMILAR="SIMPLE_SIMILAR",m.IMAGE_SEARCH="IMAGE_SEARCH",m.SIMILAR="SIMILAR",m.BEST_DEALS="BEST_DEALS",m.\u0275fac=function(A){return new(A||m)},m.\u0275prov=d.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})},5446:function(ge,le,O){O.d(le,{O:function(){return m}});var ie=O(5134),q=O(7289),I=O(8774),x=O.n(I),Y=O(4762),B=O(9433),E=O(7301),d=O(138),m=function(){function b(){(0,ie.Z)(this,b),E.V.syncGet(b.LOCALE_KEY).then(function(A){A||E.V.set(b.LOCALE_KEY,"".concat(B.g.DEFAULT_LANGUAGE,"_").concat(B.g.DEFAULT_COUNTRY))})}return(0,q.Z)(b,[{key:"load",value:function(D,F){return(0,Y.mG)(this,void 0,void 0,x().mark(function C(){var R,G;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!D||!F){u.next=5;break}this.language=D,this.country=F,u.next=14;break;case 5:return u.next=7,E.V.syncGet(b.LOCALE_KEY);case 7:if(u.t0=u.sent,u.t0){u.next=10;break}u.t0=b.LOCALE_SEPARATOR_SYMBOL;case 10:R=u.t0,G=R.split(b.LOCALE_SEPARATOR_SYMBOL),this.language=G[0],this.country=G[1];case 14:E.V.set(b.LOCALE_KEY,"".concat(this.language,"_").concat(this.country));case 15:case"end":return u.stop()}},C,this)}))}},{key:"locale",get:function(){return"".concat(this.language,"_").concat(this.country)}}]),b}();m.LOCALE_KEY="locale",m.LOCALE_SEPARATOR_SYMBOL="_",m.\u0275fac=function(A){return new(A||m)},m.\u0275prov=d.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})},2990:function(ge,le,O){O.d(le,{G:function(){return u}});var ie=O(6860),q=O(6054),I=O(5134),x=O(7289),Y=O(8774),B=O.n(Y),E=O(4762),d=O(8372),m=O(9433),b=O(5857),A=O(5848),D=O(7256),F=O(2522),C=O(7301),R=O(138),G=O(9725),K=O(9244),u=function(){function l(f,r,s,g){(0,I.Z)(this,l),this.httpClient=f,this.configService=r,this.eventService=s,this.featureService=g,this.cashbackIsAvailable="/api/extension/v1/cashback/is-available",this.eventInform="/api/extension/v1/event/inform",this.productImageDetect="/api/extension/v1/product-by-image/detect",this.similarList="/twirp/letytools.api.v2.SimilarService/list",this.itemHot="/api/extension/v1/item/hot",this.minAvailableApplying=5}return(0,x.Z)(l,[{key:"baseUrl",get:function(){return d.S._tools}},{key:"getHeaders",value:function(r,s){var g=r.attributes?r.attributes:r;return{Accept:"application/json","Content-Type":"application/json","app-token":m.g.APP_TOKEN,"extension-token":g.tokenCookies&&g.tokenCookies.eaetkn?g.tokenCookies.eaetkn:"","user-token":g.tokenCookies&&g.tokenCookies.eautkn?g.tokenCookies.eautkn:"",referrer:s||"","version-ext":chrome.runtime.getManifest().version}}},{key:"sendCashbackIsAvailable",value:function(r,s,g,o){var p=new URL("".concat(this.baseUrl).concat(this.cashbackIsAvailable)),y={url:s.href};Object.keys(y).forEach(function(T){p.searchParams.append(T,y[T])}),this.httpClient.get(p.href,{headers:this.getHeaders(r,g)}).toPromise().then(function(T){var U=A.cQ.getDomain(p),S=U&&o.get("merchants").selectByDomain(U);S?S.set({isCashbackAvailable:{code:T.code,expire:1e3*T.expire,lastTimeRequest:(new Date).getTime()}}):C.V.get("isCashbackAvailable",function(H){if(H){var ee,V=[],z=(0,q.Z)(H);try{for(z.s();!(ee=z.n()).done;){var W=ee.value;V.push(W.url)}}catch(k){z.e(k)}finally{z.f()}if(V.includes(s.host)){var X,J=(0,q.Z)(H);try{for(J.s();!(X=J.n()).done;){var te=X.value;s.host===te.url&&(te.url=s.host,te.code=T.code,te.expire=1e3*T.expire,te.lastTimeRequest=(new Date).getTime())}}catch(k){J.e(k)}finally{J.f()}C.V.set("isCashbackAvailable",H)}else H.push({url:s.host,code:T.code,expire:1e3*T.expire,lastTimeRequest:(new Date).getTime()}),C.V.set("isCashbackAvailable",H)}else(H=[]).push({url:s.host,code:T.code,expire:1e3*T.expire,lastTimeRequest:(new Date).getTime()}),C.V.set("isCashbackAvailable",H)})})}},{key:"getItemHot",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p;return B().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return o=new URL("".concat(this.baseUrl).concat(this.itemHot)),p={url:r},Object.keys(p).forEach(function(U){o.searchParams.append(U,p[U])}),T.abrupt("return",this.httpClient.get(o.href,{headers:this.getHeaders(s)}).toPromise().then(function(U){return U}));case 4:case"end":return T.stop()}},g,this)}))}},{key:"letyToolEvent",value:function(r,s){this.httpClient.post("".concat(this.baseUrl).concat(this.eventInform),JSON.stringify({name:r.data.name,data:r.data.data}),{headers:this.getHeaders(s)}).toPromise().then(function(g){return g})}},{key:"getSimilarList",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){return B().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",this.httpClient.post("".concat(this.baseUrl).concat(this.similarList),JSON.stringify(r),{headers:this.getHeaders(s)}).toPromise().then(function(y){return y}));case 1:case"end":return p.stop()}},g,this)}))}},{key:"getItemImageSearch",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){return B().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",this.httpClient.post("".concat(this.baseUrl).concat(this.productImageDetect),JSON.stringify(r),{headers:this.getHeaders(s)}).toPromise().then(function(y){return y}));case 1:case"end":return p.stop()}},g,this)}))}},{key:"getBase64FromBg",value:function(r){var s=r.url;return this.eventService.fireEvent(F.P.GET_IMAGE_INITIAL_BASE_64,{tabId:null,data:{url:s,options:{format:"image/jpeg",maxWidth:1e3,maxHeight:1e3}}})}},{key:"disableTool",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var g,o,p;return B().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:g=r.type,o=r.placement,p=A.cQ.getDomain(window.location.href),T.t0=o,T.next=T.t0===l.SIMILAR?5:T.t0===l.SIMPLE_SIMILAR?8:11;break;case 5:return T.next=7,this.disableSimilarTool(g,p);case 7:case 10:return T.abrupt("return",T.sent);case 8:return T.next=10,this.disableSimpleSimilarTool(g,p);case 11:case"end":return T.stop()}},s,this)}))}},{key:"fetchDomainData",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){return B().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.eventService.fireEvent(m.g.GET_SIMPLE_SIMILAR_DOMAIN_DATA,{domain:r}));case 1:case"end":return o.stop()}},s,this)}))}},{key:"getSimilarData",value:function(r){var s=this,g=r.token?r.token:"0",o=window.location.pathname,p="".concat(window.location.href.split("#")[0],"_user_").concat(g),y=A.cQ.getDomain(window.location.href),T=this;return new Promise(function(U){return(0,E.mG)(s,void 0,void 0,B().mark(function S(){var H,V,z,ee,W,J;return B().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,T.checkOffersFromStorage({similarKey:p,domainKey:y,pagePathname:o});case 2:if(H=te.sent,V=H.status,z=H.fetch,ee=H.showMinimizedTill,z){te.next=8;break}return te.abrupt("return",U(V));case 8:return te.next=10,T.fetchOffers({user:r,similarKey:p,domainKey:y});case 10:return W=te.sent,te.next=13,T.renderChecker({offer:W,cache:!1,pagePathname:o,showMinimizedTill:ee});case 13:return J=te.sent,te.abrupt("return",U(J));case 15:case"end":return te.stop()}},S)}))})}},{key:"checkOffersFromStorage",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var o,p,y,T,g=this;return B().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return o=r.domainKey,p=r.similarKey,y=r.pagePathname,S.next=3,C.V.syncGet("similarList");case 3:return T=S.sent,S.abrupt("return",new Promise(function(H){return(0,E.mG)(g,void 0,void 0,B().mark(function V(){var z,ee,W,J,X,te,ae;return B().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(!T||!T[o]){ue.next=20;break}if(z=T[o].blockedByDomain,ee=T[o].showMinimizedTill,W=T[o].blockedByTime&&T[o].blockedByTime>Date.now(),J=T[o].apiBlockTimeExpire&&Date.now()-T[o].apiBlockTime<T[o].apiBlockTimeExpire,!(z||W||J)){ue.next=7;break}return ue.abrupt("return",H({status:!1,fetch:!1,showMinimizedTill:ee}));case 7:if(!T[o][p]){ue.next=19;break}return X=T[o][p],ue.next=11,this.configService.getParameter(D.E.UPDATE_INTERVAL_INFO_SIMILAR);case 11:if(te=ue.sent,!(Date.now()-X.lastTimeUpdated>te)){ue.next=15;break}return ue.abrupt("return",H({status:!1,fetch:!0,showMinimizedTill:ee}));case 15:return ue.next=17,this.renderChecker({offer:X,cache:!0,pagePathname:y,showMinimizedTill:ee});case 17:return ae=ue.sent,ue.abrupt("return",H({status:ae,fetch:!1}));case 19:return ue.abrupt("return",H({status:!1,fetch:!0,showMinimizedTill:ee}));case 20:return ue.abrupt("return",H({status:!1,fetch:!0,showMinimizedTill:0}));case 21:case"end":return ue.stop()}},V,this)}))}));case 5:case"end":return S.stop()}},s)}))}},{key:"renderChecker",value:function(r){var s=this,g=r.offer,o=r.cache,p=r.pagePathname,y=r.showMinimizedTill,T=g&&g.offers&&g.offers.length,U=g&&g.params&&g.params.isPreview,S=!y||Date.now()>y;return new Promise(function(H){return(0,E.mG)(s,void 0,void 0,B().mark(function V(){var z;return B().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(!T||p!==window.location.pathname){W.next=5;break}return W.next=3,this.getOffersFromBackground(g.offers,null===(z=g.params)||void 0===z?void 0:z.isUsedImageSearch);case 3:return g.offers=W.sent,W.abrupt("return",H(Object.assign(Object.assign({},g),{cache:o,isPreview:S||U})));case 5:return W.abrupt("return",H(!1));case 6:case"end":return W.stop()}},V,this)}))})}},{key:"fetchOffers",value:function(r){return(0,E.mG)(this,void 0,void 0,B().mark(function s(){var g,o,p,y,T,U,S,H,V,z;return B().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return g=this,o=r.user,p=r.domainKey,y=r.similarKey,W.next=4,b.Z.getAdditionalParams();case 4:return T=W.sent,W.t0=T.title,W.t1=window.location.href,W.t2=T.currencyCode,W.t3=T.brand,W.t4=T.scoreSummary,W.t5=T.itemName,W.t6=T.articleId,W.t7=T.h1,W.t8=T.img,W.next=16,g.getBase64FromBg({url:T.img});case 16:return W.t9=W.sent,W.t10=T.price,U={title:W.t0,url:W.t1,currency:W.t2,brand:W.t3,scoreSummary:W.t4,itemName:W.t5,articleId:W.t6,h1:W.t7,imgUrl:W.t8,imgBody:W.t9,price:W.t10},W.next=21,C.V.syncGet("locale");case 21:return S=W.sent,H=null!=S?S:S.split("_")[1].toUpperCase(),V=o&&o.balanceInfo&&o.balanceInfo.currency||null,z=o&&o.country||H||null,W.abrupt("return",this.eventService.fireEvent(F.P.NOTIFICATION_GET_SIMILAR_LIST,{tabId:null,data:{similarRequestParams:{page:U,country:z,currency:V},storageData:{domainKey:p,similarKey:y}}}).then(function(J){return J}));case 26:case"end":return W.stop()}},s,this)}))}},{key:"getOffersFromBackground",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p,y;return B().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return o=s?"similar_is":"similar",U.next=3,this.eventService.fireEvent(F.P.GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK,{tabId:null,data:{offers:r}});case 3:return p=U.sent,y={apply_autopromo:"0",ext_feature:"similar",hide_timer:"true",utm_source:"extension",utm_medium:"similar",utm_campaign:o,utm_content:A.cQ.getDomain(window.location.href),utm_term:framework.browser.name.toLowerCase()},U.abrupt("return",p&&p.map(function(S){var H=Object.assign({},y);return S.autopromo&&(H.utm_campaign="".concat(o,"_autopromo"),H.apply_autopromo="0",S.autopromo.autoPromotion.endAt||(H.apply_autopromo="".concat(S.autopromo.autoPromotion.id))),S.link+="&".concat(A.cQ.urlFromObject(H)),S}));case 6:case"end":return U.stop()}},g,this)}))}},{key:"disableSimilarTool",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p;return B().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.prev=0,T.next=3,C.V.syncGet("similarList");case 3:return(o=T.sent)||(o={}),o[s]||(o[s]={}),"day"===r&&((p=new Date).setHours(23,59,59,999),o[s].blockedByTime=p.getTime()),"domain"===r&&(o[s].blockedByDomain=!0),"hour"===r&&(o[s].showMinimizedTill=Date.now()+m.g.SIMILAR_MINIMIZED_TYPE_VIEW_PERIOD),C.V.set("similarList",o),T.abrupt("return",!0);case 13:return T.prev=13,T.t0=T.catch(0),T.abrupt("return",!1);case 16:case"end":return T.stop()}},g,null,[[0,13]])}))}},{key:"getSimpleSimilarDomainData",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p,y,T,U,S,H,V,z,ee,W,J,X;return B().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!(p=s.domainsList.filter(function(ae){return ae.domain.replace("www.","").includes(r)}))||!p.length){k.next=34;break}if((y=window.location.pathname)&&"/"!==y){k.next=7;break}o=p.find(function(ae){return ae.domain===r}),k.next=34;break;case 7:T="__",U=(r+y).split("/").filter(function(ae){return ae.length}),S=U.join(T),(H=p.map(function(ae){var he=ae.domain.split("/").filter(function(ue){return ue.length});return{splitValue:he.length<=U.length&&he,domain:ae.domain}})).sort(function(ae,he){return ae.splitValue.length-he.splitValue.length}),z=(0,q.Z)(H),k.prev=13,z.s();case 15:if((ee=z.n()).done){k.next=25;break}if(W=ee.value,!(J=W.splitValue&&W.splitValue.join(T))){k.next=23;break}if(S!==J){k.next=22;break}return V=W.domain,k.abrupt("break",25);case 22:S.includes(J)&&(V=W.domain);case 23:k.next=15;break;case 25:k.next=30;break;case 27:k.prev=27,k.t0=k.catch(13),z.e(k.t0);case 30:return k.prev=30,z.f(),k.finish(30);case 33:o=p.find(function(ae){return ae.domain===V});case 34:return X=s.settings.offers_show_count?s.settings.offers_show_count:3,k.next=37,this.getAutopromoOffersForDomain(o,X);case 37:return k.abrupt("return",k.sent);case 38:case"end":return k.stop()}},g,this,[[13,27,30,33]])}))}},{key:"getAutopromoOffersForDomain",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o;return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!r){y.next=12;break}return y.prev=1,y.next=4,this.getSimpleSimilarOffersByCategory(r.kind_id,r.kind_type);case 4:return o=y.sent,_.isEmpty(o)||(o.forEach(function(T,U){var S={};try{S={utmSource:"extension",utmMedium:"simplesimilar",utmCampaign:"SSautopromo",utmContent:A.cQ.getDomain(window.location.href)}}catch(H){throw new Error(H)}T.link=T.link?T.link:r.link,!_.isEmpty(T.autoPromotion)&&T.autoPromotion.placements.includes("simple_similar")&&(T.link="".concat(d.S._root,"/view/").concat(T.id),T.autoPromotion.endAt||(S.applyAutopromo="".concat(T.autoPromotion.id))),T.utm=A.cQ.urlFromObject(A.cQ.objectKeysTransform(S,"snakecase"))}),r.offers=o.slice(0,s)),y.abrupt("return",r);case 9:throw y.prev=9,y.t0=y.catch(1),new Error(y.t0);case 12:return y.abrupt("return",r);case 13:case"end":return y.stop()}},g,this,[[1,9]])}))}},{key:"getSimpleSimilarOffersByCategory",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p;return B().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return o=this,T.next=3,C.V.syncGet("simpleSimilarOffers");case 3:return p=T.sent,T.abrupt("return",o.filterOffers(p,r,s));case 5:case"end":return T.stop()}},g,this)}))}},{key:"filterOffers",value:function(r,s,g){return 0==+s&&"shops"===g?this.sortOffersForAllCategory(r,s,g):this.sortOffersByCategoryId(r,s)}},{key:"sortOffersByCategoryId",value:function(r,s){var g=this,o=[];return _.isEmpty(r)||Object.keys(r).forEach(function(p){if("lastUpdate"!==p){var y=r[p].filter(function(T){var U=T.categoryIds,S=T.autoPromotion,H=(U||[]).includes("".concat(s)),V=!_.isEmpty(S);return H&&V&&S.availableApplying>=g.minAvailableApplying&&(S.placements.includes("simple_similar")||_.isString(S.endAt))});y=g.sortOffers(y),o=[].concat((0,ie.Z)(o),(0,ie.Z)(y))}}),o}},{key:"sortOffersForAllCategory",value:function(r,s,g){var o=this,p=[];return _.isEmpty(r)||Object.keys(r).forEach(function(y){if("lastUpdate"!==y){var T=r[y].filter(function(U){var S=U.autoPromotion,H=0==+s&&"shops"===g,V=!_.isEmpty(S);return H&&V&&S.availableApplying>=o.minAvailableApplying&&(S.placements.includes("simple_similar")||_.isString(S.endAt))});T=o.sortOffers(T),p=[].concat((0,ie.Z)(p),(0,ie.Z)(T))}}),p}},{key:"sortOffers",value:function(r){var s=this,g=r.slice();return _.isEmpty(r)||g.sort(function(o,p){var y=s.sortRule(o.autoPromotion.weight,p.autoPromotion.weight,!0);return 0===y?s.sortRule(o.cashbackRate.calculatedValue,p.cashbackRate.calculatedValue):y}),g}},{key:"sortRule",value:function(r,s){var g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r>s?g?1:-1:r<s?g?-1:1:0}},{key:"incrementSimpleSimilarView",value:function(r,s,g){var o=r.domain,p=A.cQ.getDomain(window.location.href),y=Object.assign({},s);y.domainsList.forEach(function(T){(T.domain===o||T.domain.includes(p)&&0===T.domain.lastIndexOf(p))&&Object.keys(g).forEach(function(U){T[U]=g[U]})}),C.V.set("simpleSimilar",y)}},{key:"disableSimpleSimilarTool",value:function(r,s){return(0,E.mG)(this,void 0,void 0,B().mark(function g(){var o,p,y,T;return B().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,C.V.syncGet("simpleSimilar");case 3:return o=S.sent,p=!1,y=function(){if("day"===r){var V=new Date;return V.setHours(23,59,59,999),V.getTime()}return"domain"!==r&&("hour"===r?Date.now()+m.g.PERIOD_DISABLED_FOR_HOUR:void 0)},o||(o={domainsList:[],settings:m.g.SIMPLE_SIMILAR_VIEWS_SETTINGS}),o.domainsList.forEach(function(H){(H.domain===s||H.domain.includes(s)&&0===H.domain.lastIndexOf(s))&&(p=!0,H.status=y())}),p||(T=y(),o.domainsList.push({domain:s,status:T})),C.V.set("simpleSimilar",o),S.abrupt("return",!0);case 13:return S.prev=13,S.t0=S.catch(0),S.abrupt("return",!1);case 16:case"end":return S.stop()}},g,null,[[0,13]])}))}}]),l}();u.SIMILAR="SIMILAR",u.SIMPLE_SIMILAR="SIMPLE_SIMILAR",u.\u0275fac=function(f){return new(f||u)(R.LFG(G.eN),R.LFG(D.E),R.LFG(F.P),R.LFG(K.U))},u.\u0275prov=R.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})},7301:function(ge,le,O){O.d(le,{V:function(){return Y}});var ie=O(3512),q=O(5134),I=O(7289),x=O(138),Y=function(){function B(){(0,q.Z)(this,B)}return(0,I.Z)(B,null,[{key:"get",value:function(d,m){chrome.storage.local.get(d,function(b){m&&m(b[d])})}},{key:"syncGet",value:function(d){return new Promise(function(m){chrome.storage.local.get(d,function(b){return m(b[d])})})}},{key:"set",value:function(d,m){chrome.storage.local.set((0,ie.Z)({},d,m))}},{key:"remove",value:function(d){chrome.storage.local.remove(d)}}]),B}();Y.\u0275fac=function(E){return new(E||Y)},Y.\u0275prov=x.Yz7({token:Y,factory:Y.\u0275fac,providedIn:"root"})},6770:function(ge,le,O){var N,n,t,e,ie=O(4800),q=O(138),I=O(344),x=O(5134),Y=O(7289),B=O(9725),E=O(2967),d=O(617),m=O(7256),b=O(2233),A=O(2522),D=O(9244),F=O(5446),C=O(2990),R=O(6860),G=O(3512),K=O(8774),u=O.n(K),l=O(4762),f=O(8372),r=O(9433),s=O(5848),g=O(5750),o=O(7301),p=g.Model.extend({defaults:{id:"",title:"",aliases:[],domain:"",pattern:"",domains_enabled:"",domains_disabled:"",logo:"",shortDesc:"",longDesc:"",url:"",activateUrl:"",promo:[],settings:{globalDisabled:!1,partnerList:!1,partnerListNoActive:!1,browserAction:!1,injectNotification:!1,injectNotificationWithoutActivate:!1,injectSuccessNotification:!1,injectRewriteNotification:!1,injectRewriteNotificationWithoutActivate:!1,showInSearchEngine:!1,iconClickPage:!1,showInSimilar:!1,injectLetyBar:!1,injectionTracking:!1},checkUrlParams:null,checkCookieParams:null,isFavorite:!1,isRecommended:!1,isViewed:!1,isActivated:!1,isSuppressed:!1,hasPromoActivated:"",rewrite:!1,savedParams:[],animated:"",delayActivate:null,thankYouPage:[],cashbackRate:{rate:null,rateFormated:null,isFloating:null,suffixFormated:null,type:null,conditionsFormated:[]},rate:null,rate_formated:null,is_floating:null,suffix:null,type:null,conditionsFormated:null,cashback:null,userCashback:null,cashbackFloated:null,clickPageUrl:"",trackOrderParams:null,transitionId:null,parsePromoCodeParameters:null,parseSentTrackingParameters:null,isSuppressedTime:null,categoriesIds:null},initialize:function(){this.on(r.g.CASHBACK_ACTIVATE,this.activate),this.on(r.g.PROMO_ACTIVATE,this.activatePromo),this.on(r.g.MERCHANT_SUPPRESSED,this.suppressed)},suppressed:function(){this.set("isSuppressed",!0)},delayActivateStatus:function(){this.unset("delayActivate"),this.set("delayActivate",(new Date).getTime()+r.g.UPDATE_INTERVAL_ACTIVATE),this.unset("isSuppressed")},activate:function(){this.set("isActivated",!0),this.delayActivateStatus()},activatePromo:function(n){this.set("hasPromoActivated","".concat(n)),this.delayActivateStatus()},reset:function(){this.unset("hot"),this.unset("hotProducts"),this.resetOnRewrite()},resetOnRewrite:function(){this.unset("delayActivate"),this.unset("isActivated"),this.unset("isSuppressed"),this.unset("savedParams"),this.unset("savedCookie"),this.unset("transitionId"),framework.extension.fireEvent(r.g.BUTTON_UPDATE,{tabId:null})},clearSuppressed:function(){this.unset("isSuppressed"),this.unset("isSuppressedTime")},setSuppressedTime:function(){this.set("isSuppressedTime",(new Date).getTime()+r.g.HIDE_NOTIFICATION_TIME)}}),y=g.Collection.extend({model:p,flag:"merchants",flagRates:"merchantsRates",updateFlag:"merchantsLastUpdated",updateFlagRates:"merchantsLastUpdated",url:f.S.merchants(),initialize:function(){var n=this;n.configService=window.configService,n.categoriesService=window.categoriesService,n.on("reset",function(){n.save()}),n.fetch()},resetAll:function(){_.each(this.models,function(t){t.unset("bonus"),t.unset("bonusCoefficient"),t.unset("userCashback"),t.unset("userCashbackValue"),_.each(t.get("conditionsFormated"),function(e){e.currentRateFormated=e.rateFormated,e.currentRate=e.rate}),t.reset()})},toJSON:function(n){return n&&n.length>0?_.map(n,function(t){return t&&t.toJSON()}):this.models&&this.models.length>0?_.map(this.models,function(t){return t&&t.toJSON()}):null},setPersonalCashback:function(n){var t=this;if(n&&n[0]&&_.isArray(n[0])&&(n=n[0]),0!==t.models.length){var e=!0;if(_.each(t.models,function(i){!i.get("rate")&&0!==i.get("rate")&&(e=!1)}),e){if(n&&n.length){n.sort(function(i,c){return c.bonus-i.bonus});var a=[];_.each(n,function(i){if(void 0===i.exclude_shop_ids)return!0;i.exclude_shop_ids||a.push(i)}),n=n.filter(function(i){return a.indexOf(i)<0}),_.each(t.models,function(i){n&&n.length>0?_.each(n,function(c){void 0===c.exclude_shop_ids?i&&(!i.get("bonus")||c.bonus>i.get("bonus"))&&t.countPersonalCashback(i,c):c.exclude_shop_ids&&i&&i.id&&!c.shop_ids.includes(i.id.toString())&&(!i.get("bonus")||c.bonus>i.get("bonus"))&&t.countPersonalCashback(i,c)}):(i.unset("bonus"),i.unset("bonusCoefficient"),i.set({userCashback:i.get("cashback"),userCashbackValue:+i.get("rate")}),_.each(i.get("conditionsFormated"),function(c){c.currentRateFormated=c.rateFormated,c.currentRate=c.rate}))}),_.each(a,function(i){_.each(i.shop_ids,function(c){var h=t.selectById(c);h&&(!h.get("bonus")||i.bonus>h.get("bonus"))&&t.countPersonalCashback(h,i)})})}}else t.fetchRates(),setTimeout(_.bind(function(){t.setPersonalCashback(n)},t),100)}},countPersonalCashback:function(n,t){n.get("conditionsFormated")&&n.get("conditionsFormated").length>0&&_.each(n.get("conditionsFormated"),function(i){i.currentRate=(+i.rate*((+t.bonus+100)/100)).toFixed(2),i.currentRateFormated="".concat(100*+i.currentRate/100).concat(i.suffix)});var e=(+n.get("rate")*((+t.bonus+100)/100)).toFixed(2),a="".concat(100*+e/100).concat(n.get("suffix"));n.set({userCashback:a,userCashbackValue:+e,bonus:t.bonus,bonusCoefficient:s.cQ.calculateRateCoefficient(t.bonus),lastTimeCountPersonalCashback:_.now()})},setFavorites:function(n){var t=this;if(0!==t.models.length){_.each(t.models,function(e){return e.set("isFavorite",n&&n.includes(+e.get("id")))});try{t.trigger(r.g.POPUP_MERCHANTS_UPDATE)}catch(e){}}},setRecommended:function(n){var t=this;if(0!==t.models.length){_.each(t.models,function(e){return e.set("isRecommended",n&&n.includes(+e.get("id")))});try{t.trigger(r.g.POPUP_MERCHANTS_UPDATE)}catch(e){}}},setViewed:function(n){var t=this;if(0!==t.models.length){_.each(t.models,function(e){return e.set("isViewed",n&&n.includes(+e.get("id")))});try{t.trigger(r.g.POPUP_MERCHANTS_UPDATE)}catch(e){}}},save:function(){o.V.set(this.flag,this.toJSON())},getMerchantsFromStorage:function(n,t,e){o.V.get(n.flag,function(a){_.isNull(a)||_.isUndefined(a)?n.reset([]):(a&&_.isString(a)&&(a=JSON.parse(a)),_.isObject(a)?n.reset(a):a||(o.V.set(n.updateFlag,0),t.apply(n,e)))})},setFetchSuccessMerchantObject:function(n,t,e,a,i){return(0,l.mG)(this,void 0,void 0,u().mark(function c(){return u().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:o.V.set(n.updateFlag,_.now()),_.isArray(i[1])&&_.has(i[1][0],"id")?t&&t.apply(n,i):n.getMerchantsFromStorage(n,e,a);case 2:case"end":return P.stop()}},c)}))},getShoppingTripMerchants:function(){var t=[];o.V.remove("shoppingTripMerchants"),this.forEach(function(e){if(e.get("shoppingTrip")){var a=e.get("shoppingTrip");t.push({id:e.get("id"),shoppingTrip:a})}}),t&&t.length>0&&o.V.set("shoppingTripMerchants",t)},restoreShoppingTripMerchants:function(){var n=this;o.V.get("shoppingTripMerchants",function(t){t&&t.length>0&&t.forEach(function(e){var a=n.getMerchantById(e.id);a&&a.set("shoppingTrip",e.shoppingTrip)})})},getStatusActivateMerchant:function(){var e=framework.extension.getBackgroundPage().application.get("user");if(o.V.remove("statusActivateMerchants"),e.isLogin()){var a=[];this.forEach(function(i){i.get("isActivated")&&a.push({id:i.get("id"),isActivated:i.get("isActivated"),delayActivate:i.get("delayActivate"),isSuppressed:i.get("isSuppressed"),savedParams:i.get("savedParams"),savedCookie:i.get("savedCookie"),transitionId:i.get("transitionId")})}),a&&a.length>0&&o.V.set("statusActivateMerchants",a)}},restoreStatusActivateMerchant:function(){var n=this;framework.extension.getBackgroundPage().application.get("user").isLogin()&&o.V.get("statusActivateMerchants",function(a){a&&a.length>0&&a.forEach(function(i){var c=n.getMerchantById(i.id);c&&(c.set("isActivated",i.isActivated),c.set("delayActivate",i.delayActivate),c.set("isSuppressed",i.isSuppressed),c.set("savedParams",i.savedParams),c.set("savedCookie",i.savedCookie),c.set("transitionId",i.transitionId))})})},fetch:function(){return(0,l.mG)(this,arguments,void 0,u().mark(function n(){var e,a,i,c,h,P,v,M,w,L,Z,t=arguments,j=arguments;return u().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return j[0]||(j[0]={},j.length=1),e=this,a=j,i=j[0],c=j.callee,Q.next=7,e.configService.getParameter(m.E.UPDATE_INTERVAL_MERCHANT);case 7:return h=Q.sent,Q.next=10,o.V.syncGet("locale");case 10:return P=Q.sent,Q.next=13,o.V.syncGet("deliveryCountry");case 13:return v=Q.sent,M=v?"&delivery_country=".concat(v):"",e.url="".concat(f.S.merchants(),"?locale=").concat(P||"".concat(r.g.DEFAULT_LANGUAGE,"_").concat(r.g.DEFAULT_COUNTRY),"&version-ext=").concat(framework.extension.version).concat(M),Q.next=18,o.V.syncGet(e.updateFlag);case 18:w=Q.sent,e.getStatusActivateMerchant(),e.getShoppingTripMerchants(),!w||_.now()-w>h?(L=i.success,Z=i.error,i.success=function(){e.setFetchSuccessMerchantObject(e,L,c,a,t),e.restoreStatusActivateMerchant(),e.restoreShoppingTripMerchants(),e.categoriesService.fetch()},i.error=function(){e.getMerchantsFromStorage(e,c,a)},i.reset=!0,g.Collection.prototype.fetch.apply(e,a).always(function(){i.success=L,i.error=Z})):e.getMerchantsFromStorage(e,c,a),e.restoreStatusActivateMerchant(),e.restoreShoppingTripMerchants(),clearTimeout(e.fetchTimeout),e.fetchTimeout=setTimeout(function(){e.fetch()},h);case 26:case"end":return Q.stop()}},n,this)}))},fetchForce:function(){return(0,l.mG)(this,arguments,void 0,u().mark(function n(){var e,a,i,c,h,P,v,M,w,t=this,L=arguments;return u().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return L[0]||(L[0]={},L.length=1),e=this,a=L,i=L[0],c=L.callee,h=i.success,P=i.error,j.next=9,o.V.syncGet("locale");case 9:return v=j.sent,j.next=12,o.V.syncGet("deliveryCountry");case 12:return M=j.sent,w=M?"&delivery_country=".concat(M):"",e.url="".concat(f.S.merchants(),"?locale=").concat(v||"".concat(r.g.DEFAULT_LANGUAGE,"_").concat(r.g.DEFAULT_COUNTRY),"\n\t\t&version-ext=").concat(framework.extension.version).concat(w),i.success=function(){e.setFetchSuccessMerchantObject(e,h,c,a,arguments),e.categoriesService.fetch()},i.error=function(){e.getMerchantsFromStorage(e,c,a)},i.reset=!0,j.next=20,g.Collection.prototype.fetch.apply(e,a).always(function(){return(0,l.mG)(t,void 0,void 0,u().mark(function oe(){return u().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,h;case 2:return i.success=re.sent,re.next=5,P;case 5:i.error=re.sent;case 6:case"end":return re.stop()}},oe)}))});case 20:case"end":return j.stop()}},n,this)}))},fetchRates:function(n){var t=this,e=this;o.V.get(e.updateFlagRates,function(a){return(0,l.mG)(t,void 0,void 0,u().mark(function i(){var c;return u().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,e.configService.getParameter(m.E.UPDATE_INTERVAL_MERCHANT);case 2:c=P.sent,!a||_.now()-a>c||n?$.ajax({url:f.S.cashRates(),type:"get",success:function(M){e.addRates(M)},error:function(M,w,L){console.error(M,w,L),e.addRates(e.models)}}):o.V.get(e.flagRates,function(v){e.addRates(v)});case 4:case"end":return P.stop()}},i)}))})},fetchUserCashbackRates:function(n){return(0,l.mG)(this,void 0,void 0,u().mark(function t(){var e,a,i,c;return u().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,o.V.syncGet("locale");case 2:e=P.sent,a="".concat(f.S.userCashbackRates(n.id),"?locale=").concat(e||"".concat(r.g.DEFAULT_LANGUAGE,"_").concat(r.g.DEFAULT_COUNTRY)),i=this,n.set({lastTimeCountPersonalCashback:_.now()}),c={async:!1,crossDomain:!0,url:a,method:"GET"},$.ajax(c).done(function(v){var M=[];M.push(v),i.addRates(M)});case 8:case"end":return P.stop()}},t,this)}))},addRates:function(n){var t=this;_.each(n,function(e){var a=t.findWhere({id:e.id});a&&(a.set({rate:e.a,rate_formated:e.b,is_floating:e.c,suffix:e.d,type:e.e,conditionsFormated:e.f,cashback:e.b,rateUserCashback:e.ac?e.ac:e.a,userCashback:e.bc?e.bc:e.b,userCashbackValue:e.ac?e.ac:e.a,lastTimeCountPersonalCashback:_.now()}),e.c&&e.c>0&&a.set({cashbackFloated:!0}))}),n&&(o.V.set(t.updateFlagRates,_.now()),o.V.set(t.flagRates,n)),t.ratesAdded=!0,t.save()},parse:function(n){return n=_.filter(n,function(t){return!!t.id&&!!t.c}),_.map(n,function(t){return _.object(["id","title","aliases","thankYouPage","domain","pattern","domains_enabled","domains_disabled","logo","shortDesc","longDesc","url","activateUrl","promo","checkUrlParams","checkCookieParams","countDomainLevel","settings","cashbackRate","rate","rate_formated","is_floating","suffix","type","conditionsFormated","cashback","userCashback","cashbackFloated","clickPageUrl","cartPage","disabledRedirect","trackOrderParams","parsePromoCodeParameters","parseSentTrackingParameters","userCashbackValue","categoriesIds"],[t.id,t.a,t.h,t.o,t.c,t.c,t.de,t.dd,t.d,t.e,t.f,t.b,t.m,t.k,t.l,t.n,null!=t.c.match(/\./gi)?t.c.match(/\./gi).length:0,_.isArray(t.g)?_.object(["globalDisabled","partnerList","partnerListNoActive","browserAction","injectNotification","injectNotificationWithoutActivate","injectSuccessNotification","injectRewriteNotification","injectRewriteNotificationWithoutActivate","showInSearchEngine","dontShowInformer","iconClickPage","showInSimilar","injectNotificationCart","injectLetyBar","injectionTracking"],[t.g.includes("global_disabled"),t.g.includes("partner_list"),t.g.includes("partner_list_noactive"),t.g.includes("browser_action"),t.g.includes("inject_notification"),t.g.includes("inject_notification_without_activate"),t.g.includes("inject_success_notification"),t.g.includes("inject_rewrite_notification"),t.g.includes("inject_rewrite_notification_without_activate"),t.g.includes("show_in_search_engine"),t.g.includes("dont_show_informer"),t.g.includes("icon_click_page"),t.g.includes("show_in_similar"),t.g.includes("inject_notification_cart"),t.g.includes("inject_letybar"),t.g.includes("injection_tracking")]):{},Object.keys(t.p).length>0?_.object(["rate","rateFormated","isFloating","suffixFormated","type","conditionsFormated"],[t.p.a,t.p.b,t.p.c,t.p.d,t.p.e,t.p.f]):{},t.p.a,t.p.b,t.p.c,t.p.d,t.p.e,t.p.f,t.p.b,t.p.b,t.p.c&&t.p.c>0,t.q,t.r,t.v,t.u,t.s,t.t,t.p.a,t.i])})},selectByDomain:function(n){return this.find(function(e){return s.cQ.checkEnableDisableDomain(e,n)})},selectById:function(n){var e=this.findWhere({id:+n});return e&&(e.get("settings").partnerList||e.get("settings").partnerListNoActive||e.get("settings").browserAction||e.get("settings").injectNotification||e.get("settings").injectSuccessNotification||e.get("settings").injectRewriteNotification||e.get("settings").injectRewriteNotificationWithoutActivate||e.get("settings").iconClickPage)?e:null},getInfoForOffer:function(n){var e=this.findWhere({id:+n});return e&&!e.get("settings").partnerList?{mId:e.get("id"),logo:e.get("logo"),cashback:e.get("userCashback")?e.get("userCashback"):e.get("cashback"),cashbackFloated:e.get("cashbackFloated"),isFavorite:e.get("isFavorite"),url:e.get("url"),activateUrl:e.get("activateUrl")}:null},selectFavorites:function(){var t=[];return this.where({isFavorite:!0}).forEach(function(e){(e.get("settings").partnerList||e.get("settings").partnerListNoActive)&&t.push(e)}),t.length>0?this.toJSON(t):[]},selectRecommended:function(n){var e,a=[],i=[],c=n&&n.attributes.recommended;return this.models.forEach(function(h){h&&(h.get("settings").partnerList||h.get("settings").partnerListNoActive)&&(c&&c.includes(h.get("id"))?i[c.indexOf(h.get("id"))]=h:h.get("isRecommended")&&a.push(h))}),(e=[].concat(i,a).filter(function(h){return!(!h||!h.get("id"))})).length>0?this.toJSON(e):[]},selectViewed:function(n){var e,a=[],i=[],c=n&&n.attributes.viewed;return this.models.forEach(function(h){(h.get("settings").partnerList||h.get("settings").partnerListNoActive)&&(c&&c.includes(h.get("id"))?i[c.indexOf(h.get("id"))]=h:h.get("isViewed")&&a.push(h))}),(e=[].concat(i,a).filter(function(h){return!!h.get("id")})).length>0?this.toJSON(e):[]},select50First:function(n){var t=_.filter(this.models,function(e){return e.get("settings").partnerList&&!_.contains(n,e.id)});return t&&t.length?(t.length>50&&(t.length=50),this.toJSON(t)):null},selectByAlias:function(n){if(_.isString(n)){var e=this.filter(function(a){return a.get("aliases")&&a.get("aliases").find(function(i){return i.toLowerCase().includes(n.toLowerCase())})})||[];return e.length&&(e=this.toJSON(e),(e=_.sortBy(e,function(a){var i=100;return _.each(a.aliases,function(c){var h=c.toLowerCase().indexOf(n.toLowerCase());i>h&&-1!==h&&(i=h)}),i})).splice(50)),null!=e?e:[]}},getMerchantById:function(n){return this.findWhere({id:+n})||null}}),T=g.Model.extend({defaults:{id:"",domain:"",url:"",history:[],interstitialPageId:"",animation:!1},initialize:function(){this.reset=_.debounce(this.immediateReset,2e4)},immediateReset:function(){var n=this;_.delay(function(){(0,s.cM)("TABS.JS: immediateReset",n),n.unset("state"),n.unset("interstitialPageId"),n.unset("activatingMerchantId")},2e3)}}),U=g.Collection.extend({model:T,initialize:function(){var n=this;n.eventService=window.eventService,_.each({browser:_.object([framework.browser.TABCLOSED,framework.browser.BEFORENAVIGATE,framework.browser.DOCUMENTCOMPLETE,framework.browser.TABCHANGED],[_.bind(n.tabWasClosed,n),_.bind(n.tabWasWalkingAlongChain,n),_.bind(n.tabWasChanged,n),_.bind(n.tabWasSwitched,n)]),extension:_.object([r.g.TAB_CHANGED],[n.tabWasChanged])},function(t,e){_.each(t,function(a,i){framework[e].attachEvent(i,a)})}),framework.browser.attachEvent(framework.browser.BEFORENAVIGATE,n.tabBeforeNavigate)},tabWasClosed:function(n){var t=this,e=t.findWhere&&t.findWhere({id:n.tabId});e&&t.remove&&t.remove(e)},tabWasWalkingAlongChain:function(n){(0,s.cM)("TABS.JS tabWasWalkingAlongChain",n);var a,i,c,h,e={};a=n.tabId,i=n.url,c=s.cQ.guid(),h=this,e[c]=window.setTimeout(function(){h.tabWasChanged({tabId:a,url:i})},r.g.BROWSER_NAME_FF===framework.browser.name?50:1)},tabWasChanged:function(n){var t=n.url;if(!_.isEmpty(t)){(0,s.cM)("TABS.JS tabWasChanged",n);var e=this,a=n.tabId,i=s.cQ.getDomain(n.url),c=e.findWhere&&e.findWhere({id:a});if(c){var h=s.cQ.getDomain(n.url);c.set({url:t,domain:h})}else c=new T,e.add&&e.add(c),c.set&&c.set({id:a,url:t,domain:i}),r.g.BROWSER_NAME_FF===framework.browser.name&&e.merchantToNavigateAfterLoginForNewelyCreatedTab&&(c.set("merchantToNavigateAfterLogin",e.merchantToNavigateAfterLoginForNewelyCreatedTab),e.merchantToNavigateAfterLoginForNewelyCreatedTab=null),1===e.length&&(e.currentTabId=a,e.trigger(r.g.TAB_CHANGED,c))}},tabWasSwitched:function(n){var t=this;(0,s.cM)("TABS.JS tabWasSwitched",n),framework.extension.fireEvent(r.g.TAB_WAS_CHANGED,{tabId:n.tabId}),t.tabWasChanged(n),t.currentTabId=n.tabId,t.trigger(r.g.TAB_CHANGED,t.selectById())},tabBeforeNavigate:function(n){setTimeout(function(){(0,s.cM)("TABS.JS tabBeforenavigate",n);var t=this,e=t.application.tabs.selectById(n.tabId),a=s.cQ.getDomain(n.url),i=a&&t.application.merchants.selectByDomain(a),c={},h={};if(i&&i.attributes){var P="";t.eventService.attachEvent(A.P.GET_PAGE_COOKIES,function(w){if(w&&w.data){P=w.data.pageCookies;var L=JSON.parse(JSON.stringify(e.get("history")));L[L.length-1].cookies.pageCookies=P,e.set("history",L)}}),c={checkCookieParams:i.attributes.checkCookieParams,savedCookie:i.attributes.savedCookie?i.attributes.savedCookie:"",pageCookies:P},h={checkUrlParams:i.attributes.checkUrlParams,savedParams:i.attributes.savedParams,checkedParams:s.cQ.getAllUrlParams(n.url)}}if(n&&e){var v=JSON.parse(JSON.stringify(e.get("history"))),M={date:new Date(new Date(new Date(new Date).toISOString()).getTime()-6e4*(new Date).getTimezoneOffset()).toISOString().slice(0,19)+((new Date).getTimezoneOffset()/60).pad(2),url:n.url,referer:"",cookies:c,params:h};v.length>=r.g.HISIORY_LENGTH&&v.shift(),v.length>0&&(M.referer=_.last(v).url),v.push(M),e.set("history",v),t.application.history.length>=r.g.GLOBAL_HISTORY_LENGTH&&t.application.history.shift(),t.application.history.push(M)}else n&&!e&&((e=new T).set({id:n.tabId,url:n.url,domain:s.cQ.getDomain(n.url),history:[{date:JSON.stringify(new Date),url:n.url,referrer:"",cookie:c,params:h}]}),t.application.tabs.add(e))},0)},selectById:function(n){var t=this;return n=n||t.currentTabId,t.findWhere&&t.findWhere({id:n})}}),S=(N={},n="",t="images/btn/",e={standard:"".concat(t,"logo18.png"),animated:"".concat(t,"logo19.svg"),rainbow:"".concat(t,"logo18rainbow.svg"),red:"".concat(t,"logo18red.png"),green:"".concat(t,"logo18green.png"),safari:"".concat(t,"logo18safari.png"),safari_act:"".concat(t,"logo18safari_activated.png"),safari_info:"".concat(t,"logo18safari_info.png")},N.attach=function(a){framework.ui.button.attachEvent(framework.ui.button.CLICK,a)},N.detach=function(a){framework.ui.button.detachEvent(framework.ui.button.CLICK,a)},N.green=function(){r.g.BROWSER_NAME_SAFARI===framework.browser.name?this.setIcon("safari_act"):this.setIcon("green")},N.red=function(){r.g.BROWSER_NAME_SAFARI===framework.browser.name?this.setIcon("safari_info"):this.setIcon("red")},N.standard=function(){r.g.BROWSER_NAME_SAFARI===framework.browser.name?this.setIcon("safari"):this.setIcon("standard")},N.setBadge=function(a){a&&("number"==typeof a||"!"===a)&&(n=a),null!=a?framework.ui.button.setBadgeText(a):framework.ui.button.setBadgeText(n)},N.clearCounter=function(){"!"!==n&&(n="",this.setBadge())},N.setTitle=function(a){framework.ui.button.setTitle(a||"\u041a\u044d\u0448\u0431\u044d\u043a-\u0441\u0435\u0440\u0432\u0438\u0441 LetyShops")},N.setIcon=function(a){framework.ui.button.setIcon(e[a])},N.pulseIcon=function(){var a=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;return new Promise(function(c,h){return(0,l.mG)(a,void 0,void 0,u().mark(function P(){var v;return u().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:v=0;case 1:if(!(v<=4)){w.next=13;break}if(N.animation){w.next=4;break}return w.abrupt("return",h());case 4:return w.next=6,s.cQ.sleep(i);case 6:return N.red(),w.next=9,s.cQ.sleep(i);case 9:N.standard();case 10:v++,w.next=1;break;case 13:return w.next=15,s.cQ.sleep(i);case 15:if(N.animation){w.next=17;break}return w.abrupt("return",h());case 17:return w.abrupt("return",c());case 18:case"end":return w.stop()}},P)}))})},N),H=g.Model.extend({defaults:{bonus:"",desc:""},initialize:function(){}}),V=g.Collection.extend({model:H,flag:"codes",updateFlag:"codesLastUpdated",url:f.S.userCodes(),initialize:function(){var n=this;n.configService=window.configService,n.on("reset",function(){n.save()}),n.fetch()},save:function(){o.V.set(this.flag,this.toJSON())},toJSON:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.models;return n.map&&n.map(function(t){return t.toJSON()})},fetch:function(n){return(0,l.mG)(this,arguments,void 0,u().mark(function t(){var a,i,c,h,P,e=arguments,v=arguments;return u().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return v[0]||(v[0]={},v.length=1),a=this,i=v.callee,w.next=5,o.V.syncGet("locale");case 5:return c=w.sent,w.next=8,a.configService.getParameter(m.E.UPDATE_INTERVAL_CODES);case 8:return h=w.sent,a.url="".concat(f.S.userCodes(),"?locale=").concat(c||"".concat(r.g.DEFAULT_LANGUAGE,"_").concat(r.g.DEFAULT_COUNTRY)),w.next=12,o.V.syncGet(this.updateFlag);case 12:!(P=w.sent)||_.now()-P>h||n?g.Collection.prototype.fetch.call(a,{reset:!0}).always(function(){o.V.set(a.updateFlag,_.now())}):o.V.syncGet(a.flag).then(function(L){_.isObject(L)?a.reset(L):L||(o.V.set(a.updateFlag,0),i.apply(a,e))}),clearTimeout(a.fetchTimeout),a.fetchTimeout=setTimeout(function(){a.fetch()},h);case 16:case"end":return w.stop()}},t,this)}))},parse:function(n){return null!=n?n:null}}),z=g.Model.extend({url:f.S.user(),updateFlag:"userLastAuthorization",timerForceUpdateKey:"timerForceUpdateKey",timerUpdate:null,timerForceUpdate:null,defaults:{token:null,name:"",balanceInfo:[],image:"https://image.letyshops.com/sites/default/files/pictures/ava-def.png",partnerUrl:"",partnerPercent:"",rates:{},notifications:[],favorites:[],recommended:[],viewed:[],language:"",country:"",deliveryCountry:"",segments:[],extensionsToDisable:[],experiments:[]},initialize:function(){var n=this,t=this;t.set("rates",new V),t.rates=t.get("rates"),t.configService=window.configService,t.eventService=window.eventService,t.eventService.attachEvent(A.P.ON_USER_LOGIN,function(e){return(0,l.mG)(n,void 0,void 0,u().mark(function a(){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.logIn(e.data.cookie,!0);case 2:case"end":return c.stop()}},a,this)}))}),t.eventService.attachEvent(A.P.ON_USER_LOGOUT,function(){n.logOut()}),this.fetchByStoredToken(!0),this.intervalForceUpdateExecution().then(),o.V.set(r.g.OFFLINE_LIKES,[])},fetchByStoredToken:function(){var n=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.V.syncGet(r.g.LOGIN_TOKEN).then(function(e){return(0,l.mG)(n,void 0,void 0,u().mark(function a(){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!e||!e.length||"string"!=typeof e){c.next=3;break}return c.next=3,this.logIn(e,t);case 3:case"end":return c.stop()}},a,this)}))})},intervalForceUpdateExecution:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var e,t=this;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.configService.getParameter(m.E.UPDATE_INTERVAL_USER_FORCE);case 2:e=i.sent,this.timerForceUpdate=setTimeout(function(){clearTimeout(t.timerForceUpdate),o.V.syncGet(t.timerForceUpdateKey).then(function(c){return(0,l.mG)(t,void 0,void 0,u().mark(function h(){return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(c&&!(_.now()-c>e)){v.next=4;break}this.fetchByStoredToken(!0),v.next=6;break;case 4:return v.next=6,this.intervalForceUpdateExecution();case 6:case"end":return v.stop()}},h,this)}))})},e);case 4:case"end":return i.stop()}},n,this)}))},setUpdated:function(n){n.notifUpdated=!1,n.userUpdated=!1,n.notifUpdated=!1,n.favUpdated=!1,n.recomUpdated=!1,n.viewUpdated=!1,n.rates.codesUpdated&&(n.rates.codesUpdated=!1)},logIn:function(n){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,l.mG)(this,void 0,void 0,u().mark(function e(){var i,a=this;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(i=this,!n||n===i.get("token")&&!t){h.next=10;break}return o.V.get(r.g.POPUP_FIRST_OPENING_TOKEN,function(P){P||S.setBadge("")}),i.setUpdated(i),h.next=6,i.fetch(t);case 6:i.set("token",n),o.V.set(r.g.LOGIN_TOKEN,n),clearInterval(i.mainInterval),i.mainInterval=setInterval(function(){return(0,l.mG)(a,void 0,void 0,u().mark(function P(){return u().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,i.fetchNotifyIntoLogin();case 2:case"end":return M.stop()}},P)}))},3e5);case 10:o.V.get(r.g.OFFLINE_LIKES,function(P){_.each(P,function(v){i.pushLiked(v)},i)});case 11:case"end":return h.stop()}},e,this)}))},fetchNotifyIntoLogin:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,l.mG)(this,void 0,void 0,u().mark(function t(){var e;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=this,i.next=3,e.fetchNotifications(n,function(c){e.set("notifications",c),_.findWhere(c,{status:"1"})?(S.setBadge(_.where(c,{status:"1"}).length),framework.extension.fireEvent(r.g.SET_NOTIFICATIONS_POPUP,{tabId:null}),o.V.set(r.g.POPUP_FIRST_OPENING_TOKEN,"Wow!"),e.eventService.fireEvent(A.P.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:_.where(c,{status:"1"}),notificationEvent:"fetchUserNotification"}})):S.clearCounter()});case 3:case"end":return i.stop()}},t,this)}))},logOut:function(){var n=this;null!==n.get("token")&&(n.setUpdated(n),clearInterval(n.mainInterval),clearInterval(n.timerForceUpdate),o.V.remove("deliveryCountry"),Object.keys(n.toJSON()).forEach(function(t){n.set(t,n.defaults[t])}),o.V.set(r.g.LOGIN_TOKEN,null),o.V.remove("similarList"),o.V.remove("viewedMerchants"),o.V.remove("userPartnerData"),S.clearCounter(),clearTimeout(n.timerUpdate))},isLogin:function(){return this.get("token")},fetch:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,l.mG)(this,arguments,void 0,u().mark(function t(){var a,i,e=this,c=arguments;return u().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return a=this,P.next=3,o.V.syncGet("locale");case 3:i=P.sent,a.url="".concat(f.S.user(),"?locale=").concat(i||"".concat(r.g.DEFAULT_LANGUAGE,"_").concat(r.g.DEFAULT_COUNTRY)),(n||!a.userUpdated||_.now()-a.userUpdated>r.g.UPDATE_INTERVAL_USER)&&(a.userUpdated=_.now(),g.Model.prototype.fetch.apply(a,c).always().then(function(v,M,w){return(0,l.mG)(e,void 0,void 0,u().mark(function L(){var Z,j,oe,Q,re;return u().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:if(!(null===(Z=null==w?void 0:w.responseJSON)||void 0===Z?void 0:Z.name)){fe.next=17;break}return a.response=w.responseJSON,j=a.get("language")?a.get("language"):"ru",oe=a.get("country")?a.get("country"):r.g.DEFAULT_COUNTRY,Q="".concat(j,"_").concat(oe),fe.next=7,o.V.syncGet("locale");case 7:return re=fe.sent,o.V.set("locale",Q),o.V.set("deliveryCountry",a.get("deliveryCountry")),(!re||re.split("_")[0]!==j||re.split("_")[1]!==oe)&&a.eventService.fireEvent(A.P.LOAD_USER_LANGUAGE,{tabId:null,data:{language:j}}),n&&framework.extension.fireEvent(r.g.REFRESH_ALL,{tabId:null}),o.V.set(this.timerForceUpdateKey,_.now()),fe.next=15,a.intervalForceUpdateExecution();case 15:fe.next=18;break;case 17:a.logOut();case 18:case"end":return fe.stop()}},L,this)}))}).catch(function(v,M){console.error(M)}));case 6:case"end":return P.stop()}},t,this)}))},fetchNotifications:function(n,t,e){return(0,l.mG)(this,void 0,void 0,u().mark(function a(){var i,c,h;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return i=this,v.next=3,o.V.syncGet("locale");case 3:return c=v.sent,v.next=6,"".concat(f.S.getUserNotifications(),"?locale=").concat(c);case 6:if(h=v.sent,!(!i.notifUpdated||_.now()-i.notifUpdated>r.g.UPDATE_INTERVAL_USER_NOTIFICATION||e)){v.next=11;break}return i.notifUpdated=_.now(),v.next=11,$.ajax({url:h,type:"GET",dataType:"json",success:function(w){if(i.notifUpdated=_.now(),w&&w.length>0){var L=_.map(w,function(Z){return{id:"".concat(Z.id),status:Z.status,markup:Z.markup,showed:2===parseInt(Z.status),date:Z.date,url:Z.url,type:Z.type}});t&&t(L)}else t&&t([])},error:function(w){("403"===w.status||"Forbidden"===w.statusText)&&framework.extension.log("fetchNotify - Forbidden")}});case 11:n&&_.delay(_.bind(i.fetchNotifications,i),r.g.UPDATE_INTERVAL_USER_NOTIFICATION,!0,t);case 12:case"end":return v.stop()}},a,this)}))},pushReviewedNotifications:function(n){var t=this,e=t.get("notifications");_.findWhere(e,{id:"".concat(n)})&&$.ajax({url:f.S.getUserNotifications(),type:"POST",data:{notification_ids:[n]},processData:!0,success:function(c){c&&t.fetchNotifications(!0,function(h){t.set("notifications",h),_.findWhere(h,{status:"1"})?S.setBadge(_.where(h,{status:"1"}).length):S.clearCounter()},!0)},error:function(c){("400"===c.status||"Bad Request"===c.statusText)&&framework.extension.log("pushNotify - Forbidden")}})},pushLiked:function(n){$.ajax({url:f.S.favoriteMerchants(),type:"POST",data:{shops_liked:[{shop_id:"".concat(n),date:this.currentDate()}]},processData:!0,success:function(a){a&&(a.numInserted>0||a.numUpdated>0)&&a.numInserted>0&&framework.extension.log("".concat(a,", ").concat(a.numInserted,", ").concat(a.numUpdated))},error:function(a){"400"===a.status||"Bad Request"===a.statusText?framework.extension.log("pushLiked - \u200bMissing parameters"):"403"===a.status&&(framework.extension.log("pushLiked -  \u200bAccess Denied"),o.V.get(r.g.OFFLINE_LIKES,function(i){i.push(n),o.V.set(r.g.OFFLINE_LIKES,i)}))}})},pushDisliked:function(n){$.ajax({url:f.S.deleteFavoriteMerchant(),type:"POST",data:{shops_disliked:["".concat(n)]},processData:!0,success:function(a){a&&a.numUpdated>0&&a.numDeleted>0&&framework.extension.log("".concat(a,", ").concat(a.numDeleted))},error:function(a){"400"===a.status||"Bad Request"===a.statusText?framework.extension.log("pushDisliked - \u200bMissing parameters"):"403"===a.status&&(framework.extension.log("pushDisliked -  \u200bAccess Denied"),o.V.get(r.g.OFFLINE_LIKES,function(i){var c=i.indexOf(n);c>-1&&(i.splice(c,1),o.V.set(r.g.OFFLINE_LIKES,i))}))}})},rewriteViewed:function(n){if(n){var e=[],a=this.get("viewed")||[];(e=(0,R.Z)(new Set([n].concat((0,R.Z)(a)))))&&e.length>20&&(e=e.slice(0,20)),this.set("viewed",e.map(function(i){return!!i&&i})),o.V.set("viewedMerchants",e.map(function(i){return!!i&&i}))}},parse:function(n){return _.object(["name","balanceInfo","image","partnerUrl","partnerPercent","viewed","favorites","recommended","language","country","deliveryCountry","segments","experiments"],[n.name,n&&n.balance_info&&Object.keys(n.balance_info).length>0?_.object(["balanceApproved","balancePending","currency","currencyFormatted"],[n.balance_info.balance_approved,n.balance_info.balance_pending,n.balance_info.currency,n.balance_info.currency_formatted]):[],n.image,n.partner_url,n.partner_percent,n.shops_viewed,n.shops_liked,n.shops_recomended,n.language,n.country,n.delivery_country,n.segments,n.experiments])},currentDate:function(){return(new Date).toISOString()}}),ee=O(6054),W=function(){function N(){if((0,x.Z)(this,N),N.instance)throw new Error("Instantiation failed: use LogShoppingTripModule.getInstance() instead of new.")}return(0,Y.Z)(N,[{key:"addListenerWebRequestBeforeRedirect",value:function(t){var e=this;chrome.webRequest.onBeforeRedirect.addListener(function(a){return(0,l.mG)(e,void 0,void 0,u().mark(function i(){var c,h,P,v,M,w,L;return u().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(h=t.get("user"),!(P=a.redirectUrl.match(new RegExp(":".concat(h.get("token"),":T([0-9]*)"))))||!a.url){j.next=17;break}if((M=(0,R.Z)(null!==(c=a.url.matchAll(r.g.CHECK_LETYSHOPS_VIEW_OR_GO))&&void 0!==c?c:[]))&&M.length&&(w=parseInt(M[0][1],10),v=t.get("merchants").getMerchantById(w)),!v){j.next=17;break}return j.next=8,this.isMerchantHasShoppingTripId(v,t);case 8:if(j.sent){j.next=11;break}return j.next=11,this.createShoppingTripId(a,v,t);case 11:(L=v.get("shoppingTrip")).transitionIdPrevious=0!==L.transitionId&&L.transitionId!==parseInt(P[1],10)?L.transitionId:L.transitionIdPrevious||0,L.transitionId=parseInt(P[1],10),1===L.activationState&&(L.activationState=2),this.setActivationStatusShoppingTrip(v,!0),this.sendLogEvent(t.eapiService,v,2);case 17:case"end":return j.stop()}},i,this)}))},{urls:["<all_urls>"],types:["main_frame"]})}},{key:"addListenerWebRequestCompleted",value:function(t){var e=this;chrome.webRequest.onCompleted.addListener(function(a){return(0,l.mG)(e,void 0,void 0,u().mark(function i(){var c,h,P,v,M,w;return u().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if((h=a.url.includes(f.S.domain)?new URL(a.url):null)&&h.origin.includes(f.S.domain)){P=null;try{P=parseInt((0,R.Z)(null!==(c=a.url.matchAll(r.g.CHECK_LETYSHOPS_VIEW))&&void 0!==c?c:[])[0][1],10)}catch(j){}P&&((v=t.get("merchants").getMerchantById(P))&&((M=v.get("shoppingTrip"))&&(a.url.includes("notification_re_activate_cashback")?(M.activationStatePrevious=M.activationState,M.activationState=3):(M.activationStatePrevious=M.activationState||1,M.activationState=2))))}if(!(w=t.get("merchants").selectByDomain(s.cQ.getDomain(a.url)))){Z.next=6;break}return Z.next=6,this.sendLogShoppingTrip(a,w,t);case 6:case"end":return Z.stop()}},i,this)}))},{urls:["<all_urls>"],types:["main_frame"]})}},{key:"addListenerWebRequestBeforeRequest",value:function(t){var e=this;chrome.webRequest.onBeforeRequest.addListener(function(a){return(0,l.mG)(e,void 0,void 0,u().mark(function i(){var c,h;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:c=null;try{c=s.cQ.getDomain(a.initiator)}catch(M){}if(!c){v.next=11;break}if(!(h=t.get("merchants").selectByDomain(c))){v.next=11;break}return v.next=7,this.getPromoCode(a,h,t);case 7:return v.next=9,this.checkSentTrackingMerchant(a,h,t);case 9:return v.next=11,this.getOrderIdByRequest(a,h,t);case 11:case"end":return v.stop()}},i,this)}))},{urls:["<all_urls>"]},["requestBody"])}},{key:"isMerchantHasShoppingTripId",value:function(t,e){return(0,l.mG)(this,void 0,void 0,u().mark(function a(){return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(c.t0=!!t.get("shoppingTrip")&&!!t.get("shoppingTrip").id,!c.t0){c.next=5;break}return c.next=4,this.isTimeExpiredShoppingTripId(t,e);case 4:c.t0=c.sent;case 5:return c.abrupt("return",c.t0);case 6:case"end":return c.stop()}},a,this)}))}},{key:"isTimeExpiredShoppingTripId",value:function(t,e){return(0,l.mG)(this,void 0,void 0,u().mark(function a(){var i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.configService.getParameter(m.E.INTERVAL_SHOPPING_TRIP_ID);case 2:return i=h.sent,h.abrupt("return",(new Date).getTime()-i<t.get("shoppingTrip").timeCreateShoppingTripId);case 4:case"end":return h.stop()}},a)}))}},{key:"sendLogShoppingTrip",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c;return u().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,this.isMerchantHasShoppingTripId(e,a);case 2:if(P.sent){P.next=7;break}return P.next=5,this.createShoppingTripId(t,e,a);case 5:P.next=8;break;case 7:e.get("shoppingTrip").timeCreateShoppingTripId=(new Date).getTime();case 8:if((c=e.get("cartPage"))&&t.url.includes(c)&&this.sendLogEvent(a.eapiService,e,4),!this.checkThanksPage(a,e,t.url)){P.next=14;break}return this.sendLogEvent(a.eapiService,e,5),P.next=14,this.getOrderId(t,e,a);case 14:case"end":return P.stop()}},i,this)}))}},{key:"checkThanksPage",value:function(t,e,a){var i=e.get("thankYouPage");return i&&i.length>0&&a.includes(i[0].url)&&this.checkParamsThanksPage(a,i)&&this.checkReloadThanksPage(t)}},{key:"checkParamsThanksPage",value:function(t,e){var a=!0,i=e[0].params;if(!(i instanceof Array))for(var c in a=!1,i){if(!new RegExp("".concat(i[c]),"i").test(new URL(t).searchParams.get(c))){a=!1;break}a=!0}return a&&!!i}},{key:"checkReloadThanksPage",value:function(t){var e=this.getHistoryTransitionsCurrentTab(t),a=e[e.length-1];return a.referer&&a.url!==a.referer}},{key:"createShoppingTripId",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c,P,M,w;return u().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return c=e.get("shoppingTrip"),Z.next=3,this.isMerchantHasShoppingTripId(e,a);case 3:if(Z.sent){Z.next=10;break}P=(c||{}).transitionId,M=(M=(c||{}).transitionIdPrevious)||P||0,e.set("shoppingTrip",{id:s.cQ.guid(),timeCreateShoppingTripId:(new Date).getTime(),activationState:1,activationStatePrevious:1,transitionIdPrevious:M}),Z.next=12;break;case 10:c.id=s.cQ.guid(),e.get("shoppingTrip").timeCreateShoppingTripId=(new Date).getTime();case 12:w=this.getHistoryTransitionsEvent(t),this.sendLogEvent(a.eapiService,e,1,{historyTransitions:w});case 14:case"end":return Z.stop()}},i,this)}))}},{key:"setActivationStatusShoppingTrip",value:function(t,e){t.get("shoppingTrip").activationStatus=e}},{key:"sendLogEvent",value:function(t,e,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.sendLogShoppingTripEvent(this.getPreparedData(e,a,i)).then()}},{key:"getPreparedData",value:function(t,e,a){var i=s.cQ.getFullInfo(),c=t.get("shoppingTrip");return{shopping_trip_id:c.id,transition_id:c.transitionId||0,shop_id:t.get("id"),event_type:e,extension_version:framework.extension.version,activation_status:!!c.activationStatus,activation_state:c.activationState||1,data:Object.assign(a,{activation_state_previous:c.activationStatePrevious||1,transition_id_previous:c.transitionIdPrevious||0,environment:{os:i.os,os_version:i.osversion,browser:i.browser,browser_version:i.version}})}}},{key:"getOrderId",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c,h,P,v,M,w;return u().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!((c=e.get("trackOrderParams"))&&c.length>0)){Z.next=16;break}h=c[0],P={type:h.type},v=h.parameters,M=null,Z.t0=h.type,Z.next="url"===Z.t0?9:"cookies"===Z.t0||"page"===Z.t0?13:15;break;case 9:return v&&"params"===v.type&&(w=v.param_name,M=new URL(t.url).searchParams.get(w)),v&&"url"===v.type&&(M=decodeURIComponent(t.url).match(new RegExp(v.regex))[v.index]),M&&(P=Object.assign(P,{order_id:M}),this.sendLogEvent(a.eapiService,e,6,{orderParam:P})),Z.abrupt("break",16);case 13:return(v&&"element"===v.type||h.cookie_params)&&setTimeout(function(){a.eventService.fireEvent(A.P.GET_THANKS_PAGE_PARAMETERS,{tabId:a.get("tabs").currentTabId,merchantId:e.get("id"),parameters:v,trackOrderParamMerchant:h})},2e3),Z.abrupt("break",16);case 15:return Z.abrupt("break",16);case 16:case"end":return Z.stop()}},i,this)}))}},{key:"getOrderIdByRequest",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c,h,P,v,M;return u().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if((c=e.get("trackOrderParams"))&&c.length>0&&("request"===(h=c[0]).type&&"url"===(P=h.parameters).type)){v={type:h.type},M=null;try{M=decodeURIComponent(t.url).match(new RegExp(P.regex))[P.index]}catch(Z){}M&&(v=Object.assign(v,{order_id:M}),this.sendLogEvent(a.eapiService,e,6,{orderParam:v}))}case 2:case"end":return L.stop()}},i,this)}))}},{key:"getHistoryTransitionsCurrentTab",value:function(t){var e=t.tabs.selectById(),a=[];return e.get("history").forEach(function(i){a.push({date:i.date,referer:i.referer,url:i.url})}),a}},{key:"getHistoryTransitionsEvent",value:function(t){return t.redirectUrl?{initiator:t.initiator,url:t.redirectUrl,referer:t.url}:{initiator:t.initiator,url:t.url,referer:t.initiator}}},{key:"initializeEventsHandler",value:function(t){var e=this;t.eventService.attachEvent(A.P.SEND_THANKS_PAGE_PARAMETERS,function(a){return(0,l.mG)(e,void 0,void 0,u().mark(function i(){var c,h,P,v,M;return u().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(!(a&&a.data&&a.data.info)){L.next=27;break}if(c={type:a.data.trackOrderParamMerchant.type},!a.data.info.orderId){L.next=6;break}c=Object.assign(c,{order_id:a.data.info.orderId}),L.next=25;break;case 6:if(!a.data.info.cookies){L.next=25;break}h=(0,ee.Z)(a.data.trackOrderParamMerchant.cookie_params),L.prev=8,h.s();case 10:if((P=h.n()).done){L.next=17;break}if(v=P.value,!a.data.info.cookies[v]){L.next=15;break}return c=Object.assign(c,{order_id:a.data.info.cookies[v]}),L.abrupt("break",17);case 15:L.next=10;break;case 17:L.next=22;break;case 19:L.prev=19,L.t0=L.catch(8),h.e(L.t0);case 22:return L.prev=22,h.f(),L.finish(22);case 25:M=t.get("merchants").getMerchantById(a.data.merchantId),this.sendLogEvent(t.eapiService,M,6,{orderParam:c});case 27:case"end":return L.stop()}},i,this,[[8,19,22,25]])}))}),t.eventService.attachEvent(A.P.SENT_LOG_SHOPPING_TRIP,function(a){if(a&&a.data&&a.data.merchantId&&a.data.injectionTracking){var i=t.get("merchants").getMerchantById(a.data.merchantId);e.sendLogEvent(t.eapiService,i,9,a.data.injectionTracking)}})}},{key:"getPromoCode",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c,v,M,w,L,Z,j,oe,Q;return u().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(c=e.get("parsePromoCodeParameters"),"requestRegExp","requestBody",!c||!t.url.includes(c.requestUrl)||t.method!==c.requestMethod){ce.next=16;break}v={type:c.parseType},M=null,ce.t0=c.parseType,ce.next="requestBody"===ce.t0?9:"requestRegExp"===ce.t0?11:14;break;case 9:if(t.requestBody&&t.requestBody.formData)w=t.requestBody.formData,M=w[c.requestData]&&w[c.requestData][0];else if(t.requestBody&&t.requestBody.raw){L=JSON.parse(decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(t.requestBody.raw[0].bytes)))),Z=c.requestData.split("."),j=(0,ee.Z)(Z);try{for(j.s();!(oe=j.n()).done;)Q=oe.value,M=L[Q],L=L[Q]}catch(fe){j.e(fe)}finally{j.f()}}return ce.abrupt("break",15);case 11:return M=t.url.match(new RegExp(c.requestData))[1],v=Object.assign(v,{promoCode:M}),ce.abrupt("break",15);case 14:return ce.abrupt("break",15);case 15:M&&(v=Object.assign(v,{promoCode:M}),this.sendLogEvent(a.eapiService,e,7,{promoCodeParam:v}));case 16:case"end":return ce.stop()}},i,this)}))}},{key:"checkSentTrackingMerchant",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c,h;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:(c=e.get("parseSentTrackingParameters"))&&t.url.includes(c.requestUrl)&&t.method===c.requestMethod&&(h={url:t.url,saveParameters:{cookies:e.get("savedCookie"),get:e.get("savedParams")}},this.sendLogEvent(a.eapiService,e,8,{TrackingMerchantParameters:h}));case 2:case"end":return v.stop()}},i,this)}))}}],[{key:"getInstance",value:function(){return N.instance}}]),N}();W.instance=new W;var J=function(){function N(){if((0,x.Z)(this,N),N.instance)throw new Error("Instantiation failed: use SimilarToolsModule.getInstance() instead of new.")}return(0,Y.Z)(N,[{key:"initializeEventsHandler",value:function(t){var e=this,a=t.get("user");t.eventService.attachEvent(A.P.GET_TOKEN_COOKIES,function(i){return(0,l.mG)(e,void 0,void 0,u().mark(function c(){return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!s.cQ.isBrowser(r.g.BROWSER_NAME_FF)){v.next=6;break}return v.next=3,o.V.syncGet("allowTabUrlCollect");case 3:if(v.sent){v.next=6;break}return v.abrupt("return");case 6:this.globalCashbackIsAvailableHandler(i,t);case 7:case"end":return v.stop()}},c,this)}))}),t.eventService.attachEvent(A.P.SEND_LETYTOOL_EVENT,function(i){return(0,l.mG)(e,void 0,void 0,u().mark(function c(){return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!s.cQ.isBrowser(r.g.BROWSER_NAME_FF)){v.next=6;break}return v.next=3,o.V.syncGet("allowTabUrlCollect");case 3:if(v.sent){v.next=6;break}return v.abrupt("return");case 6:t.similarToolsService.letyToolEvent(i,a);case 7:case"end":return v.stop()}},c)}))}),t.eventService.attachEvent(A.P.NOTIFICATION_GET_SIMILAR_LIST,function(i){return e.getSimilarList(i,t,t.similarToolsService)}),t.eventService.attachEvent(A.P.GET_IMAGE_SEARCH_ITEMS,function(i){return e.getImageSearchItems(i,a,t)}),t.eventService.attachEvent(r.g.GET_IMAGE_INITIAL_BASE_64,function(i){return(0,l.mG)(e,void 0,void 0,u().mark(function c(){return u().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.abrupt("return",this.renderBase64(i.data.url,i.data.options));case 1:case"end":return P.stop()}},c,this)}))})}},{key:"globalCashbackIsAvailableHandler",value:function(t,e){var a=new URL(t.url),i=e.tabs.selectById(e.tabs.currentTabId),c=i&&i.get("history")&&i.get("history").length>0?i.get("history")[i.get("history").length-1].referer:"",h=e.get("user");h&&t&&t.data&&t.data.tokenCookies&&Object.keys(t.data.tokenCookies).length&&h.set({tokenCookies:t.data.tokenCookies});var P=s.cQ.getDomain(t.url),v=P&&e.merchants.selectByDomain(P),M=v?v.attributes.isCashbackAvailable:{};if(v&&v.get("isCashbackAvailable")&&(0===M.code||1===M.code&&(new Date).getTime()-M.lastTimeRequest>M.expire))return e.similarToolsService.sendCashbackIsAvailable(h,a,c,e),!0;t.url.startsWith("http")&&o.V.get("ddList",function(w){w&&!w.includes(s.cQ.getDomain(a.host))&&o.V.get("isCashbackAvailable",function(L){if(L){var oe,Z=[],j=(0,ee.Z)(L);try{for(j.s();!(oe=j.n()).done;){var Q=oe.value;Z.push(Q.url)}}catch(ne){j.e(ne)}finally{j.f()}if(Z.includes(a.host)){var ce,re=(0,ee.Z)(L);try{for(re.s();!(ce=re.n()).done;){var fe=ce.value;fe.url===a.host&&(0===fe.code||1===fe.code&&(new Date).getTime()-fe.lastTimeRequest>fe.expire)&&e.similarToolsService.sendCashbackIsAvailable(h,a,c,e)}}catch(ne){re.e(ne)}finally{re.f()}}else e.similarToolsService.sendCashbackIsAvailable(h,a,c,e)}else e.similarToolsService.sendCashbackIsAvailable(h,a,c,e)})})}},{key:"getHotInfo",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,a.getItemHot(t,e);case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}},i)}))}},{key:"getSimilarList",value:function(t,e,a){var i;return(0,l.mG)(this,void 0,void 0,u().mark(function c(){var h,P,v,M,w,L,Z,j,oe,Q,re,ce,fe,ne,be,Ae,Re,Fe,De,Be,de,He,Se,Ee,Ie,Ce,ke;return u().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(t.data){pe.next=2;break}return pe.abrupt("return",null);case 2:return h=s.cQ.getDomain(t.url),P=h&&e.merchants.selectByDomain(h),v=e.user,M=[],w=[],L=[],Z=t.data,j=Z.similarRequestParams,oe=Z.storageData,pe.next=11,a.getSimilarList(j,v);case 11:if(Q=pe.sent,!P){pe.next=14;break}return pe.abrupt("return",null);case 14:if(re=Q&&Q.searchResult&&Q.searchResult.rows){ce=(0,ee.Z)(re);try{for(ce.s();!(fe=ce.n()).done;)ne=fe.value,be=s.cQ.getDomain(ne.target.url),(Ae=be&&e.merchants.selectByDomain(be))&&Ae.attributes&&Ae.get("settings").showInSimilar?(Re=ne.target.priceMinLast&&ne.target.priceMinLast.price,Fe=Re,De=Re&&Re.value,Be=Re.currency&&r.g.CURRENCY_LIST[Re.currency.name],w.push(ne.target.id),M.push({merchantId:Ae.get("id"),targetId:ne.target.id,ext_referrer:encodeURIComponent(ne.target.url),name:ne.target.name,url:ne.target.url,img:null!==(i=ne.target.imgs[0])&&void 0!==i?i:null,productPricePrefix:Be,productPriceValue:De,productPrice:Fe,link:s.cQ.getViewUrlItem(Ae.get("id"),ne.target.url),cashbackRate:ne.target.cashbackRate,userCashbackAmount:null})):L.push(ne.target.id)}catch(je){ce.e(je)}finally{ce.f()}}return de={isLogin:!!v.isLogin(),settingsQuery:Q.settingsQuery,params:Q.params,offers:M,targetShow:w,targetSkip:L},pe.next=19,o.V.syncGet("similarList");case 19:return He=pe.sent,Se=Object.assign({},He),Ee=Object.assign(Object.assign({},oe),{productData:de}),Ie=Ee.domainKey,Ce=Ee.similarKey,ke=Ee.productData,void 0===Se[Ie]&&(Se[Ie]={blockedByDomain:!1,blockedByTime:null,showMinimizedTill:0}),Se[Ie][Ce]=Object.assign(Object.assign({},ke),{lastTimeUpdated:Date.now()}),"CODE_STOP"===ke.settingsQuery.code&&(Se[Ie].apiBlockTime=Date.now(),Se[Ie].apiBlockTimeExpire=1e3*ke.settingsQuery.expire),Se[Ie][Ce].params&&Se[Ie][Ce].params.isPreview&&delete Se[Ie][Ce].params.isPreview,o.V.set("similarList",Se),pe.abrupt("return",de);case 29:case"end":return pe.stop()}},c)}))}},{key:"getImageSearchItems",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var c,h,P,v,M,w,L,Z,j,oe;return u().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return c=t.data,h=c.attempt,P=c.source,v=c.srcPageUrl,M=c.srcImageUrl,w=[],L=[],delete c.attempt,delete c.source,Z=new URL(c.srcPageUrl).hostname.includes("aliexpress"),e&&e.isLogin()&&(c.currencyCode=e.attributes.balanceInfo.currency),re.next=10,a.similarToolsService.getItemImageSearch(c,e);case 10:if((j=re.sent)&&0!==Object.keys(j).length&&j.xTargetList){re.next=13;break}return re.abrupt("return",null);case 13:return j&&j.xTargetList&&j.xTargetList.length>0&&(oe=j.xTargetList.filter(function(ce){var fe=a.merchants.selectById(+ce.letySourceId);return fe?(w.push(ce.id),!(Z&&!s.cQ.isAliexpress(fe.get("id")))&&(ce.merchantId=+ce.letySourceId,ce.productPriceValue=ce.priceMin,ce)):(L.push(ce.id),!1)})),re.next=16,a.prepareProductOffers(oe);case 16:return j.xTargetList=re.sent,a.eventService.fireEvent(A.P.SEND_LETYTOOL_EVENT,{tabId:null,data:{name:h,data:{from:P,site_url:encodeURIComponent(v),img_url:encodeURIComponent(M),x_target_list_show:w,x_target_list_skip:L}}}),re.abrupt("return",j);case 19:case"end":return re.stop()}},i)}))}},{key:"renderBase64",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:"image/png",maxWidth:1200,maxHeight:1200};return(0,l.mG)(this,void 0,void 0,u().mark(function a(){var i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return i=function(v,M,w,L){var Z=Math.min(1,w/v,L/M);return{width:v*Z,height:M*Z}},h.abrupt("return",new Promise(function(P){if(!t)return P();var v=new Image;try{v.onload=function(){var M=document.createElement("canvas"),w=i(v.naturalWidth,v.naturalHeight,e.maxWidth,e.maxHeight),L=w.width,Z=w.height;M.width=L,M.height=Z,M.getContext("2d").drawImage(v,0,0,L,Z);var j=M.toDataURL(e.format);P(j)},v.crossOrigin="anonymous",v.src=t}catch(M){P()}}));case 2:case"end":return h.stop()}},a)}))}}],[{key:"getInstance",value:function(){return N.instance}}]),N}();J.instance=new J;var X=g.Model.extend({models:["user","merchants","tabs"],history:[],defaults:{merchants:{},offers:{},user:{},tabs:{},currentMerchant:null,currentPopupTab:"merchants"},initialize:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var e,a,i,c,h,P,t=this;return u().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return h=function(L){return(0,l.mG)(this,void 0,void 0,u().mark(function Z(){var j,oe,Q,re,ce,fe,ne,be,Ae,Re,Fe,De,Be,de,He,Se,Ee,Ie,Ce,We,pe,je,$e,xe;return u().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(L.url.includes(f.S.domain)){j=null,oe=null;try{j=L.url.matchAll(r.g.CHECK_LETYSHOPS_GO)[0][0],oe=parseInt(L.url.matchAll(r.g.CHECK_LETYSHOPS_VIEW)[0][1])}catch(we){}j&&oe&&(Q=e.merchants.selectById(oe),re=new URL(L.url),(ce="true"===re.searchParams.get("productWithGo"))&&Q.set("productWithGo",ce))}if(L.url.includes("s.click.aliexpress")||L.url.includes("affiliates.rozetka.com.ua")||(fe=s.cQ.getDomain(L.url),(ne=e.merchants.selectByDomain(fe))&&(e.lastMerchantDomain=ne.get("domain").replace("www.","")),(be=new URL(L.url)).search.substr(1).match("hot_product_id=")&&(i=(Ae=function(Ve){var Ne,Ye,Ge=decodeURIComponent(be.search.substring(1)).split("&");for(Ye=0;Ye<Ge.length;Ye++)if((Ne=Ge[Ye].split("="))[0]===Ve)return void 0===Ne[1]||Ne[1]})("hot_product_id"),c=Ae("rate"),a=!0),!!ne&&!!ne.attributes&&a&&(ne.attributes.hotProducts||(ne.attributes.hotProducts=[]),Re=s.cQ.getDomainPrice(be.host),Fe=s.cQ.getProductId(Re,be.pathname),(De={})[Fe]={hot_product_id:i,rate:c},ne.attributes.hotProducts&&ne.attributes.hotProducts.length>0?_.each(ne.attributes.hotProducts,function(we){Object.keys(we).includes(Fe)||ne.attributes.hotProducts.push(De)}):ne.attributes.hotProducts.push(De),a=!1,i=null,c=null),ne&&e.user.isLogin()&&(ne.get("isActivated")||ne.get("savedParams")||ne.get("rewrite")?ne.get("isActivated")&&ne.get("savedParams")&&e.onParameterResearch(L):(e.onParameterSave(L),ne.get("savedParams")&&ne.trigger(r.g.CASHBACK_ACTIVATE)))),Be=s.cQ.getDomain(L.url),!!(de=e.merchants.selectByDomain(Be))&&de.get("extendedTab")&&(He=e.get("user"),de.get("extendedTab").history.forEach(function(we){var Ve=we.url,Ge=new URL(Ve).href.match(new RegExp(":".concat(He.attributes.token,":T([0-9]*)")));if(Ge){var Ne=de.get("transitionId");de.set("transitionId",Ne&&Ne>Ge[1]?Ne:Ge[1])}})),L.url.includes("s.click.aliexpress")||!L.url.includes("aliexpress.")||!de||!de.get("isActivated")){ye.next=31;break}try{Se=s.cQ.getDomainPrice(new URL(L.url).host),Ee=parseInt(s.cQ.getProductId(Se,new URL(L.url).pathname),10)}catch(we){}if(!Ee||de.get("hot")&&(!de.get("hot")||de.get("hot")["hot_".concat(Ee)])){ye.next=13;break}return ye.next=10,e.similarToolsModule.getHotInfo(L.url,e.user,e.get("similarToolsService"));case 10:(Ie=ye.sent).hot||(Ie.hot=!1),de.attributes.hot=(0,G.Z)({},"hot_".concat(Ee),Ie.hot);case 13:if(!de.get("hot")||!de.get("hot")["hot_".concat(Ee)]||de.get("hot")["hot_".concat(Ee)].isActivatedHotProduct){ye.next=30;break}if(Ce=!1,(e.tabs.selectById(e.tabs.currentTabId).get("history")?e.tabs.selectById(e.tabs.currentTabId).get("history"):de.get("extendedTab").history).forEach(function(we){var Ve=we.url,Le=new URL(Ve);Le.origin.includes("letyshops.com")&&Le.searchParams.get("hot_product_id")&&Le.searchParams.get("rate")&&(Ce=!0)}),Ce){ye.next=30;break}return de.unset("isActivated"),de.unset("savedParams"),de.unset("savedCookie"),(We=de.get("hot")["hot_".concat(Ee)]).isActivatedHotProduct=!0,de.unset("hot"),de.attributes.hot=(0,G.Z)({},"hot_".concat(Ee),We),pe=new Date,je="".concat(de.get("id"),":").concat(e.user.get("token"),":T").concat(de.attributes.shoppingTrip.transitionId),$e="".concat(pe.getFullYear(),"-").concat(pe.getMonth(),"-").concat(pe.getDate(),"_").concat(pe.getHours(),":").concat(pe.getMinutes(),":").concat(pe.getSeconds()),xe="".concat(de.attributes.hot["hot_".concat(Ee)].url,"&subid=").concat(je,"&subid2=").concat($e,"&subid3=ex53").concat(de.attributes.hot["hot_".concat(Ee)].commissionCategory),ye.abrupt("return",framework.browser.navigate({tabId:framework.browser.CURRENTTAB,url:xe}));case 30:de.get("productWithGo")&&(de.set("isSuppressed",!0),de.unset("productWithGo"));case 31:case"end":return ye.stop()}},Z)}))},(e=this).lastMerchantDomain=null,e.similarToolsService=window.similarToolsService=e.get("similarToolsService"),e.eapiService=window.eapiService=e.get("eapiService"),e.eventService=window.eventService=e.get("eventService"),e.configService=window.configService=e.get("configService"),e.featureService=window.featureService=e.get("featureService"),e.localeService=window.localeService=e.get("localeService"),e.categoriesService=window.categoriesService=e.get("categoriesService"),e.apiClient=f.S,e.initializeNotificationHandler(),e.initializeParamsHandler(),e.initializeCookieHandler(),e.set("merchants",new y),e.set("user",new z),e.set("tabs",new U),_.extend(this,_.object(_.map(e.models,function(w){return[w,e.attributes[w]]}))),e.merchants.listenTo(e.user,"change:viewed",function(w,L){o.V.get("viewedMerchants",function(Z){Z&&Z.length>0?(e.user.set("viewed",Z),e.merchants.setViewed(Z)):e.merchants.setViewed(L)})}),e.merchants.listenTo(e.user,"change:favorites",function(w,L){e.merchants.setFavorites(L)}),e.merchants.listenTo(e.user,"change:recommended",function(w,L){e.merchants.setRecommended(L)}),e.merchants.listenTo(e.user,"change:token",function(){e.user.get("token")||(e.merchants.fetchForce(),e.userAutoPromoShops()),e.user.rates.fetch(!0)}),e.merchants.listenTo(e.user.get("rates"),"reset",function(w){e.merchants.setPersonalCashback(w.toJSON())}),e.user.listenTo(e.merchants,"reset",function(w){e.user.isLogin()&&(o.V.get("viewedMerchants",function(L){L&&L.length>0?(e.user.set("viewed",L),w.setViewed(L)):w.setViewed(e.user.get("viewed"))}),w.setRecommended(e.user.get("recommended")),w.setFavorites(e.user.get("favorites")))}),e.listenTo(e.tabs,"change:url",e.initializeInterstitialPageActivationHandler),e.on(r.g.CASHBACK_ACTIVATE,e.activateFromPopup),M.next=28,e.loadUserLanguage();case 28:return a=!1,i=null,c=null,$.support.cors=!0,e.initPopup(),e.onInstalledAndDelete(),S.standard(),framework.browser.name!==r.g.BROWSER_NAME_SAFARI&&chrome.runtime.onConnect.addListener(function(w){return(0,l.mG)(t,void 0,void 0,u().mark(function L(){var j,Z=this;return u().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,s.cQ.getUserSettings();case 2:if(Q.t0=Q.sent,Q.t0){Q.next=5;break}Q.t0={};case 5:j=Q.t0,"optionspresence"===w.name&&w.onDisconnect.addListener(function(){return(0,l.mG)(Z,void 0,void 0,u().mark(function re(){var ce;return u().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.next=2,s.cQ.getUserSettings();case 2:if(ne.t0=ne.sent,ne.t0){ne.next=5;break}ne.t0={};case 5:ce=ne.t0,Object.entries(j).toString()!==Object.entries(ce).toString()&&framework.extension.fireEvent(r.g.SEND_USER_SETTINGS,{data:{type:1}});case 7:case"end":return ne.stop()}},re)}))});case 7:case"end":return Q.stop()}},L)}))}),M.next=38,e.usersNotifyHandler();case 38:return M.next=40,e.userAutoPromoShops();case 40:return M.next=42,e.rivalAddListHandlerAjax();case 42:e.clearCacheInterval(),clearInterval(e.intervalPushLogRequest),e.intervalPushLogRequest=setInterval(function(){e.pushLogRequest(f.S.logRequest())},r.g.INTERVAL_PUSH_LOG_REQUEST),_.delay(function(){o.V.get(r.g.POPUP_FIRST_OPENING_TOKEN,function(w){!w&&!e.user.isLogin()&&S.setBadge("!")})},4e3),P={urls:["<all_urls>"],types:["main_frame","xmlhttprequest"]},s.cQ.isBrowser(r.g.BROWSER_NAME_YABROWSER)&&(P.types=["main_frame","xmlhttprequest","image"]),chrome.webRequest.onBeforeSendHeaders.addListener(function(w){return(0,l.mG)(t,void 0,void 0,u().mark(function L(){return u().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,h(w);case 2:case"end":return j.stop()}},L)}))},P),this.logShoppingTripModule=W.getInstance(),this.logShoppingTripModule.addListenerWebRequestBeforeRequest(e),this.logShoppingTripModule.addListenerWebRequestBeforeRedirect(e),this.logShoppingTripModule.addListenerWebRequestCompleted(e),this.logShoppingTripModule.initializeEventsHandler(e),this.similarToolsModule=J.getInstance(),this.similarToolsModule.initializeEventsHandler(e);case 56:case"end":return M.stop()}},n,this)}))},loadUserLanguage:function(n){return(0,l.mG)(this,void 0,void 0,u().mark(function t(){var e,a,i,c,h,P,v;return u().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return a=(e=this).get("user"),w.next=4,o.V.syncGet("locale");case 4:if(w.t0=w.sent,w.t0){w.next=7;break}w.t0="";case 7:return i=w.t0,c=n||i.split("_")[0]||a.get("language")||r.g.DEFAULT_LANGUAGE,h=i.split("_")[1]||r.g.DEFAULT_COUNTRY,$.i18n({locale:c}),w.prev=11,w.next=14,fetch("./i18n/".concat($.i18n().locale,".json"),{mode:"same-origin"}).then(function(L){return L.json()});case 14:P=w.sent,w.next=22;break;case 17:return w.prev=17,w.t1=w.catch(11),w.next=21,fetch("./i18n/".concat(r.g.DEFAULT_LANGUAGE,".json"),{mode:"same-origin"}).then(function(L){return L.json()});case 21:P=w.sent;case 22:return v=(0,G.Z)({},c,P),$.i18n().load(v),S.setTitle($.i18n("title")),o.V.set("i18nDataLocale",v),e.i18n={locale:c},w.next=29,e.localeService.load(c,h);case 29:case"end":return w.stop()}},t,this,[[11,17]])}))},activateFromPopup:function(n,t){var a=framework.browser.name.toLowerCase(),i=this.merchants.selectById(n);if(i){var c=this.tabs.selectById(),h=i.get("activateUrl"),P=s.cQ.getDomain(c.get("url")),v=s.cQ.checkEnableDisableDomain(i,P);if(c&&v){var M=c.get("url")?encodeURIComponent(c.get("url")):"";framework.browser.navigate({tabId:framework.browser.CURRENTTAB,url:"".concat(f.S.getLink()+h+r.g.PARAMETER_DEEP_LINK+M,"&utm_source=extension&utm_campaign=partner_info&utm_term=").concat(a)})}else{var w=i.get("url").split("/");framework.browser.navigate({tabId:framework.browser.NEWTAB,url:"".concat(f.S.getLink()+h,"?utm_source=extension&utm_campaign=").concat(w[0],"&utm_content=").concat(w[1],"&utm_term=").concat(a)})}t&&t()}},initializeNotificationHandler:function(){var n=this,t=this;framework.extension.attachEvent(r.g.NOTIFICATION_DISMISS,function(e,a){if(e.data){var i=t.merchants.selectById(e.data);i&&i.trigger(r.g.MERCHANT_SUPPRESSED),t.user&&s.cQ.checkUserSegments(r.g.PERMISSIONS_SEGMENTS.extTestQ1,t.user.get("segments"))&&i&&i.setSuppressedTime(),a&&a()}}),framework.extension.attachEvent(r.g.NOTIFICATION_CASHBACK_ACTIVATE,function(e,a){var i;e.data&&((i=e.data&&e.data.merchantId?t.merchants.selectById(e.data.merchantId):t.merchants.selectByDomain(s.cQ.getDomain(e.url)))&&framework.extension.fireEvent(r.g.CLOSE_ALL_NOTIFICATION,{tabId:framework.browser.ALLTABS,data:i.toJSON()}))}),framework.extension.attachEvent(r.g.NOTIFICATION_GET_INFO,_.bind(t.globalPageHandler,t)),framework.browser.attachEvent(framework.browser.DOCUMENTCOMPLETE,_.bind(t.globalPageHandler,t)),framework.browser.attachEvent(framework.browser.TABCHANGED,_.bind(t.globalPageHandler,t)),framework.browser.attachEvent(framework.browser.BEFORENAVIGATE,function(e){o.V.get("settings",function(a){if(a&&a.redirectUrl&&a.redirectUrl.length>0){var i=new URL(e.url),c=null;try{c=window.location.href.matchAll(r.g.CHECK_LETYSHOPS)[0][0]}catch(h){}new RegExp(c,"i").test(i.host)&&!new RegExp(c,"i").test(new URL(a.redirectUrl).host)&&framework.browser.navigate({tabId:t.tabs.currentTabId,url:a.redirectUrl+i.pathname+i.search})}})}),framework.extension.attachEvent(r.g.USER_NOTIFICATION_DISMISS,_.bind(t.usersNotifyDismiss,t)),framework.extension.attachEvent(r.g.SAW_REWRITE,_.bind(t.unRewrite,t)),framework.extension.attachEvent(r.g.BUTTON_UPDATE,_.bind(function(){var e=this,a=!!e.get("currentMerchant")&&e.merchants.selectById(e.get("currentMerchant"));a?a.get("isActivated")?S.green():S.red():S.standard()},t)),framework.extension.attachEvent(r.g.UPDATE_MERCHANTS_RATES,function(){t.user.rates.fetch(!0)}),t.eventService.attachEvent(A.P.LOAD_USER_LANGUAGE,function(e){var a=e.data?e.data.language:null;t.loadUserLanguage(a)}),framework.extension.attachEvent(r.g.REFRESH_ALL,function(){return(0,l.mG)(n,void 0,void 0,u().mark(function e(){return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.user.isLogin()){i.next=8;break}return i.next=3,t.user.fetchNotifications(!0,function(c){t.user.set("notifications",c),_.findWhere(c,{status:"1"})?(S.setBadge(_.where(c,{status:"1"}).length),t.eventService.fireEvent(A.P.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:_.where(c,{status:"1"}),notificationEvent:"fetchUserNotification"}})):S.clearCounter()},!0);case 3:return o.V.set("deliveryCountry",t.user.get("deliveryCountry")),i.next=6,t.userPartnerSettings();case 6:i.next=9;break;case 8:o.V.remove("deliveryCountry");case 9:return i.next=11,t.promoNotifyHandlerAjax();case 11:return i.next=13,t.promoNotifyHandlerTimer();case 13:return i.next=15,t.userSettingsBySegment();case 15:return i.next=17,t.userAutoPromoShops();case 17:return i.next=19,t.merchants.fetchForce();case 19:return i.next=21,t.user.rates.fetch(!0);case 21:t.cleanSimpleSimilarCache(),t.cleanSimilarCache();case 23:case"end":return i.stop()}},e)}))}),framework.extension.attachEvent(r.g.UPDATE_MERCHANTS_HOT_PRODUCTS,function(e){var a=t.merchants.selectById(e.data.id);a&&a.attributes&&(a.attributes.hotProducts=e.data.hotProductsArr)}),framework.extension.attachEvent(r.g.GET_INFO_USER,function(e,a){a&&a(t.user.toJSON())}),framework.extension.attachEvent(r.g.SEND_USER_SETTINGS,function(e){t.clearCacheInterval(),t.pushLogUserSettings(e.data.type)}),framework.extension.attachEvent(r.g.GET_NATIVE_USER_AGENT,function(e,a){a(s.cQ.getFullInfo())}),framework.extension.attachEvent(r.g.GET_MERCHANT_BY_DOMAIN,function(e,a){var i=t.merchants.selectByDomain(e.data.domain);a&&a({merchant:i&&i.toJSON()})}),framework.browser.attachEvent(framework.browser.BEFORENAVIGATE,function(e){o.V.get("settings",function(a){if(a&&a.redirectUrl&&a.redirectUrl.length>0){var i=new URL(e.url),c=null;try{c=window.location.href.matchAll(r.g.CHECK_LETYSHOPS)[0][0]}catch(h){}c===i.host&&i.host!==new URL(a.redirectUrl).host&&framework.browser.navigate({tabId:t.tabs.currentTabId,url:a.redirectUrl+i.pathname+i.search})}})}),t.eventService.attachEvent(A.P.SEND_USER_NOTIFICATION_LOGS,function(e){t.pushUserNotificationLogs(e.data)}),t.eventService.attachEvent(A.P.CREATE_ADVICES,function(e){var a,i,c=new URL(null!==(a=t.tabs.selectById(t.tabs.currentTabId).get("url"))&&void 0!==a?a:e.url),h=c.origin+c.pathname,P=null!==(i=e.data.source)&&void 0!==i?i:"popup";return o.V.syncGet(h).then(function(v){return!v||void 0===v||_.now()-v.linkAdviceLastCreate>6e4?(o.V.set(h,null),t.eapiService.getAdvices({link:h,source:P}).then(function(M){var w={link:h,adviceLink:M.link,linkAdviceLastCreate:_.now()};return o.V.set(h,w),w})):v})}),t.eventService.attachEvent(r.g.GET_SIMPLE_SIMILAR_DOMAIN_DATA,function(e){return(0,l.mG)(n,void 0,void 0,u().mark(function a(){var i,h,P,v,L,Z,j;return u().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(i=e.data.domain,!t.merchants.selectByDomain(i)&&i){Q.next=4;break}return Q.abrupt("return");case 4:return h={domainsList:[],settings:r.g.SIMPLE_SIMILAR_VIEWS_SETTINGS},Q.next=7,o.V.syncGet("simpleSimilar");case 7:if(P=Q.sent,!(!_.isEmpty(P)&&!_.isEmpty(P.domainsList))){Q.next=17;break}if(L=P.domainsList,v=Object.assign({},P),!L.some(function(re){return re.domain.replace("www.","").includes(i)})){Q.next=15;break}return Q.abrupt("return",v);case 15:Q.next=18;break;case 17:v=Object.assign({},h);case 18:return Q.next=20,t.eapiService.getSimpleSimilarSettings(i);case 20:if(Z=Q.sent,_.isEmpty(Z)||_.isEmpty(Z.domainsList)){Q.next=26;break}Z.domainsList.forEach(function(re){re.status=!0,re.pageCount=1,re.lastShown=1,v.domainsList.push(re)}),v.settings=Z.settings,Q.next=30;break;case 26:return Q.next=28,t.configService.getParameter(m.E.INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR);case 28:j=Q.sent,v.domainsList.push({domain:i,status:Date.now()+j});case 30:return o.V.set("simpleSimilar",v),Q.abrupt("return",v);case 32:case"end":return Q.stop()}},a)}))}),t.eventService.attachEvent(A.P.GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK,function(e){return t.prepareProductOffers(e.data.offers)}),t.eventService.attachEvent(A.P.IS_BROWSER,function(e){return e.data.names.some(function(i){return s.cQ.isBrowser(i)})}),t.eventService.attachEvent(A.P.GET_USER_PARTNER_DATA,function(){return(0,l.mG)(n,void 0,void 0,u().mark(function e(){var a;return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,o.V.syncGet("userPartnerData");case 2:if(a=c.sent,!_.isEmpty(a)||!t.user.isLogin()){c.next=7;break}return c.next=6,t.eapiService.getPartnerSystemData();case 6:a=c.sent;case 7:return c.abrupt("return",a);case 8:case"end":return c.stop()}},e)}))}),t.eventService.attachEvent(A.P.UPDATE_USER_FORCE,function(){t.user.fetch(!0)}),t.eventService.attachEvent(A.P.UPDATE_FAVORITE_STATUS,function(e){t.onFavoriteClick(e)}),t.eventService.attachEvent(A.P.FETCH_SIMPLE_SIMILAR_AUTOPROMO,function(){return t.eapiService.getSimpleSimilarOffers()}),t.eventService.attachEvent(A.P.GET_API_CLIENT_URLS_STATE,function(){return Object.assign(Object.assign({},f.S),{reasonCashbackReactivate:f.S.reasonCashbackReactivate(),confidentialPage:f.S.confidentialPage(),helpPage:f.S.helpPage(t.localeService.language)})}),t.eventService.attachEvent(A.P.GET_VALID_AUTOPROMO_OFFERS,function(){return(0,l.mG)(n,void 0,void 0,u().mark(function e(){var a;return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,t.getValidAutopromoOffers();case 2:return a=c.sent,c.abrupt("return",a);case 4:case"end":return c.stop()}},e)}))}),t.eventService.attachEvent(A.P.GET_ALL_MERCHANTS_AND_AUTOPROMO_POPUP,function(){return(0,l.mG)(n,void 0,void 0,u().mark(function e(){var a,i,c,h,P,v,M,w,L;return u().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return c=null!==(a=t.user.get("recommended"))&&void 0!==a?a:[],h=null!==(i=t.user.get("viewed"))&&void 0!==i?i:[],P=t.user.isLogin(),j.next=5,t.getValidAutopromoOffers();case 5:return v=j.sent,M=v.autoPromotions,w=t.merchants.toJSON(t.merchants.models),L=!!M&&M.filter(function(oe){return oe.autoPromotion.placements.includes("extension_main")}),w.forEach(function(oe){oe.isRecommended=oe.isRecommended||c.includes(function(Q){return+Q==+oe.id}),oe.isViewed=P&&(oe.isViewed||h.includes(function(Q){return+Q==+oe.id})),oe.autoPromotion=L&&L.find(function(Q){return+Q.id==+oe.id})}),j.abrupt("return",w);case 11:case"end":return j.stop()}},e)}))})},globalPageHandler:function(n,t){var e;return(0,l.mG)(this,void 0,void 0,u().mark(function a(){var i,c,h,P,v,M,w,L,Z,j;return u().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(i=this,S.animation=!1,!_.isEmpty(n.url)&&!n.url.startsWith("chrome://newtab")){Q.next=6;break}return i.attributes.currentMerchant=null,S.standard(),Q.abrupt("return");case 6:if(c=s.cQ.getDomain(n.url),h=i.tabs.selectById(n.tabId),P=i.user,(v=c&&i.merchants.selectByDomain(c))&&h&&c){Q.next=14;break}return i.attributes.currentMerchant=null,S.standard(),Q.abrupt("return");case 14:return v&&(!v.get("delayActivate")&&v.get("isActivated")||v.get("delayActivate")&&(new Date).getTime()>v.get("delayActivate"))&&(v.reset&&v.reset(),(M=v.get("shoppingTrip")).activationStatePrevious=M.activationState,M.activationState=5,W.getInstance().setActivationStatusShoppingTrip(v,!1)),v&&P&&s.cQ.checkUserSegments(r.g.PERMISSIONS_SEGMENTS.extTestQ1,P.get("segments"))&&!v.get("isActivated")&&v.get("isSuppressed")&&v.get("isSuppressedTime")&&(new Date).getTime()>v.get("isSuppressedTime")&&v.clearSuppressed&&v.clearSuppressed(),Q.next=18,i.configService.getParameter(m.E.INTERVAL_COUNT_USER_CASHBACK_RATES);case 18:w=Q.sent,!!v&&!!P&&P.isLogin()&&(!v.get("lastTimeCountPersonalCashback")||_.now()-v.get("lastTimeCountPersonalCashback")>w)&&i.merchants.fetchUserCashbackRates(v).then(),v&&i.tabs.currentTabId===n.tabId?((v.get("settings").partnerList||v.get("settings").partnerListNoActive)&&P.rewriteViewed(v.id),i.attributes.currentMerchant=v.id,v&&v.get("settings").browserAction&&i.tabs.currentTabId===h.id?v.get("isActivated")&&i.user.isLogin()?S.green():(S.animation=!0,_.delay(function(){S.pulseIcon().then(function(){return S.red()}).catch(function(){var re=i.get("tabs").selectById(i.get("tabs").currentTabId);if(re){var ce=s.cQ.getDomain(re.get("url")),fe=i.get("merchants").selectByDomain(ce);if(fe&&fe.get("isActivated"))return void S.green()}S.standard()})},500)):v&&i.tabs.currentTabId===h.id&&S.standard()):(i.attributes.currentMerchant=null,h&&i.tabs.currentTabId===h.id&&S.standard()),L=h&&h.get("state"),Z=null;try{Z=url.matchAll(r.g.CHECK_LETYSHOPS_VIEW)[0][0]}catch(re){}n.name===framework.browser.DOCUMENTCOMPLETE&&!new RegExp(Z,"i").test(n.url)&&h.immediateReset(),r.g.TAB_STATE_INTERSTITIAL_REDIRECT!==(L&&r.g.TAB_STATE_INTERSTITIAL_REDIRECT)&&r.g.TAB_STATE_3RD_PARTY===(L&&r.g.TAB_STATE_3RD_PARTY)?v.trigger(r.g.MERCHANT_SUPPRESSED):r.g.TAB_STATE_INTERSTITIAL_REDIRECT===(L&&r.g.TAB_STATE_INTERSTITIAL_REDIRECT)&&v&&v.get("settings").browserAction&&i.tabs.currentTabId===h.id&&(v.get("isActivated")?S.green():S.red()),j=null!==(e=v.get("hasPromoActivated"))&&void 0!==e?e:null,v.attributes.extendedTab=h&&h.attributes,v.attributes.extendedPromo=j&&j.attributes,t&&t(v.attributes);case 30:case"end":return Q.stop()}},a,this)}))},initializeInterstitialPageActivationHandler:function(n,t,e){if(t){var a=this;if(t.includes(f.S.domain)){var i=null;try{i=parseInt(t.matchAll(r.g.CHECK_LETYSHOPS_VIEW)[0][1])}catch(P){}if(i){var c=a.merchants.getMerchantById(i);if(!c){var h=_.filter(a.merchants.models,_.bind(function(P){return _.contains(P.get("promo"),parseInt(i))},a));_.isArray(h)&&!_.isEmpty(h)&&(c=h[0])}c&&(c.reset&&c.reset(),c.unset("rewrite"),c.set({extendedTabThanksPage:{state:n.get("state")||r.g.TAB_STATE_INTERSTITIAL_REDIRECT,interstitialPageId:i,shopId:i,interstitialPage:t,tabInfo:n.attributes}}),n.set("state",n.get("state")||r.g.TAB_STATE_INTERSTITIAL_REDIRECT),n.set("interstitialPageId",i),n.set("shopId",i),n.set("interstitialPage",t))}}else $.each(r.g.THIRD_PARTY_LINKS,function(P,v){if(-1!==t.indexOf(v))return n.set("state",n.get("state")||r.g.TAB_STATE_3RD_PARTY),!1})}},usersNotifyHandler:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e,a,i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return(t=this).user.isLogin()&&(e=t.user.get("notifications"),(a=_.where(e,{status:"1",showed:!1}))&&a.length&&(t.user.set("notifications",_.map(e,function(P){return P.showed=!0,P})),a.forEach(function(P){function v(L){t.eventService.fireEvent(A.P.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:[P],notificationEvent:L}})}var M=P.id,w={type:"basic",iconUrl:"images/btn/logo65.png",title:$.i18n("titleCreateNotification"),message:P.markup.replace(/<\/?[^>]+(>|$)/g,"")};chrome.notifications.create(M,w,function(){v("createNotification")}),chrome.notifications.onClicked.addListener(function(L){if(L===M){var Z=s.cQ.getFullInfo().browser===r.g.BROWSER_NAME_YABROWSER?"yabrowser":framework.browser.name.toLowerCase();framework.browser.navigate({tabId:framework.browser.NEWTAB,url:"".concat(f.S._root+P.url,"&utm_term=").concat(Z)}),S.setBadge(_.where(P,{status:"1"}).length),t.user.pushReviewedNotifications(P.id),v("clickNotification"),chrome.notifications.clear(L)}}),s.cQ.getFullInfo().browser!==r.g.BROWSER_NAME_FF&&(s.cQ.getFullInfo().os.includes("Mac OS")||!s.cQ.getFullInfo().os.includes("Mac OS"))&&chrome.notifications.onClosed.addListener(function(L,Z){L===M&&Z&&(S.setBadge(_.where(P,{status:"1"}).length),t.user.pushReviewedNotifications(P.id),v("closeNotification"))})}))),clearInterval(t.intervalUsersNotifyHandler),h.next=5,t.configService.getParameter(m.E.USER_NOTIFY_INTERVAL);case 5:i=h.sent,t.intervalUsersNotifyHandler=setInterval(function(){t.usersNotifyHandler()},i);case 7:case"end":return h.stop()}},n,this)}))},promoNotifyHandler:function(){var n=this,t="promoNotifications",e=n.tabs.selectById(n.tabs.currentTabId);o.V.get("showPromoNotifications",function(i){if((void 0===i||i)&&e&&e.attributes){var c=new URL(e.get("url"));o.V.get(t,function(h){h&&_.each(h,function(P,v){(P.domains.includes("*")||P.domains.includes(c.origin))&&_.now()>new Date(P._notificateAt).getTime()&&_.now()<new Date(P._expireAt).getTime()&&"push"===P.type&&o.V.get("".concat(t,"_").concat(v),function(M){M||function a(i,c){var h="images/btn/logo65.png";function P(w){n.eventService.fireEvent(A.P.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:[{id:i.id,type:"promo"}],notificationEvent:w}})}(i._href_logo||i._href_logo.startsWith("http"))&&(h=i._href_logo);var v=i.id,M={type:"basic",iconUrl:h,title:i.title,message:i.message};chrome.notifications.create(v,M,function(){P("createPromoNotification")}),chrome.notifications.onClicked.addListener(function(w){w===v&&(framework.browser.navigate({tabId:framework.browser.NEWTAB,url:i._href}),P("clickPromoNotification"),chrome.notifications.clear(w))}),s.cQ.getFullInfo().browser!==r.g.BROWSER_NAME_FF&&(s.cQ.getFullInfo().os.includes("Mac OS")||!s.cQ.getFullInfo().os.includes("Mac OS"))&&chrome.notifications.onClosed.addListener(function(w,L){w===v&&L&&P("closePromoNotification")}),"function"==typeof c&&c()}(P,function(){o.V.set("".concat(t,"_").concat(v),!0)})})})})}})},promoNotifyHandlerTimer:function(){var n=this;clearInterval(n.intervalPromoNotifyHandler),n.intervalPromoNotifyHandler=setInterval(function(){n.promoNotifyHandler()},r.g.PROMO_NOTIFY_INTERVAL)},usersNotifyDismiss:function(n,t){n.data&&this.user&&this.user.pushReviewedNotifications(n.data),t&&t()},userAutoPromoShops:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=this,i.next=3,t.eapiService.getSimpleSimilarOffers();case 3:return i.next=5,t.configService.getParameter(m.E.UPDATE_INTERVAL_AUTOPROMO);case 5:e=i.sent,clearInterval(t.intervalUserAutoPromoShops),t.intervalUserAutoPromoShops=setInterval(function(){(!t.delayUserAutoPromoShops||(new Date).getTime()>t.delayUserAutoPromoShops)&&(t.delayUserAutoPromoShops=(new Date).getTime()+e,t.userAutoPromoShops())},e/2);case 8:case"end":return i.stop()}},n,this)}))},userPartnerSettings:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(t=this).eapiService.getPartnerSystemData().then(),i.next=4,t.configService.getParameter(m.E.UPDATE_INTERVAL_USER_PARTNER_SETTINGS);case 4:e=i.sent,clearInterval(t.intervalUserPartnerSettings),t.intervalUserPartnerSettings=setInterval(function(){(!t.delayUserPartnerSettings||(new Date).getTime()>t.delayUserPartnerSettings)&&(t.delayUserPartnerSettings=(new Date).getTime()+e,t.userPartnerSettings())},e/2);case 7:case"end":return i.stop()}},n,this)}))},promoNotifyHandlerAjax:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(t=this).eapiService.getPromoNotifications().then(),i.next=4,t.configService.getParameter(m.E.PROMO_NOTIFY_PERIOD);case 4:e=i.sent,clearInterval(t.intervalPromoNotifyHandlerAjax),t.intervalPromoNotifyHandlerAjax=setInterval(function(){(!t.delayPromoNotifyHandlerAjax||(new Date).getTime()>t.delayPromoNotifyHandlerAjax)&&(t.delayPromoNotifyHandlerAjax=(new Date).getTime()+e,t.promoNotifyHandlerAjax())},e/2);case 7:case"end":return i.stop()}},n,this)}))},userSettingsBySegment:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e,a;return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(e=(t=this).user.get("segments"),!t.user.isLogin()||!e){c.next=8;break}return clearInterval(t.intervalupdateUserSettingsBySegment),c.next=6,t.configService.getParameter(m.E.INTERVAL_COUNT_SETTINGS_BY_SEGMENT);case 6:a=c.sent,t.intervalupdateUserSettingsBySegment=setInterval(function(){t.userSettingsBySegment()},a);case 8:case"end":return c.stop()}},n,this)}))},initializeParamsHandler:function(){framework.extension.attachEvent(r.g.GET_EXTENSION_INFO,function(n){framework.extension.fireEvent(r.g.SEND_EXTENSION_INFO,{tabId:n.tabId,data:{version:framework.extension.version,name:framework.extension.name}})})},initializeCookieHandler:function(){var n=this;n.eventService.attachEvent(A.P.SET_MERCHANT_COOKIES,function(t){if(t.data){var e=n.merchants.getMerchantById(t.data.merchantId);e&&e.set("savedCookie",t.data.cookie)}}),n.eventService.attachEvent(A.P.CASHBACK_DEACTIVATE,function(t){if(t.data){var e=n.merchants.getMerchantById(t.data.merchantId),i=(n.tabs.selectById(n.tabs.currentTabId),e.get("savedCookie"));if(!e.get("rewrite")){S.red(),e.reset(),e.set({rewrite:!0});var c=e.get("shoppingTrip");n.logShoppingTripModule.setActivationStatusShoppingTrip(e,!1),c.activationStatePrevious=c.activationState,c.activationState=4,c.transitionIdPrevious=c.transitionId,c.transitionId=0;var h=n.logShoppingTripModule.getHistoryTransitionsCurrentTab(n);n.logShoppingTripModule.sendLogEvent(n.eapiService,e,3,{overwritten:{type:"cookie",savedCookie:i,pageCookies:t.data.pageCookies},historyTransitions:h})}}}),n.eventService.attachEvent(A.P.CHECK_MERCHANT_COOKIES,function(t){var e=s.cQ.getDomain(t.url),a=e&&n.merchants.selectByDomain(e);return a&&a.get("checkCookieParams")&&a.get("checkCookieParams").length?{merchant:a.toJSON()}:null}),n.eventService.attachEvent(A.P.CLEAR_COOKIES,function(t){var e=s.cQ.getDomain(t.url),a=e&&n.merchants.selectByDomain(e);a&&a.set("savedCookie",null)})},onParameterResearch:function(n){var t=this,e=n.url,a=s.cQ.getDomain(e),i={},h=(t.tabs.selectById(n.tabId),a&&t.merchants.selectByDomain(a));if(h&&h.get("checkUrlParams")&&h.get("checkUrlParams").length&&h.get("isActivated")){var P=h.get("checkUrlParams");if(h.get("savedParams")&&h.get("savedParams").length>0){var M,v=h.get("savedParams");if(_.keys(s.cQ.getAllUrlParams(e)).length>0){var w=!0;_.each(v,function(j){if(w){var oe=_.filter(P,function(Q){return _.isEqual(_.keys(Q),_.keys(j))});_.each(oe[0],function(Q,re){var ce=new RegExp("".concat(re.replace("$","\\$"),"=([^&]+)"),"i").exec(decodeURIComponent(e));if(ce){var fe=new RegExp("".concat(re.replace("$","\\$"),"=([^;]+)"),"i").exec(decodeURIComponent(decodeURIComponent(ce[0])));null!==fe&&new RegExp(Q,"i").test(fe[1])?i[re]=fe[1].split(" ").join("+"):i[re]=null}}),JSON.stringify(_.keys(i))===JSON.stringify(_.keys(j))?M=JSON.stringify(j)===JSON.stringify(i):0!==_.compact(_.uniq(_.values(i))).length?(M=!0,_.each(i,function(Q,re){if(-1!==Object.keys(j).indexOf(re)){var ce=-1!==Object.values(j).indexOf(Q);ce||(M=ce)}})):M=!0,M||(w=!1)}})}else M=!0;if(!M){h.resetOnRewrite(),h.set({rewrite:!0}),t.tabs.currentTabId===n.tabId&&S.red(),h.set("extendedTabThanksPage");var L=h.get("shoppingTrip");t.logShoppingTripModule.setActivationStatusShoppingTrip(h,!1),L.activationStatePrevious=L.activationState,L.activationState=4,L.transitionIdPrevious=L.transitionId,L.transitionId=0;var Z=t.logShoppingTripModule.getHistoryTransitionsCurrentTab(t);t.logShoppingTripModule.sendLogEvent(t.eapiService,h,3,{overwritten:{type:"get",cashbackParams:v,checkedParams:i},historyTransitions:Z})}}}},onParameterSave:function(n){var e=n.url,a=s.cQ.getDomain(e),i=this.merchants.selectByDomain(a);if(_.keys(s.cQ.getAllUrlParams(e)).length>0||0===_.keys(s.cQ.getAllUrlParams(e)).length&&void 0!==i.get("mainFrame")){if(i&&i.get("checkUrlParams")&&i.get("checkUrlParams").length&&!i.get("isActivated")&&!i.get("savedParams")){var c=i.get("checkUrlParams"),P=[];return _.each(c,function(v){var M=_.chain(v).map(function(L,Z){var j=new RegExp("".concat(Z.replace("$","\\$"),"=([^&]+)"),"i").exec(decodeURIComponent(e));if(j){var oe=new RegExp("".concat(Z.replace("$","\\$"),"=([^;]+)"),"i").exec(decodeURIComponent(decodeURIComponent(j[0])));return null!==oe&&new RegExp(L,"i").test(oe[1])?[Z,oe[1].split(" ").join("+")]:[Z,null]}}).compact().object().value(),w=[];$.each(M,function(L,Z){w.push(Z)}),w.length>0&&!w.includes(null)&&P.push(M)}),P&&P.length>0&&i.set("savedParams",P),!0}i&&!i.get("isActivated")&&!i.get("rewrite")&&_.isEmpty(i.get("checkUrlParams"))&&(this.unset("mainFrame"),i.trigger(r.g.CASHBACK_ACTIVATE))}else i.set("mainFrame",!0)},unRewrite:function(n){var e=this.merchants.selectById(n.data.id);e.resetOnRewrite(),e.set({rewrite:!1}),e.set("savedParams",[])},onFavoriteClick:function(n){var t=this;if(n.data){var e=n.data.id,a=n.data.isFavorite;a?t.user.pushDisliked(e):t.user.pushLiked(e),t.merchants.selectById(e).set("isFavorite",!a),n.data.triggerContent&&t.updateFavoriteStatusInContent(!a,e)}},updateFavoriteStatusInContent:function(n,t){this.eventService.fireEvent(A.P.UPDATE_FAVORITE_STATUS_FROM_BG,{tabId:framework.browser.ALLTABS,data:{isFavorite:n,id:t}})},initPopup:function(){framework.ui.button.setPopup({url:"popup/popup.html",width:r.g.POPUP_WIDTH,height:r.g.POPUP_HEIGHT})},onPopupFirstOpening:function(){S.setBadge(""),o.V.get(r.g.POPUP_FIRST_OPENING_TOKEN,function(n){n||o.V.set(r.g.POPUP_FIRST_OPENING_TOKEN,"Wow!")})},onInstalledAndDelete:function(){var n=this,t=this;o.V.get("afterInstallPageIsShown",function(e){if(!e){if(o.V.set("afterInstallPageIsShown",!0),s.cQ.isBrowser(r.g.BROWSER_NAME_FF)){var a=r.g.DEFAULT_FIREFOX_USER_SETTINGS;Object.keys(a).forEach(function(i){return(0,l.mG)(n,void 0,void 0,u().mark(function c(){var h;return u().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,o.V.syncGet(i);case 2:if(h=v.sent,!_.isUndefined(h)){v.next=7;break}return o.V.set(i,a[i]),v.next=7,s.cQ.saveUserSettings(i,a[i]);case 7:case"end":return v.stop()}},c)}))})}t.pushLogInstall(),_.delay(function(){framework.browser.navigate({tabId:framework.browser.NEWTAB,url:f.S.afterInstall()})},500),chrome.runtime.setUninstallURL(f.S.afterDelete())}})},pushLogInstall:function(){var n=this,t=n.user;if(t&&t.isLogin()){var e=s.cQ.getFullInfo(),a={url:f.S.logInstall(),type:"POST",data:{os:e.os,browser:e.browser,browser_version:e.version,extension_version:framework.extension.version},dataType:"json"};$.ajax(a).done(),clearInterval(n.intervalPushLogInstall)}else clearInterval(n.intervalPushLogInstall),n.intervalPushLogInstall=setInterval(function(){n.pushLogInstall(f.S.logInstall())},r.g.INTERVAL_PUSH_LOG)},pushLogUserSettings:function(n){return(0,l.mG)(this,void 0,void 0,u().mark(function t(){var e,a,i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(e=this.user)||!e.isLogin()){h.next=12;break}return h.next=4,s.cQ.getUserSettings();case 4:if(h.t0=h.sent,h.t0){h.next=7;break}h.t0={};case 7:return a=h.t0,i=s.cQ.isBrowser(r.g.BROWSER_NAME_FF)?r.g.DEFAULT_FIREFOX_USER_SETTINGS:r.g.DEFAULT_USER_SETTINGS,h.next=11,Object.keys(i).forEach(function(P){a&&!a.hasOwnProperty(P)&&(a[P]=i[P],s.cQ.saveUserSettings(P,i[P]))});case 11:$.ajax({url:f.S.logUserSettings(),type:"POST",data:{type:n,settings:a},dataType:"json"}).done();case 12:case"end":return h.stop()}},t,this)}))},pushLogRequest:function(){var n=this,t=n.user,e="timePushLogRequest";o.V.get("afterInstallPageIsShown",function(a){a&&o.V.get(e,function(i){if((!i||_.now()-i>r.g.UPDATE_LOG_REQUEST)&&t&&t.isLogin()){var c=s.cQ.getFullInfo(),h={url:f.S.logRequest(),type:"POST",data:{os:c.os,browser:c.browser,browser_version:c.version,extension_version:framework.extension.version},dataType:"json"};$.ajax(h).done(),clearInterval(n.intervalPushLogRequest),o.V.set(e,_.now())}})})},pushUserNotificationLogs:function(n){var e=this.user;if(e&&e.isLogin()&&n&&n.arrayNotifications&&n.arrayNotifications.length>0&&n.notificationEvent){var a=[];_.each(n.arrayNotifications,function(c){a.push({user_id:e.get("token"),notification_id:c.id,notification_type:c.type,notification_recipient:r.g.NOTIFICATION_RECIPIENT,notification_event:n.notificationEvent})});var i={url:f.S.userNotificationLogs(),type:"POST",data:{data:a},dataType:"json"};$.ajax(i).done()}},rivalAddListHandlerAjax:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e,a,i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return t=this,h.next=3,o.V.syncGet("locale");case 3:return e=h.sent,a={url:"".concat(f.S.ddList(),"?locale=").concat(e||"".concat(r.g.DEFAULT_LANGUAGE,"_").concat(r.g.DEFAULT_COUNTRY)),type:"get",dataType:"json"},$.ajax(a).done(function(P){o.V.set("ddList",P)}),clearInterval(t.intervalRListHandlerAjax),h.next=9,t.configService.getParameter(m.E.R_LIST_ADD_PERIOD);case 9:i=h.sent,t.intervalRListHandlerAjax=setInterval(function(){t.rivalAddListHandlerAjax()},i);case 11:case"end":return h.stop()}},n,this)}))},checkMerchantInAutopromo:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[];return Object.keys(n).forEach(function(i){"lastUpdate"!==i&&(a=[].concat((0,R.Z)(a),(0,R.Z)(n[i])))}),a.find(function(i){return parseInt(i.id)===parseInt(t)&&!_.isEmpty(i.autoPromotion)&&(i.autoPromotion.placements.includes(e)||_.isString(i.autoPromotion.endAt))})},getCalculatedPriceForOffer:function(n){var t,e,a=n.cashbackRate&&n.cashbackRate.rate;if(a)switch(a.type){case"RATE_TYPE_PERCENT":return(n.productPriceValue*a.value*(null!==(t=n.userBonusCoefficient)&&void 0!==t?t:1)/100).toFixed(2);case"RATE_TYPE_FIXED":return(a.value*(null!==(e=n.userBonusCoefficient)&&void 0!==e?e:1)).toFixed(0)}return null},getValidAutopromoOffers:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function n(){var t,e;return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=this,i.next=3,o.V.syncGet("simpleSimilarOffers");case 3:if(e=i.sent,_.isEmpty(e)||_.isEmpty(e.autoPromotions)||!s.cQ.getEndedAutopromo(e)){i.next=11;break}return t.merchants.resetAll(),i.next=8,t.user.rates.fetch(!0);case 8:return i.next=10,t.eapiService.getSimpleSimilarOffers();case 10:e=i.sent;case 11:return i.abrupt("return",e);case 12:case"end":return i.stop()}},n,this)}))},prepareProductOffers:function(n){return(0,l.mG)(this,void 0,void 0,u().mark(function t(){var e,a;return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return e=this,c.next=3,e.getValidAutopromoOffers();case 3:return a=c.sent,c.abrupt("return",n.map(function(h){return e.addAutopromoAndCashbackToOffer(h,a)}));case 5:case"end":return c.stop()}},t,this)}))},addAutopromoAndCashbackToOffer:function(n,t){var e,a,i,v,M,w,c=this,h=c.merchants.getMerchantById(n.merchantId),P=h.get("suffix");if(n.cashbackFloated=h.get("cashbackFloated"),n.merchantTitle=h.get("title"),n.cashback=h.get("cashback"),n.userCashback=h.get("userCashback"),n.userBonusCoefficient=null!==(e=h.get("bonusCoefficient"))&&void 0!==e?e:null,n.userBonus=null!==(a=h.get("bonus"))&&void 0!==a?a:null,!_.isEmpty(n.cashbackRate)){var L=n.cashbackRate.rate;try{w=parseFloat((L.value*(null!==(i=n.userBonusCoefficient)&&void 0!==i?i:1)).toFixed(2))+P}catch(oe){w=null}if(v=c.checkMerchantInAutopromo(t,n.merchantId,"similar_products"),M=c.getCalculatedPriceForOffer(n),!_.isEmpty(v)&&v.autoPromotion&&v.autoPromotion.bonus&&(n.userBonusCoefficient=s.cQ.calculateRateCoefficient(v.autoPromotion.bonus),w=parseFloat((L.value*n.userBonusCoefficient).toFixed(2))+P,M=c.getCalculatedPriceForOffer(n),!_.isEmpty(v.autoPromotion.maxLimit))){var Z=!_.isEmpty(n.productPrice)&&n.productPrice.currency,j=v.autoPromotion.maxLimit[Z.name];j&&+M>j.amount&&(M=j.amount)}}return Object.assign(Object.assign({},n),{userCashbackAmount:M,autopromo:v,userCashbackOffer:w})},clearCacheInterval:function(){var n=this;o.V.syncGet("userSettings").then(function(t){var e=t&&!t.showSimpleSimilarInjection&&!_.isUndefined(t.showSimpleSimilarInjection),a=t&&!t.showSimilarListInjection&&!_.isUndefined(t.showSimilarListInjection);clearInterval(n.clearCache),n.cleanSimpleSimilarCache(e),n.cleanSimilarCache(a),(!e||!a)&&(n.clearCache=setInterval(function(){n.clearCacheInterval()},r.g.CLEAR_CACHE_INTERVAL))})},cleanSimpleSimilarCache:function(n){var t="simpleSimilar";o.V.syncGet(t).then(function(e){if(n||_.isEmpty(e))o.V.remove(t);else{var a=e.domainsList.filter(function(i){return"boolean"==typeof i.status?!i.status:i.status>Date.now()});o.V.set(t,{domainsList:a,settings:e.settings})}})},cleanSimilarCache:function(n){var t="similarList";o.V.syncGet(t).then(function(e){if(n||_.isEmpty(e))o.V.remove(t);else{for(var a={},i=0,c=Object.keys(e);i<c.length;i++){var h=c[i],P=e[h],v=P.showMinimizedTill>Date.now(),M=P.blockedByDomain,w=P.blockedByTime&&P.blockedByTime>Date.now(),L=P.apiBlockTimeExpire&&_.now()-P.apiBlockTime<P.apiBlockTimeExpire;(v||M||w||L)&&(a[h]={blockedByDomain:P.blockedByDomain,blockedByTime:P.blockedByTime,apiBlockTime:P.apiBlockTime,apiBlockTimeExpire:P.apiBlockTimeExpire,showMinimizedTill:P.showMinimizedTill})}o.V.set(t,a)}})}}),te=O(1048),k=function(){function N(n){(0,x.Z)(this,N),this.httpClient=n,this.googleAnalyticsURL="https://www.google-analytics.com",this.googleAnalyticsURLCollect="/collect",this.googleFormUrl="https://docs.google.com/forms",this.cloudFunctionUrl="https://us-central1-excellent-style-170512.cloudfunctions.net",this.cloudFunctionUrlCollect="/ga_extension"}return(0,Y.Z)(N,[{key:"sendGoogleAnalyticsData",value:function(t){for(var e=new URL("".concat(this.googleAnalyticsURL).concat(this.googleAnalyticsURLCollect)),a=0,i=Object.keys(t);a<i.length;a++){var c=i[a];try{e.searchParams.append(c,decodeURIComponent(t[c]))}catch(h){e.searchParams.append(c,t[c])}}this.httpClient.post(e.href,null,{responseType:"text"}).subscribe()}},{key:"sendGoogleAnalyticsDataCloudFunction",value:function(t){this.httpClient.post("".concat(this.cloudFunctionUrl).concat(this.cloudFunctionUrlCollect),JSON.stringify(t),{headers:{"Content-Type":"application/json"}}).subscribe()}},{key:"sendGoogleFormData",value:function(t,e){for(var a=[],i=0,c=Object.keys(t);i<c.length;i++){var h=c[i];a.push(encodeURIComponent(h)+"="+encodeURIComponent(t[h]))}this.httpClient.post("".concat(this.googleFormUrl).concat(e),a.join("&"),{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"text"}).toPromise()}}]),N}();k.\u0275fac=function(n){return new(n||k)(q.LFG(B.eN))},k.\u0275prov=q.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"});var ae=function(){function N(n,t,e){(0,x.Z)(this,N),this.googleService=n,this.eventService=t,this.bg=e,this.googleAnalyticsTID="UA-97996247-1",this.initializeGoogleAnalyticsHandler(e.application)}return(0,Y.Z)(N,[{key:"initializeGoogleAnalyticsHandler",value:function(t){var e=this,a=t.get("user");this.eventService.attachEvent(A.P.SEND_GOOGLE_ANALYTICS,function(i){var c=i.data;if(c||0!==Object.keys(c).length)switch(c.type){case"pageview":e.sendGoogleAnalyticsPageView(c.page,a,t);break;case"event":e.sendGoogleAnalyticsEvent(c.category,c.action,c.label,c.value,a,t)}}),this.eventService.attachEvent(A.P.SEND_GA_CID,function(i){e.writeGoogleAnalyticsCID(i,a)}),this.eventService.attachEvent(A.P.SEND_TO_GOOGLE_FORM,function(i){return(0,l.mG)(e,void 0,void 0,u().mark(function c(){var h,P,v,M;return u().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:h=i.data,P=h.body,v=h.replaceUserId,M=h.id,this.sendToGoogleForm(P,v,a,t,M);case 2:case"end":return L.stop()}},c,this)}))})}},{key:"writeGoogleAnalyticsCID",value:function(t,e){e.set("googleAnalyticsCID",t.data)}},{key:"sendGoogleAnalyticsPageView",value:function(t,e,a){return(0,l.mG)(this,void 0,void 0,u().mark(function i(){var h,P,v;return u().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!s.cQ.isBrowser(r.g.BROWSER_NAME_FF)){w.next=6;break}return w.next=3,o.V.syncGet("allowAnalyticsCollect");case 3:if(w.sent){w.next=6;break}return w.abrupt("return");case 6:h=e&&e.get("googleAnalyticsCID"),P=e&&e.get("token"),v={v:"1",tid:this.googleAnalyticsTID,cid:h||"anonymous",cd1:P||"0",cd2:h||"anonymous",t:"pageview",dp:t,cd4:Date.now(),cd5:framework.extension.version},this.analyticsDataRequestHandler(v,a);case 10:case"end":return w.stop()}},i,this)}))}},{key:"sendGoogleAnalyticsEvent",value:function(t,e,a,i,c,h){return(0,l.mG)(this,void 0,void 0,u().mark(function P(){var M,w,L;return u().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!s.cQ.isBrowser(r.g.BROWSER_NAME_FF)){j.next=6;break}return j.next=3,o.V.syncGet("allowAnalyticsCollect");case 3:if(j.sent){j.next=6;break}return j.abrupt("return");case 6:M=c&&c.get("googleAnalyticsCID"),w=c&&c.get("token"),L={v:"1",tid:this.googleAnalyticsTID,cid:M||"anonymous",cd1:w||"0",cd2:M||"anonymous",t:"event",ec:t,ea:e,el:a,ev:i||0,cd4:Date.now(),cd5:framework.extension.version},this.analyticsDataRequestHandler(L,h);case 10:case"end":return j.stop()}},P,this)}))}},{key:"sendToGoogleForm",value:function(t,e,a,i,c){t[e]=a.get("token")||0,this.googleService.sendGoogleFormData(t,c)}},{key:"analyticsDataRequestHandler",value:function(t,e){this.googleService.sendGoogleAnalyticsData(t),this.googleService.sendGoogleAnalyticsDataCloudFunction(t)}}]),N}();ae.\u0275fac=function(n){return new(n||ae)(q.LFG(k),q.LFG(A.P),q.LFG(E.v))},ae.\u0275mod=q.oAB({type:ae}),ae.\u0275inj=q.cJS({providers:[k],imports:[[te.ez]]});var he=O(7020),ue=O(2608),_e=function(){function N(n,t){(0,x.Z)(this,N),this.eventService=n,this.clubService=t,this.attachListeners()}return(0,Y.Z)(N,[{key:"attachListeners",value:function(){var t=this;this.eventService.attachEvent(A.P.GET_CLUB_OFFERS,function(){return(0,l.mG)(t,void 0,void 0,u().mark(function e(){return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",this.clubService.getOffers());case 1:case"end":return i.stop()}},e,this)}))}),this.eventService.attachEvent(A.P.REFRESH_ALL,function(){return(0,l.mG)(t,void 0,void 0,u().mark(function e(){return u().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",this.clubService.clearCacheOffers());case 1:case"end":return i.stop()}},e,this)}))})}}]),N}();_e.\u0275fac=function(n){return new(n||_e)(q.LFG(A.P),q.LFG(ue.I))},_e.\u0275mod=q.oAB({type:_e}),_e.\u0275inj=q.cJS({providers:[ue.I,A.P],imports:[[te.ez]]});var Te=(0,Y.Z)(function N(n,t,e,a){arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,x.Z)(this,N),this.domain=n,this.carpPage=t,this.thanksPage=e,this.parsePromoCode=a}),Pe=(0,Y.Z)(function N(n,t){(0,x.Z)(this,N),this.urlPath=n,this.parameters=t}),Oe=(0,Y.Z)(function N(n,t,e,a,i){(0,x.Z)(this,N),this.parseType=n,this.requestMethod=t,this.requestType=e,this.requestUrl=a,this.requestData=i}),ve=(0,Y.Z)(function N(n,t,e){(0,x.Z)(this,N),this.shoppingVisitedId=n,this.timeCreateShoppingVisited=t,this.extensionVersion=e}),me=function(){function N(n,t){(0,x.Z)(this,N),this.httpClient=n,this.cacheService=t,this.cachePrefix="shops",this.cacheKey="promoCode",this.cacheTime=18e5,this.baseUrl=f.S._api,this.pathLogPromoCode="/log-promo-code",this.pathShopsPromoCode="/shops-promo-code",this.shopsPromoCode=new Array}return(0,Y.Z)(N,[{key:"getShopsPromoCode",value:function(){return(0,l.mG)(this,void 0,void 0,u().mark(function t(){var a,e=this;return u().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.cacheService.get(this.cachePrefix,this.cacheKey);case 2:if(!(a=c.sent)||!a.length){c.next=5;break}return c.abrupt("return",a);case 5:return c.next=7,this.httpClient.get("".concat(this.baseUrl).concat(this.pathShopsPromoCode),{headers:{"Content-Type":"application/json"}}).toPromise().then(function(h){e.shopsPromoCode=h.map(function(P){var v=new Oe(P.parsePromoCode.parseType,P.parsePromoCode.requestMethod,P.parsePromoCode.requestType,P.parsePromoCode.requestUrl,P.parsePromoCode.requestData),M=new Pe(P.thanksPage.urlPath,P.thanksPage.parameters);return new Te(P.domain,P.carpPage,M,v)}),e.cacheService.set(e.cachePrefix,e.cacheKey,e.cacheTime,e.shopsPromoCode)});case 7:return c.abrupt("return",this.shopsPromoCode);case 8:case"end":return c.stop()}},t,this)}))}},{key:"sendLogPromoCode",value:function(t){this.httpClient.post("".concat(this.baseUrl).concat(this.pathLogPromoCode),JSON.stringify(t),{headers:{"Content-Type":"application/json"}}).toPromise().then()}}]),N}();me.\u0275fac=function(n){return new(n||me)(q.LFG(B.eN),q.LFG(he.Q))},me.\u0275prov=q.Yz7({token:me,factory:me.\u0275fac,providedIn:se});var se=function(){function N(n){var t=this;(0,x.Z)(this,N),this.parsePromoCodeService=n,this.shopsPromoCode=new Array,this.timeoutShoppingVisited=36e5,this.parsePromoCodeService.getShopsPromoCode().then(function(e){t.shopsPromoCode=e,t.shopsPromoCode&&t.shopsPromoCode.length>0&&(t.addListenerWebRequestOnCompleted(),t.addListenerWebRequestOnBeforeRequest())})}return(0,Y.Z)(N,[{key:"createShoppingVisitedId",value:function(t,e,a){var i;if(t.shoppingVisited){if(i=t.shoppingVisited,Date.now()<i.timeCreateShoppingVisited)return i.timeCreateShoppingVisited=Date.now()+this.timeoutShoppingVisited,void(t.shoppingVisited=i);i=new ve(s.cQ.guid(),Date.now()+36e5,chrome.runtime.getManifest().version),t.shoppingVisited=i}else i=new ve(s.cQ.guid(),Date.now()+this.timeoutShoppingVisited,chrome.runtime.getManifest().version),t.shoppingVisited=i;var c={shopping_visited_id:t.shoppingVisited.shoppingVisitedId,domain:t.domain,event_type:1,extension_version:t.shoppingVisited.extensionVersion,data:{tab:{referrer:e.initiator,url:e.url},environment:{os:a.os,os_version:a.osversion,browser:a.browser,browser_version:a.version}}};this.parsePromoCodeService.sendLogPromoCode(c)}},{key:"addListenerWebRequestOnCompleted",value:function(){var t=this;chrome.webRequest.onCompleted.addListener(function(e){var a=s.cQ.getFullInfo(),i=null;try{i=s.cQ.getDomain(e.initiator)}catch(c){}t.shopsPromoCode.find(function(c){if(c.domain===i||e.url.includes(c.domain)){if(t.createShoppingVisitedId(c,e,a),e.url.includes(c.carpPage)){var h={shopping_visited_id:c.shoppingVisited.shoppingVisitedId,domain:c.domain,event_type:3,extension_version:c.shoppingVisited.extensionVersion,data:{tab:{referrer:e.initiator,url:e.url},environment:{os:a.os,os_version:a.osversion,browser:a.browser,browser_version:a.version}}};t.parsePromoCodeService.sendLogPromoCode(h)}if(e.url.includes(c.thanksPage.urlPath)){var P={shopping_visited_id:c.shoppingVisited.shoppingVisitedId,domain:c.domain,event_type:4,extension_version:c.shoppingVisited.extensionVersion,data:{tab:{referrer:e.initiator,url:e.url},environment:{os:a.os,os_version:a.osversion,browser:a.browser,browser_version:a.version}}};t.parsePromoCodeService.sendLogPromoCode(P)}}})},{urls:["<all_urls>"],types:["main_frame"]})}},{key:"addListenerWebRequestOnBeforeRequest",value:function(){var t=this;chrome.webRequest.onBeforeRequest.addListener(function(e){var a=s.cQ.getFullInfo(),i=null;try{i=s.cQ.getDomain(e.initiator)}catch(c){}t.shopsPromoCode.find(function(c){if(c.domain===i||e.url.includes(c.domain)){var h=c.parsePromoCode;if(e.url.includes(h.requestUrl)&&e.method===h.requestMethod&&e.type===h.requestType){var P;switch(h.parseType){case"requestBody":if(e.requestBody&&e.requestBody.raw){var v=JSON.parse(decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(e.requestBody.raw[0].bytes)))),M=h.requestData.split(".");if(v){var L,w=(0,ee.Z)(M);try{for(w.s();!(L=w.n()).done;){var Z=L.value;P=v[Z],v=v[Z]}}catch(re){w.e(re)}finally{w.f()}}else P=v[h.requestData]}else if(e.requestBody&&e.requestBody.formData){P=e.requestBody.formData[h.requestData][0]}break;case"requestRegExp":P=decodeURIComponent(e.url).match(new RegExp(h.requestData))[1]}var Q={shopping_visited_id:c.shoppingVisited.shoppingVisitedId,domain:c.domain,event_type:2,extension_version:c.shoppingVisited.extensionVersion,data:{promo_code:P,tab:{referrer:e.initiator,url:e.url},environment:{os:a.os,os_version:a.osversion,browser:a.browser,browser_version:a.version}}};t.parsePromoCodeService.sendLogPromoCode(Q)}}})},{urls:["<all_urls>"]},["requestBody"])}}]),N}();se.\u0275fac=function(n){return new(n||se)(q.LFG(me))},se.\u0275mod=q.oAB({type:se}),se.\u0275inj=q.cJS({providers:[me,A.P],imports:[[te.ez]]});var Ke=O(121),Ze=O(8561),Ue=function(){function N(n,t,e,a){(0,x.Z)(this,N),this.aliexpressProductsService=n,this.priceMonitoringServices=t,this.eventService=e,this.bg=a,this.application=a.application,this.addEventListener()}return(0,Y.Z)(N,[{key:"addEventListener",value:function(){var t=this;this.eventService.attachEvent(A.P.PRICE_MONITORING_GET_DATA,function(e){return(0,l.mG)(t,void 0,void 0,u().mark(function a(){var i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return e.tabId||(e.tabId=this.application.tabs.currentTabId),h.next=3,this.priceMonitoringServices.init(e,this.application);case 3:return i=h.sent,h.abrupt("return",JSON.parse(JSON.stringify(i)));case 5:case"end":return h.stop()}},a,this)}))}),this.eventService.attachEvent(A.P.PRICE_MONITORING_GET_CHART_DATA,function(e){return(0,l.mG)(t,void 0,void 0,u().mark(function a(){var i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.priceMonitoringServices.getPriceDynamicChartData(e);case 2:return i=h.sent,h.abrupt("return",JSON.parse(JSON.stringify(i)));case 4:case"end":return h.stop()}},a,this)}))}),this.eventService.attachEvent(A.P.PRICE_MONITORING_GET_SIMILAR_PRODUCTS,function(e){return(0,l.mG)(t,void 0,void 0,u().mark(function a(){var i;return u().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.priceMonitoringServices.getSimilarProducts(e);case 2:return i=h.sent,h.abrupt("return",JSON.parse(JSON.stringify(i)));case 4:case"end":return h.stop()}},a,this)}))}),this.eventService.attachEvent(A.P.PRICE_MONITORING_CLEAR_HISTORY,function(){var e=t.priceMonitoringServices.clearHistoryItems();return JSON.parse(JSON.stringify(e))})}}]),N}();Ue.\u0275fac=function(n){return new(n||Ue)(q.LFG(Ze.q),q.LFG(Ke.r),q.LFG(A.P),q.LFG(E.v))},Ue.\u0275mod=q.oAB({type:Ue}),Ue.\u0275inj=q.cJS({providers:[Ke.r,A.P],imports:[[te.ez]]});var Me=function(){function N(){(0,x.Z)(this,N)}return(0,Y.Z)(N,[{key:"ngDoBootstrap",value:function(t){}}]),N}();Me.\u0275fac=function(n){return new(n||Me)},Me.\u0275mod=q.oAB({type:Me}),Me.\u0275inj=q.cJS({providers:[C.G,b.B,A.P,m.E,he.Q,D.U,{provide:q.ip1,useFactory:function(n,t,e,a,i,c,h){window.application=new X({similarToolsService:n,eapiService:t,eventService:e,configService:a,featureService:i,localeService:c,categoriesService:h})},deps:[C.G,b.B,A.P,m.E,D.U,F.O,d.G]},{provide:E.v,useFactory:function(){return framework.extension.getBackgroundPage()}}],imports:[[ie.b2,B.JF,ae,_e,se,Ue]]}),I.N.production&&(0,q.G48)(),ie.q6().bootstrapModule(Me,{ngZone:"noop"}).catch(function(N){return console.error(N)})},344:function(ge,le,O){O.d(le,{N:function(){return ie}});var ie={production:!0}}},function(ge){ge.O(0,[736],function(){return ie=6770,ge(ge.s=ie);var ie});ge.O()}]);